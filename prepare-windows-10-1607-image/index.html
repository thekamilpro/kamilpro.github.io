<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>How to prepare Windows 10 1607 image | Kamil Pro</title>
<meta name=keywords content="1607,answer,deployment,feat,image,sysprep,unattend,windows 10"><meta name=description content="Sooner or later every company will come to the point when using standard Windows image is just not enough. Manual installation, fetching all updates or installing software etc. etc. takes time, and in IT, we really can use that time for something way more productive."><meta name=author content="Kamil"><link rel=canonical href=https://kamilpro.com/prepare-windows-10-1607-image/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://kamilpro.com/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://kamilpro.com/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://kamilpro.com/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://kamilpro.com/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://kamilpro.com/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://kamilpro.com/prepare-windows-10-1607-image/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-5Q7PS37F1K"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-5Q7PS37F1K")}</script><meta property="og:title" content="How to prepare Windows 10 1607 image"><meta property="og:description" content="Sooner or later every company will come to the point when using standard Windows image is just not enough. Manual installation, fetching all updates or installing software etc. etc. takes time, and in IT, we really can use that time for something way more productive."><meta property="og:type" content="article"><meta property="og:url" content="https://kamilpro.com/prepare-windows-10-1607-image/"><meta property="og:image" content="https://kamilpro.com/105"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-04-03T22:35:09+00:00"><meta property="article:modified_time" content="2017-04-03T22:35:09+00:00"><meta property="og:site_name" content="Kamil Pro"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kamilpro.com/105"><meta name=twitter:title content="How to prepare Windows 10 1607 image"><meta name=twitter:description content="Sooner or later every company will come to the point when using standard Windows image is just not enough. Manual installation, fetching all updates or installing software etc. etc. takes time, and in IT, we really can use that time for something way more productive."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://kamilpro.com/posts/"},{"@type":"ListItem","position":2,"name":"How to prepare Windows 10 1607 image","item":"https://kamilpro.com/prepare-windows-10-1607-image/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"How to prepare Windows 10 1607 image","name":"How to prepare Windows 10 1607 image","description":"Sooner or later every company will come to the point when using standard Windows image is just not enough. Manual installation, fetching all updates or installing software etc. etc. takes time, and in IT, we really can use that time for something way more productive.\n","keywords":[1607,"answer","deployment","feat","image","sysprep","unattend","windows 10"],"articleBody":"Sooner or later every company will come to the point when using standard Windows image is just not enough. Manual installation, fetching all updates or installing software etc. etc. takes time, and in IT, we really can use that time for something way more productive.\nTherefore, I propose you to create your very own, customised, Windows 10 image which will save you tonnes of time.\nLet’s set some goals:\nAutomatic installation – no questions about user accounts, settings etc. Hardware neutral – image will be installable on any kind of computer with necessary drivers equipped within. Customised – image will be shipped with software and other preferences so that employees will be able to “just” log in straight after deployment. Sounds good? So let’s start preparing.\nPrepare for Windows 10 image creation I know you’d like to just jump in and start creating the new image, but to prepare the image properly there are necessary setup steps needed before the actual process. The benefits of this preparing will come handy in the future.\nWhat you’re going to need is:\nPC capable of virtualisation – Since the image creation will happen in VM (Virtual Machine), we need hardware capable of this. If you’ve got a dedicated machine already – that’s great – if not, then any computer manufactured within the last few years, which can afford at least 2GBs of memory for virtualisation (you can assign less than 2GBs of memory, but everything will be slow. Like really, slow) and hard disk space – only you know how much space you’re going to use for this task. However, bare in mind you should allow extra space for the checkpoints. If you can afford to use SSD that’s great – it hugely improves the speed of the process. Windows 10 ISO file – you’d need this to install the actual image and to create so-called “answer” file out of it. Windows ADK – this will be used for creating the answer file. Hypervisor with checkpoint function – this will allow us to create a VM with the actual image, while checkpoints can save plenty of time in case something goes wrong or must be amended. Software and customisation files which are going to be shipped with Windows. Drivers. Internet – not necessary, but really helpful. As long as you’ve got the hardware capable of virtualisation, the rest comes from the Internet, or your software repositories.\nWindows 10 ISO file The fastest way of getting the Windows 10 ISO file is to go to: https://www.microsoft.com/en-gb/software-download/windows10ISO or google “Windows Media Creation Tool”. Once on the website, pick “Windows 10” from the drop down menu (unless you’ve got licence for a different version). If your company happens to have a volume licence with Microsoft, then expand “More Download Options” where you can find links to MSDN websites.\nWhen using Media Creation Tool, make sure to pick *.ISO file during the process. The file will be later on used in both, hypervisor and answer file.\nDo not try to obtain images from any other, unofficial sources, as there’s always a chance of getting something “extra” from dishonest people. Nobody likes “extras” in Windows images.\nWindows ADK https://developer.microsoft.com/en-us/windows/hardware/windows-assessment-deployment-kit\nWindows ADK (Assessment and Deployment Kit) is a set of tools required for image customisation and checking the performance of the computer. You need to fetch the version corresponding to the Windows image creation, as of writing this article, the newest version is Windows 10, version 1607.\nStart the downloaded file, and upon the choice you need only 2 out of all:\nDeployment tools – SIM (Windows System Image Manager) – this tool is used to create the answer file, which will allow for automatic installation of Windows. Windows PE (Preinstallation Environment) – will be used for capturing the image. Unless you’ve got other solution in place (e.g. Norton Ghost) this tool is necessary. Hypervisor The customised image will be created within the VM and therefore hypervisor is essential to it. The second requirement are snapshots, which will allow us to roll back any wrong changes, as well as re-use the image for any amendments/updates required after creating the initial image.\nSnapshot = Checkpoint. These words can be used interchangeably.\nI can only think about 2 free options here – first is Microsoft Hyper-V, which comes built in Windows 8 or 10 in Pro edition, or any Windows Server since 2008 version. If you don’t have a such a possibility, you can use VirtualBox, which is free and has desired checkpoints functionality. Obviously, any hypervisor with checkpoints feature should do the trick.\nI’ll be using Hyper-V since I’ve got Windows 10 Pro in my setup. To install Hyper-V on either Windows client or Server, make sure that Virtualization is enabled in your BIOS/UEFI setting, this is often called Intel VT, AMD-V or simply Virtualization Technology.\nIn order to instal Hyper-V in Windows Clients, go to Control Panel\u003ePrograms and Features\u003eTurn Windows features on or off. Then expand Hyper-V menu and make sure that you can tick Hyper-V Management Tools and Hyper-v Platform. You will need to reboot the PC for the role to become active.\nIn Windows Server, you will need to add Hyper-V role to the server and reboot the server afterwards.\nSoftware It might be any sort of installer or even copy-paste type of application. If it works with the standard Windows installation, it should work with the customised image.\nCustomised files – this will be any specific wallpapers, files etc. which are used to brand the image.\nDrivers Since Windows 10 is shipped with plenty of drivers out of box, there are still many propetiary ones which must be either downloaded via WU (Windows Update) or installed manually. If your environment does not allow/provide drivers download via Windows Update, you must add them to the image.\nI did write a whole blog of how to add any drivers to the image.\nIn other words, you need drivers with *.inf files, some manufacturers allow you to download the whole package of *.inf files for a computer series, some don’t. In such a case, you might need to unpack the drivers manually to get *.inf files out of it.\nPrepare the environment for Windows 10 image I hope you’re still bearing with me to this point, the most boring parts is behind us – I mean gathering all the stuff needed for the image creation.\nLet’s look up the steps to follow:\nCreate VM Install Windows Put set Windows into Audit mode Install software Add drivers Customise Menu Start Creating answer file Testing the image Shall we begin?\nCreate VM + Virtual Switch for VM VM will need a connection to the local network as well as the Internet. Therefore we need to create a virtual switch to which the VM is going to be connected.\nCreating Virtual Switch To create a virtual switch you need to:\nVirtual Switch manager Highlight new virtual switch, pick “External”, and click Create Virtual Switch Give it meaningful name e.g. Internet, make sure that External radius is ticked and choose the network card which used to connect to the Internet, click OK. The network switch is being created. Once your virtual switch has been created, we can start creating the new VM and use the switch to connect VM to the Internet.\nCreating Virtual Machine Now it’s time to create our virtual computer – a place where a customised image will be created, maintained and captured! Are you excited, like me?\nRight click on the name of your server, highlight new and choose Virtual Machine. Specify the name e.g. Windows 10_1607, and you can change the location where VM will be saved if needed. Make sure the disk you’re going to use will have at least the amount of space you plan to use for your VM. You can choose either generation, but I strongly recommend Generation 2 (which is supported for Windows 2012/8 onwards), generation 2 allows you to simulate UEFI, boot from SCSi adapters (which perform faster than IDE) and are power-failure proof. Memory. Assign at least 2 GBs, if you can 4GBs. You can leave Dynamic memory tick on, however, it shouldn’t make any difference in this scenario. In the configuring networking window, choose the Virtual Switch created earlier on, this will allow the VM to talk to the rest of the world. Virtual disk – in other words, the special file which behaves like a hard drive. Probably you will only want to amend the size of, I find 60GB very minimum, but again, it’s entirely up to you. The last step needed for the configuration is Installation option – in other words, pointing VM to the installation media. Simply choose the ISO downloaded earlier on. On the Summary window, verify all the settings and hit finish if you’re happy with all of them. Hyper-V will create your VM now, you should be able to see it in the main Windows of the Hyper-V.\nWindows 10 installation Yes, we are just a step before installing, but hold your horses for a second, there’s one more point worth considering.\nAudit mode or OOBE mode? When you perform the standard installation of Windows, you simply boot to OOBE (Out of box experience) every single time. Then you go through the process of customising the installation and creating user account etc.\nAudit mode is, on the other hand, a special mode dedicated to preparing Customised Windows image. It will e.g. automatically log in to the Administrator account, which will be removed once the work in the Audit mode has been finished. Changes made in the Audit mode will be then copied to every new user logging to the PC, which keeps the user experience. Yet working in the Audit mode is exactly identical like in OOBE.\nYou can even switch between OOBE/Audit modes once Windows 10 has been installed, but why not start from using Audit and simply keep using it, from the beginning?\nTherefore it’s not required, but I’d recommend you to use the Audit mode for the image creation.\nLet’s install Windows 10! All the preparation will now pay off – you’ll be able to go and set up everything as desired, using the software which you’ve prepared earlier on.\nAs mentioned earlier, I’ll follow the Audit mode way and prepare my image in that way. The process of installing is almost the same for Audit and OOBE mode, however, I’m going to indicate the moment when you need to make the call.\nStart the VM. On the screen “Press any key to boot”, press any key. On the “Windows Setup” screen, choose Install now. Now you’re going to be asked to provide a licence key. In case you don’t have it yet, you can simply skip this and provide the key later. Choose the edition of Windows 10 which you’re going to install. I recon it’s going to be Pro, which will allow you, among other things, join the computer to the domain. Once you are aware of the agreement content, tick the box and move forward. Since this is a freshly created VM, its hard drive it’s literally empty. Therefore the only thing you can do now is to choose Custom: Install Windows only. On the following screen just click next, Windows installer will partition the drive and utilise all space. Even if you’d need additional partitions, you’ll be able to order Windows to create them during the deployment process. The Windows installation starts now. It will take some time and reboots before reaching the next screen, on which you’ll need to make a decision about the mode used for installation.\nThe Audit mode trigger is hidden; you must use a keyboard shortcut to activate it.\nPress simultaneously ALT + SHIFT + F3, after which VM will instantly restart and boot to audit mode shortly.\nWindows will now automatically log in with Administrator’s account, and present you with SYSPREP (System Preparation Tool) window, which you’d like to cancel. The tool allows you to set Windows 10 back to OOBE mode generalise (which I’ll explain later on) and restart it. Just cancel it. It might be worth to take a check point at this moment.\nCustomise the image Now it’s time to install all the software you need, but how to provide it? We could use so-called guest services and start copying all the installation files, but that would take first time to do so, secondly the size of the VHD would start growing.\nRather than that, let’s go good, old network sharing. Not only it will allow us to install folders without copying them all to the VM, but also will deliver the answer file, or will allow exporting e.g. customised menu start settings.\nCreate the network share on your host machine Open the folder where you’re going to store all files needed by your VM.\nOpen properties of the folder. On the properties window, change tab to “Sharing” and choose “Advanced Sharing…” Tick the box “Share this folder” and choose “Permissions”. You might note down the folder name as this will become the name of the actual share. Grant full access to the account which is going to access the network share on your host machine. I granted access to Everyone. Click OK twice and once backed to the properties window, change tab to “Security” and choose “Edit” button. Click Add. Type the same username which you’ve used in the Sharing permissions. Grant “Allow – Modify” rights to the user. Click OK on all windows. You might ask why we’ve had grant access to the same user in 2 different places. Since this is not an article about shares and permissions I’ll keep it short – Windows differentiates 2 levels of access – local and networked. The user must have access locally to be able to access the files at all and locally, that is, while working on the actual computer. Networked access allows users to access the files over the network, and folders accessed that way are called shares. In the case of when a user has only network rights, one still won’t be able to access the files because of the lack of the local permission.\nMap the network drive Once the network share has been created, it’s time to map it. That process is called mapping the network drive because ultimately it will show up alongside other drives – hard and flash disks and optical drives.\nHead towards “This computer.” Choose “Computer” tab and click “Map network drive.” On the following screen specify the location of the network share – the format is: \\, the name of my host is KMLPRO and the name of the share is VM_installers therefore the full path will be: \\KMLPRO\\VM_installers. Tick the box “Connect using different credentials”. You might also tick the box “Reconnect at sign-it”, that way Windows will store your login details to the server and automatically map the drive the next time you log in. Feel free to change the drive, if you’d like to. You’ll be asked to provide details of the account which you’ve granted access rights earlier on. Once completed, you’ll find your mapped network drive alongside other drives in the computer view.\nInstall the software, customise the settings Now you’ve got to the point where you can perform an installation of any software needed.\nTry to use officially released MSI files. In the case of updating the image later on, MSIs always make sure to get rid of the old version of the file and upgrade. If possible, avoid launching the applications. It might amend some default settings which users might not like. Install the latest .NetFramework (as well as other libraries) possible, that will save time, both your and your users. Do not forget about the new Menu Start, you can pin applications often used by the users. Once you’ve completed the customisation process, take the checkpoint. Just in case.\nDrivers “Software comes and goes. Hardware is forever,” they said, but to make that hardware work, we need drivers.\nWhy not rely on the Internet/Windows updates? The problem with drivers is that they often won’t install, unless there’s actual hardware present at the moment of installation. You can obviously rely on Windows Update and hope that everything will be self-installed, but do you really want to?\nI personally cannot imagine deploying Windows to more than 10 computers and allowing them to go to Windows Update and start downloading, then wait for reboots etc. Nope, that doesn’t work like that in an enterprise.\nUnless you’re in the situation where you can utilise Windows Update, then you can skip that part. But you’ll miss so much fun with having control of every single driver on the image.\nPNPUTIL – Drivers’ best mate Microsoft includes in the Windows a brilliant tool called PNPUTIL, which basically allows managing drivers and give you as the administrator the control over the drivers inside of the VM.\nHave I mentioned that we will need to go command line? Oh well, now I’m telling you. But it won’t be scary, I promise. PNPUTIL is a command line only.\nMain PNPUTIL switches which you should know about: Driver store – what is this? Windows comes with plenty of drivers out of the box – however, it’s impossible to include every single driver to every single device, or even make sure that all the drivers are up to date.\nTherefore, here comes the idea of the Driver Store – think about it like installers for your software – you have the installer, but you install the software when it’s actually needed by the user.\nSame happens with the hardware – when a new device is connected, Windows goes through the store and looks for the appropriate driver. That way we can load all needed drivers and Windows will use them only when they are needed. This is cool, isn’t it?\nLet’s add some drivers! If you’ve done a good job preparing your drivers (*.inf files) organising them into folders (e.g. C:\\Temp\\Drivers\\Audio, C:\\Temp\\Drivers\\Video etc.), then follow the instruction below. If not, go and organise them now.\nGo to the folder where your drivers are, press and hold the SHIFT ket + right-click the mouse and choose “Open command window here”. Type “pnputil” and hit enter, familiarise yourself with the command details (for your own reference) Type pnputil /enum-drivers and look how many drivers are needed. Since this is VM, there a just a few in use. Type *pnputil /add-driver .inf /subdirs. This will order pnputil to go through all the folders and add any driver it finds to the store. It might take a while depending on amount and size of drivers you’ve prepared. Upon the completion, you’ll see how many drivers have been added to the store. This is it, that one step closer to the hardware neutral Windows image. Enumerate the drivers now, see how many has been added to the Drivers now. Don’t forget to take the checkpoint.\nUnattended installation Are we there yet? Yes, almost there!\nOnce you are happy with all customisations you’ve just done, it’s time to tell Windows, what to do during the installation. Why? To not get all that prompts about licencing, partitioning, the name of the computer and user etc. We are going to be like this bartender from the local pub, who knows us good enough to serve everything we like. Sounds cool? Keep it coming then!\nI must admit, I was really impressed (like WOW impressed) when saw fully automatic Windows deployment for the first time in my life – from the beginning of the process – when Windows configured itself until it reached the Logon/Desktop screen.\nCreating WIM file Unattended installation means automatic installation – which is our goal. Essential part of it is the Answer file – the file which will tell Windows installer what to do during the installation. We obviously, are going to create are own answer file.\nWe are going to need WIM file, which is in short take, the actual compressed Windows – whenever you install Windows, it’s being decompressed and installed to the local hard disk. Where’s the file then? You’ve guessed it right, on the Windows 10 ISO, the same which we’ve used to install Windows 10 earlier on.\nMicrosoft started using ESD files to include Windows installation files, which are way more compressed than actual WIM files. Therefore first step is to copy the ESD file off the ISO, then convert it to the WIM file to finally use for the Answer file creation.\nRight click on the ISO which you’ve used to install the Windows 10, mount it. ISO will show as ordinary DVD drive, open it and go to the “Sources” folder, and find install.esd file. It’s the biggest (approximately 4GBs) file over there. Copy the file off the image. I can suggest to create a dedicated folder where you’re going to store all ISOs used for installation and another folder called WIM where you’ll store WIM files. The reason behind is that you should always use the WIM file from ISO used for installation. Don’t forget about meaningful names. We need elevated (administrator) command prompt, right click on the Windows menu and choose it then. Change directory to where the ISO is. You can use DIR command to make sure you’re in the right folder and can see install.erd file. Type command: dism /Get-WimInfo /WimFile:install.esd You should see the list of available Windows 10 edition included in the ISO. I’m going to need Pro edition therefore will choose Index:1 Type command: **dism /export-image /SourceImageFile:install.esd /SourceIndex:1 /DestinationImageFile:Windows10_pro_1607.wim /Compress:max /CheckIntegrity **I’ve highlighted the index number and the file name in case you’d like to change it. Wait until the process has finished and we can move on to the actual answer file creation. You’ll find the WIM file in the same location where ESD file is.\nAnswer File It’s time to tell Windows off, literally. We’re going to prepare the answer file, which will guide Windows through the installation – and achieve automatic installation there.\nThere are tonnes of possible settings to configure, therefore I will focus on bringing you to the automated installation which you might use as the base for your answer file. Most of the settings are well documented which is a great help.\nTo create the answer file:\nOpen Windows System Image Manager. Press the “New Answer File” button. Say yes to open the Windows Image file. Point to the WIM file created earlier on. Confirm creation of the catalog file. It will take a few minutes for SIM to complete the image creation process. Upon finish, you’ll be presented with the new SIM windows with more options than before.\nAnswer file reflects different Windows installation stages (passes) – there are 7 of them, however, we need only a few for our needs.\nThe components part contains the actual jobs that Windows Installer performs during different parts of the installation. One component can be added to multiple installation stages. Components are added by right-clicking on them and choosing to which part they need to be added.\nNecessary components for automated installation:\nPhase 1 WinPE:\namd64_Microsoft-Windows-International-Core-WinPE amd64_Microsoft-Windows-Setup Phase 4 Specialize:\namd64_Microsoft-Windows-Shell-Setup Phase 7 OOBE\namd64_Microsoft-Windows-International-Core amd64_Microsoft-Windows-Shell-Setup I really wanted to describe all the components, meaning what you should type and where, but it would take way too much time and space. Instead, I’ll simply paste the answer file here and describe what it does in each phase.\nAnswer file – Windows_10_pro.xml (right click and dowload/save link as)\nUse SIM to open the file above, and point to Windows 10 1607 WIM file.\nPhase 1 WinPE That one happens when you actually boot a computer from the installation media and are presented with the install now screen.\nWhat happens in “amd64_Microsoft-Windows-International-Core-WinPE” is to choose which display language should be picked.\nThe “amd64_Microsoft-Windows-Setup” tells installer to wipe the first hard drive, then create 4 partitions (as needed for UEFI) and to modify them. While first 3 partitions are needed for Windows to run and have a fixed size, the 4th – where the actual OS is – will use all remaining space for itself.\nPhase 4 Specialize That phase happens when Windows is “Getting ready”. You can notice a CopyProfile option – it tells the installer to take Administrator’s profile (the same which you’ve customised earlier on in the Audit mode) and set it as the default profile – so that every profile created on the computer will have the same customisation.\nThe product key used here is generic Windows 10 Pro, you should change it to yours. You won’t be able to activate Windows with that key.\nPhase 7 OOBE OOBE – Out of box experience – is the Wizard which you see during the first Windows boot.\n“amd64_Microsoft-Windows-International-Core” will tell the computer which language, region and keyboard layout will be used for the users.\n“amd64_Microsoft-Windows-Shell-Setup” will accept the agreement, set Windows to get automatic Windows Updates and create local user “Dave” who will be an administrator. Notice that password field is hashed, therefore you should change it to yours.\nDefaultuser0 bug When at some point you’ll start testing/deploying the image, you might notice a 2nd user account created during the installation, called defaultuser0. It’s being created during the CopyProfile function, I couldn’t find an explanation why it happens.\nWe could switch off the CopyProfile, but then it would be necessary to spend a way more time with customising (including start menu, theme, wallpaper etc. would need to be set, configured with text files and exported – which is not really user friendly).\nOr we could keep using CopyProfile and call a command “net user defaultuser0 /delete” during first user logon, which removes it automatically. I prefer the second option, which is included in the answer file.\nSave the answer file Once you’re happy with your answer file, save in the shared folder created earlier on.\nPreparing the image for capture/housekeeping We need to do some housekeeping to make the image clean and neat for the end user:\nRun Windows updates Run antivirus updates Remove all browsing history from Internet browsers Unmount all mounted network drives Right click on the address bar in Windows explorer and choose “Delete history” Run disk clean up Make sure there are no passwords saved in the Credential manager (Control panel\u003eCredential Manager) Remove any directories used during image preparation (e.g. C:\\temp) In other words – when your users get freshly wiped PC, they’ll get an impression it’s spanking new, yet customised by their great IT department. It makes a difference, a huge difference to the end user.\nTest the image within VM That’s a great moment, isn’t it? I’m always excited when testing the new image and see how all the work turns out. But before deploying it to the actual physical machine, it’s worth to test it within the actual VM.\nWhy? Because due to checkpoints, it’s extremely easy to roll back the deployment, amend the setting and deploy once again. It’s a real time saver. Therefore, do not expect the image to be ready after the first time. My first attempt took about a week to get fully polished and prepared image.\nTake the checkpoint now Remember: if there’s something you don’t like after the deployment or test, you can always roll back, change the image and try once again (and don’t forget to take another checkpoint).\nYou can repeat that process until you’re fully satisfied with the result.\nSysprep – the tool for generalization Generalise makes the image truly hardware neutral. It removes all installed drivers, Windows activation, unique installation details for the VM – it then allows computer to install completely fresh and setup itself for the new installation or another computer.\nTo generalise Windows installation you’d like to:\nOpen elevated command prompt Type: CD C:\\Windows\\System32\\Sysprep Type: **SYSPREP /GENERALIZE /OOBE /REBOOT /UNATTEND: **We call sysprep tool to generalise the installation, set Windows into OOBE mode, use answer file and restart the PC. Wait until the sysprep process is done and PC restart. Once completed, VM should restart a few times and – if everything goes well – bring you to the login screen. You’d like then to review all your customisation settings, make sure that passwords are not saved etc. Remember that whatever you can see after the first login, will be available to any new user using the computer.\nCapturing and deploying the image Once your VM is up to the standard it’s time to send it to the actual hardware and see if everything still works + all drivers are working.\nHowever, it’s beyond this article as there are many tools which can be used. If you’ve got any favourite tools which can get the job done – let me know!\nA few tips: Always take the checkpoint before syspreping. Windows has a sysprep counter, and after generalising an image few times it will not allow you to generalise it another! This means you’d need to create another image from the scratch. On the other hand, if you’ve got a VM with checkpoint just before sysprep, you can always come back to it, amend it, checkpoint it and sysprep again, unlimited number of times. If there are too many checkpoints (and not enough hard disk space), you can always remove all of them and create a new one. Creating the image is a long process – take your time! Main photo by: https://unsplash.com/@rawpixel\n","wordCount":"4919","inLanguage":"en","datePublished":"2017-04-03T22:35:09Z","dateModified":"2017-04-03T22:35:09Z","author":{"@type":"Person","name":"Kamil"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://kamilpro.com/prepare-windows-10-1607-image/"},"publisher":{"@type":"Organization","name":"Kamil Pro","logo":{"@type":"ImageObject","url":"https://kamilpro.com/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kamilpro.com/ accesskey=h title="Home (Alt + H)"><img src=https://kamilpro.com/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://kamilpro.com/posts/ title=Posts><span>Posts</span></a></li><li><a href=http://mng.bz/v89q title="PowerShell and GitHub Actions"><span>PowerShell and GitHub Actions</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://kamilpro.com/about-powershell/ title="About PowerShell"><span>About PowerShell</span></a></li><li><a href=https://kamilpro.com/powershell-course/ title="PowerShell Course"><span>PowerShell Course</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://kamilpro.com/>Home</a>&nbsp;»&nbsp;<a href=https://kamilpro.com/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">How to prepare Windows 10 1607 image</h1><div class=post-meta><span title='2017-04-03 22:35:09 +0000 UTC'>3 April 2017</span>&nbsp;·&nbsp;24 min&nbsp;·&nbsp;4919 words&nbsp;·&nbsp;Kamil</div></header><div class=post-content><p>Sooner or later every company will come to the point when using standard Windows image is just not enough. Manual installation, fetching all updates or installing software etc. etc. takes time, and in IT, we really can use that time for something way more productive.</p><p>Therefore, I propose you to create your very own, customised, Windows 10 image which will save you tonnes of time.</p><p>Let’s set some goals:</p><ul><li>Automatic installation – no questions about user accounts, settings etc.</li><li>Hardware neutral – image will be installable on any kind of computer with necessary drivers equipped within.</li><li>Customised – image will be shipped with software and other preferences so that employees will be able to “just” log in straight after deployment.</li></ul><p>Sounds good? So let’s start preparing.</p><h1 id=prepare-for-windows-10-image-creation>Prepare for Windows 10 image creation<a hidden class=anchor aria-hidden=true href=#prepare-for-windows-10-image-creation>#</a></h1><p>I know you’d like to just jump in and start creating the new image, but to prepare the image properly there are necessary setup steps needed before the actual process. The benefits of this preparing will come handy in the future.</p><p>What you’re going to need is:</p><ul><li>PC capable of virtualisation – Since the image creation will happen in VM (Virtual Machine), we need hardware capable of this. If you’ve got a dedicated machine already – that’s great – if not, then any computer manufactured within the last few years, which can afford at least 2GBs of memory for virtualisation (you can assign less than 2GBs of memory, but everything will be slow. Like really, slow)  and hard disk space – only you know how much space you’re going to use for this task. However, bare in mind you should allow extra space for the checkpoints. If you can afford to use SSD that’s great – it hugely improves the speed of the process.</li><li>Windows 10 ISO file  – you’d need this to install the actual image and to create so-called “answer” file out of it.</li><li>Windows ADK – this will be used for creating the answer file.</li><li>Hypervisor with checkpoint function – this will allow us to create a VM with the actual image, while checkpoints can save plenty of time in case something goes wrong or must be amended.</li><li>Software and customisation files which are going to be shipped with Windows.</li><li>Drivers.</li><li>Internet – not necessary, but really helpful.</li></ul><p>As long as you’ve got the hardware capable of virtualisation, the rest comes from the Internet, or your software repositories.</p><h2 id=windows-10-iso-file>Windows 10 ISO file<a hidden class=anchor aria-hidden=true href=#windows-10-iso-file>#</a></h2><p>The fastest way of getting the Windows 10 ISO file is to go to: <a href=https://www.microsoft.com/en-gb/software-download/windows10ISO>https://www.microsoft.com/en-gb/software-download/windows10ISO</a> or google “Windows Media Creation Tool”. Once on the website, pick “Windows 10” from the drop down menu (unless you’ve got licence for a different version). If your company happens to have a volume licence with Microsoft, then expand “More Download Options” where you can find links to MSDN websites.</p><p>When using Media Creation Tool, make sure to pick *.ISO file during the process. The file will be later on used in both, hypervisor and answer file.</p><p>Do not try to obtain images from any other, unofficial sources, as there’s always a chance of getting something “extra” from dishonest people. Nobody likes “extras” in Windows images.</p><h2 id=windows-adk>Windows ADK<a hidden class=anchor aria-hidden=true href=#windows-adk>#</a></h2><p><a href=https://developer.microsoft.com/en-us/windows/hardware/windows-assessment-deployment-kit>https://developer.microsoft.com/en-us/windows/hardware/windows-assessment-deployment-kit</a></p><p>Windows  ADK (Assessment and Deployment Kit) is a set of tools required for image customisation and checking the performance of the computer. You need to fetch the version corresponding to the Windows image creation, as of writing this article, the newest version is Windows 10, version 1607.</p><p>Start the downloaded file, and upon the choice you need only 2 out of all:</p><ul><li>Deployment tools – SIM (Windows System Image Manager) – this tool is used to create the answer file, which will allow for automatic installation of Windows.</li><li>Windows PE (Preinstallation Environment) – will be used for capturing the image. Unless you’ve got other solution in place (e.g. Norton Ghost) this tool is necessary.</li></ul><h2 id=hypervisor>Hypervisor<a hidden class=anchor aria-hidden=true href=#hypervisor>#</a></h2><p>The customised image will be created within the VM and therefore hypervisor is essential to it. The second requirement are snapshots, which will allow us to roll back any wrong changes, as well as re-use the image for any amendments/updates required after creating the initial image.</p><blockquote><p>Snapshot = Checkpoint. These words can be used interchangeably.</p></blockquote><p>I can only think about 2 free options here – first is Microsoft Hyper-V, which comes built in Windows 8 or 10 in Pro edition, or any Windows Server since 2008 version. If you don’t have a such a possibility, you can use VirtualBox, which is free and has desired checkpoints functionality. Obviously, any hypervisor with checkpoints feature should do the trick.</p><p>I’ll be using Hyper-V since I’ve got Windows 10 Pro in my setup. To install Hyper-V on either Windows client or Server, make sure that Virtualization is enabled in your BIOS/UEFI setting, this is often called Intel VT, AMD-V or simply Virtualization Technology.</p><p>In order to instal Hyper-V in Windows Clients, go to Control Panel>Programs and Features>Turn Windows features on or off. Then expand Hyper-V menu and make sure that you can tick Hyper-V Management Tools and Hyper-v Platform. You will need to reboot the PC for the role to become active.</p><p>In Windows Server, you will need to add Hyper-V role to the server and reboot the server afterwards.</p><h2 id=software>Software<a hidden class=anchor aria-hidden=true href=#software>#</a></h2><p>It might be any sort of installer or even copy-paste type of application. If it works with the standard Windows installation, it should work with the customised image.</p><p>Customised files – this will be any specific wallpapers, files etc. which are used to brand the image.</p><h2 id=drivers>Drivers<a hidden class=anchor aria-hidden=true href=#drivers>#</a></h2><p>Since Windows 10 is shipped with plenty of drivers out of box, there are still many propetiary ones which must be either downloaded via WU (Windows Update) or installed manually. If your environment does not allow/provide drivers download via Windows Update, you must add them to the image.</p><p>I did write a whole blog of how to add any drivers to the image.</p><p>In other words, you need drivers with *.inf files, some manufacturers allow you to download the whole package of *.inf files for a computer series, some don’t. In such a case, you might need to unpack the drivers manually to get *.inf files out of it.</p><h1 id=prepare-the-environment-for-windows-10-image>Prepare the environment for Windows 10 image<a hidden class=anchor aria-hidden=true href=#prepare-the-environment-for-windows-10-image>#</a></h1><p>I hope you’re still bearing with me to this point, the most boring parts is behind us – I mean gathering all the stuff needed for the image creation.</p><p>Let’s look up the steps to follow:</p><ul><li>Create VM</li><li>Install Windows</li><li>Put set Windows into Audit mode</li><li>Install software</li><li>Add drivers</li><li>Customise Menu Start</li><li>Creating answer file</li><li>Testing the image</li></ul><p>Shall we begin?</p><h2 id=create-vm--virtual-switch-for-vm>Create VM + Virtual Switch for VM<a hidden class=anchor aria-hidden=true href=#create-vm--virtual-switch-for-vm>#</a></h2><p>VM will need a connection to the local network as well as the Internet. Therefore we need to create a virtual switch to which the VM is going to be connected.</p><h3 id=creating-virtual-switch>Creating Virtual Switch<a hidden class=anchor aria-hidden=true href=#creating-virtual-switch>#</a></h3><p>To create a virtual switch you need to:</p><ol><li>Virtual Switch manager</li><li>Highlight new virtual switch, pick “External”, and click Create Virtual Switch</li><li>Give it meaningful name e.g. Internet, make sure that External radius is ticked and choose the network card which used to connect to the Internet, click OK.</li><li>The network switch is being created.</li></ol><p>Once your virtual switch has been created, we can start creating the new VM and use the switch to connect VM to the Internet.</p><h3 id=creating-virtual-machine>Creating Virtual Machine<a hidden class=anchor aria-hidden=true href=#creating-virtual-machine>#</a></h3><p>Now it’s time to create our virtual computer – a place where a customised image will be created, maintained and captured! Are you excited, like me?</p><ol><li>Right click on the name of your server, highlight new and choose Virtual Machine.</li><li>Specify the name e.g. Windows 10_1607, and you can change the location where VM will be saved if needed. Make sure the disk you’re going to use will have at least the amount of space you plan to use for your VM.</li><li>You can choose either generation, but I strongly recommend Generation 2 (which is supported for Windows 2012/8 onwards), generation 2 allows you to simulate UEFI, boot from SCSi adapters (which perform faster than IDE) and are power-failure proof.</li><li>Memory. Assign at least 2 GBs, if you can 4GBs. You can leave Dynamic memory tick on, however, it shouldn’t make any difference in this scenario.</li><li>In the configuring networking window, choose the Virtual Switch created earlier on, this will allow the VM to talk to the rest of the world.</li><li>Virtual disk – in other words, the special file which behaves like a hard drive. Probably you will only want to amend the size of, I find 60GB very minimum, but again, it’s entirely up to you.</li><li>The last step needed for the configuration is Installation option – in other words, pointing VM to the installation media. Simply choose the ISO downloaded earlier on.</li><li>On the Summary window, verify all the settings and hit finish if you’re happy with all of them.</li></ol><p>Hyper-V will create your VM now, you should be able to see it in the main Windows of the Hyper-V.</p><h1 id=windows-10-installation>Windows 10 installation<a hidden class=anchor aria-hidden=true href=#windows-10-installation>#</a></h1><p>Yes, we are just a step before installing, but hold your horses for a second, there’s one more point worth considering.</p><h2 id=audit-mode-or-oobe-mode>Audit mode or OOBE mode?<a hidden class=anchor aria-hidden=true href=#audit-mode-or-oobe-mode>#</a></h2><p>When you perform the standard installation of Windows, you simply boot to OOBE (Out of box experience) every single time. Then you go through the process of customising the installation and creating user account etc.</p><p>Audit mode is, on the other hand, a special mode dedicated to preparing Customised Windows image. It will e.g. automatically log in to the Administrator account, which will be removed once the work in the Audit mode has been finished. Changes made in the Audit mode will be then copied to every new user logging to the PC, which keeps the user experience. Yet working in the Audit mode is exactly identical like in OOBE.</p><p>You can even switch between OOBE/Audit modes once Windows 10 has been installed, but why not start from using Audit and simply keep using it, from the beginning?</p><p>Therefore it’s not required, but I’d recommend you to use the Audit mode for the image creation.</p><h2 id=let8217s-install-windows-10>Let’s install Windows 10!<a hidden class=anchor aria-hidden=true href=#let8217s-install-windows-10>#</a></h2><p>All the preparation will now pay off – you’ll be able to go and set up everything as desired, using the software which you’ve prepared earlier on.</p><p>As mentioned earlier, I’ll follow the Audit mode way and prepare my image in that way. The process of installing is almost the same for Audit and OOBE mode, however, I’m going to indicate the moment when you need to make the call.</p><ol><li>Start the VM.</li><li>On the screen “Press any key to boot”, press any key.</li><li>On the “Windows Setup” screen, choose Install now.</li><li>Now you’re going to be asked to provide a licence key. In case you don’t have it yet, you can simply skip this and provide the key later.</li><li>Choose the edition of Windows 10 which you’re going to install. I recon it’s going to be Pro, which will allow you, among other things, join the computer to the domain.</li><li>Once you are aware of the agreement content, tick the box and move forward.</li><li>Since this is a freshly created VM, its hard drive it’s literally empty. Therefore the only thing you can do now is to choose Custom: Install Windows only.</li><li>On the following screen just click next, Windows installer will partition the drive and utilise all space. Even if you’d need additional partitions, you’ll be able to order Windows to create them during the deployment process.</li></ol><p>The Windows installation starts now. It will take some time and reboots before reaching the next screen, on which you’ll need to make a decision about the mode used for installation.</p><p>The Audit mode trigger is hidden; you must use a keyboard shortcut to activate it.</p><p>Press simultaneously ALT + SHIFT + F3, after which VM will instantly restart and boot to audit mode shortly.</p><p>Windows will now automatically log in with Administrator’s account, and present you with SYSPREP (System Preparation Tool) window, which you’d like to cancel. The tool allows you to set Windows 10 back to OOBE mode generalise (which I’ll explain later on) and restart it. Just cancel it. It might be worth to take a check point at this moment.</p><h1 id=customise-the-image>Customise the image<a hidden class=anchor aria-hidden=true href=#customise-the-image>#</a></h1><p>Now it’s time to install all the software you need, but how to provide it? We could use so-called guest services and start copying all the installation files, but that would take first time to do so, secondly the size of the VHD would start growing.</p><p>Rather than that, let’s go good, old network sharing. Not only it will allow us to install folders without copying them all to the VM, but also will deliver the answer file, or will allow exporting e.g. customised menu start settings.</p><h2 id=create-the-network-share-on-your-host-machine>Create the network share on your host machine<a hidden class=anchor aria-hidden=true href=#create-the-network-share-on-your-host-machine>#</a></h2><p>Open the folder where you’re going to store all files needed by your VM.</p><ol><li>Open properties of the folder.</li><li>On the properties window, change tab to “Sharing” and choose “Advanced Sharing…”</li><li>Tick the box “Share this folder” and choose “Permissions”. You might note down the folder name as this will become the name of the actual share.</li><li>Grant full access to the account which is going to access the network share on your host machine. I granted access to Everyone.</li><li>Click OK twice and once backed to the properties window, change tab to “Security” and choose “Edit” button.</li><li>Click Add.</li><li>Type the same username which you’ve used in the Sharing permissions.</li><li>Grant “Allow – Modify” rights to the user. Click OK on all windows.</li></ol><p>You might ask why we’ve had grant access to the same user in 2 different places. Since this is not an article about shares and permissions I’ll keep it short – Windows differentiates 2 levels of access – local and networked. The user must have access locally to be able to access the files at all and locally, that is, while working on the actual computer. Networked access allows users to access the files over the network, and folders accessed that way are called shares.  In the case of when a user has only network rights, one still won’t be able to access the files because of the lack of the local permission.</p><h2 id=map-the-network-drive>Map the network drive<a hidden class=anchor aria-hidden=true href=#map-the-network-drive>#</a></h2><p>Once the network share has been created, it’s time to map it. That process is called mapping the network drive because ultimately it will show up alongside other drives – hard and flash disks and optical drives.</p><ol><li>Head towards “This computer.”</li><li>Choose “Computer” tab and click “Map network drive.”</li><li>On the following screen specify the location of the network share – the format is: <strong>\&lt;name of the share></strong>, the name of my host is KMLPRO and the name of the share is VM_installers therefore the full path will be: \KMLPRO\VM_installers.</li><li>Tick the box “Connect using different credentials”. You might also tick the box “Reconnect at sign-it”, that way Windows will store your login details to the server and automatically map the drive the next time you log in. Feel free to change the drive, if you’d like to.</li><li>You’ll be asked to provide details of the account which you’ve granted access rights earlier on.</li></ol><p>Once completed, you’ll find your mapped network drive alongside other drives in the computer view.</p><h2 id=install-the-software-customise-the-settings>Install the software, customise the settings<a hidden class=anchor aria-hidden=true href=#install-the-software-customise-the-settings>#</a></h2><p>Now you’ve got to the point where you can perform an installation of any software needed.</p><ul><li>Try to use officially released MSI files. In the case of updating the image later on, MSIs always make sure to get rid of the old version of the file and upgrade.</li><li>If possible, avoid launching the applications. It might amend some default settings which users might not like.</li><li>Install the latest .NetFramework (as well as other libraries) possible, that will save time, both your and your users.</li><li>Do not forget about the new Menu Start, you can pin applications often used by the users.</li></ul><p>Once you’ve completed the customisation process, take the checkpoint. Just in case.</p><h2 id=drivers-1>Drivers<a hidden class=anchor aria-hidden=true href=#drivers-1>#</a></h2><p>“Software comes and goes. Hardware is forever,” they said, but to make that hardware work, we need drivers.</p><h3 id=why-not-rely-on-the-internetwindows-updates>Why not rely on the Internet/Windows updates?<a hidden class=anchor aria-hidden=true href=#why-not-rely-on-the-internetwindows-updates>#</a></h3><p>The problem with drivers is that they often won’t install, unless there’s actual hardware present at the moment of installation. You can obviously rely on Windows Update and hope that everything will be self-installed, but do you really want to?</p><p>I personally cannot imagine deploying Windows to more than 10 computers and allowing them to go to Windows Update and start downloading, then wait for reboots etc. Nope, that doesn’t work like that in an enterprise.</p><p>Unless you’re in the situation where you can utilise Windows Update, then you can skip that part. But you’ll miss so much fun with having control of every single driver on the image.</p><h3 id=pnputil-8211-drivers8217-best-mate>PNPUTIL – Drivers’ best mate<a hidden class=anchor aria-hidden=true href=#pnputil-8211-drivers8217-best-mate>#</a></h3><p>Microsoft includes in the Windows a brilliant tool called PNPUTIL, which basically allows managing drivers and give you as the administrator the control over the drivers inside of the VM.</p><p>Have I mentioned that we will need to go command line? Oh well, now I’m telling you. But it won’t be scary, I promise. PNPUTIL is a command line only.</p><h4 id=main-pnputil-switches-which-you-should-know-about>Main PNPUTIL switches which you should know about:<a hidden class=anchor aria-hidden=true href=#main-pnputil-switches-which-you-should-know-about>#</a></h4><h4 id=driver-store-8211-what-is-this>Driver store – what is this?<a hidden class=anchor aria-hidden=true href=#driver-store-8211-what-is-this>#</a></h4><p>Windows comes with plenty of drivers out of the box – however, it’s impossible to include every single driver to every single device, or even make sure that all the drivers are up to date.</p><p>Therefore, here comes the idea of the Driver Store – think about it like installers for your software – you have the installer, but you install the software when it’s actually needed by the user.</p><p>Same happens with the hardware – when a new device is connected, Windows goes through the store and looks for the appropriate driver. That way we can load all needed drivers and Windows will use them only when they are needed. This is cool, isn’t it?</p><h4 id=let8217s-add-some-drivers>Let’s add some drivers!<a hidden class=anchor aria-hidden=true href=#let8217s-add-some-drivers>#</a></h4><p>If you’ve done a good job preparing your drivers (*.inf files) organising them into folders (e.g. C:\Temp\Drivers\Audio, C:\Temp\Drivers\Video etc.), then follow the instruction below. If not, go and organise them now.</p><ol><li>Go to the folder where your drivers are, press and hold the SHIFT ket + right-click the mouse and choose “Open command window here”.</li><li>Type “pnputil” and hit enter, familiarise yourself with the command details (for your own reference)</li><li>Type <strong>pnputil /enum-drivers</strong> and look how many drivers are needed. Since this is VM, there a just a few in use.</li><li>Type *<em>pnputil /add-driver <em>.inf /subdirs</em></em>. This will order pnputil to go through all the folders and add any driver it finds to the store. It might take a while depending on amount and size of drivers you’ve prepared.</li><li>Upon the completion, you’ll see how many drivers have been added to the store.</li></ol><p>This is it, that one step closer to the hardware neutral Windows image. Enumerate the drivers now, see how many has been added to the Drivers now. Don’t forget to take the checkpoint.</p><h1 id=unattended-installation>Unattended installation<a hidden class=anchor aria-hidden=true href=#unattended-installation>#</a></h1><p>Are we there yet? Yes, almost there!</p><p>Once you are happy with all customisations you’ve just done, it’s time to tell Windows, what to do during the installation. Why? To not get all that prompts about licencing, partitioning, the name of the computer and user etc. We are going to be like this bartender from the local pub, who knows us good enough to serve everything we like. Sounds cool? Keep it coming then!</p><p>I must admit, I was really impressed (like WOW impressed) when saw fully automatic Windows deployment for the first time in my life – from the beginning of the process – when Windows configured itself until it reached the Logon/Desktop screen.</p><h2 id=creating-wim-file>Creating WIM file<a hidden class=anchor aria-hidden=true href=#creating-wim-file>#</a></h2><p>Unattended installation means automatic installation – which is our goal. Essential part of it is the Answer file – the file which will tell Windows installer what to do during the installation. We obviously, are going to create are own answer file.</p><p>We are going to need WIM file, which is in short take, the actual compressed Windows – whenever you install Windows, it’s being decompressed and installed to the local hard disk. Where’s the file then? You’ve guessed it right, on the Windows 10 ISO, the same which we’ve used to install Windows 10 earlier on.</p><p>Microsoft started using ESD files to include Windows installation files, which are way more compressed than actual WIM files. Therefore first step is to copy the ESD file off the ISO, then convert it to the WIM file to finally use for the Answer file creation.</p><ol><li>Right click on the ISO which you’ve used to install the Windows 10, mount it.</li><li>ISO will show as ordinary DVD drive, open it and go to the “Sources” folder, and find <strong>install.esd</strong> file. It’s the biggest (approximately 4GBs) file over there. Copy the file off the image. I can suggest to create a dedicated folder where you’re going to store all ISOs used for installation and another folder called WIM where you’ll store WIM files. The reason behind is that you should always use the WIM file from ISO used for installation. Don’t forget about meaningful names.</li><li>We need elevated (administrator) command prompt, right click on the Windows menu and choose it then. Change directory to where the ISO is.</li><li>You can use DIR command to make sure you’re in the right folder and can see install.erd file.</li><li>Type command: <strong>dism /Get-WimInfo /WimFile:install.esd</strong> You should see the list of available Windows 10 edition included in the ISO. I’m going to need Pro edition therefore will choose Index:1</li><li>Type command: **dism /export-image /SourceImageFile:install.esd /SourceIndex:1 /DestinationImageFile:Windows10_pro_1607.wim /Compress:max /CheckIntegrity **I’ve highlighted the index number and the file name in case you’d like to change it.</li></ol><p>Wait until the process has finished and we can move on to the actual answer file creation. You’ll find the WIM file in the same location where ESD file is.</p><h2 id=answer-file>Answer File<a hidden class=anchor aria-hidden=true href=#answer-file>#</a></h2><p>It’s time to tell Windows off, literally. We’re going to prepare the answer file, which will guide Windows through the installation – and achieve automatic installation there.</p><p>There are tonnes of possible settings to configure, therefore I will focus on bringing you to the automated installation which you might use as the base for your answer file. Most of the settings are well documented which is a great help.</p><p>To create the answer file:</p><ol><li>Open Windows System Image Manager.</li><li>Press the “New Answer File” button.</li><li>Say yes to open the Windows Image file.</li><li>Point to the WIM file created earlier on.</li><li>Confirm creation of the catalog file.</li></ol><p>It will take a few minutes for SIM to complete the image creation process. Upon finish, you’ll be presented with the new SIM windows with more options than before.</p><p>Answer file reflects different Windows installation stages (passes) – there are 7 of them, however, we need only a few for our needs.</p><p>The components part contains the actual jobs that Windows Installer performs during different parts of the installation. One component can be added to multiple installation stages. Components are added by right-clicking on them and choosing to which part they need to be added.</p><p>Necessary components for automated installation:</p><p>Phase 1 WinPE:</p><ul><li>amd64_Microsoft-Windows-International-Core-WinPE</li><li>amd64_Microsoft-Windows-Setup</li></ul><p>Phase 4 Specialize:</p><ul><li>amd64_Microsoft-Windows-Shell-Setup</li></ul><p>Phase 7 OOBE</p><ul><li>amd64_Microsoft-Windows-International-Core</li><li>amd64_Microsoft-Windows-Shell-Setup</li></ul><p>I really wanted to describe all the components, meaning what you should type and where, but it would take way too much time and space. Instead, I’ll simply paste the answer file here and describe what it does in each phase.</p><p><a href=https://kamilpro.com/wp-content/uploads/2017/04/Windows_10_pro.xml>Answer file – Windows_10_pro.xml</a> (right click and dowload/save link as)</p><p>Use SIM to open the file above, and point to Windows 10 1607 WIM file.</p><h3 id=phase-1-winpe>Phase 1 WinPE<a hidden class=anchor aria-hidden=true href=#phase-1-winpe>#</a></h3><p>That one happens when you actually boot a computer from the installation media and are presented with the install now screen.</p><p>What happens in “amd64_Microsoft-Windows-International-Core-WinPE” is to choose which display language should be picked.</p><p>The “amd64_Microsoft-Windows-Setup” tells installer to wipe the first hard drive, then create 4 partitions (as needed for UEFI) and to modify them. While first 3 partitions are needed for Windows to run and have a fixed size, the 4th – where the actual OS is – will use all remaining space for itself.</p><h3 id=phase-4-specialize>Phase 4 Specialize<a hidden class=anchor aria-hidden=true href=#phase-4-specialize>#</a></h3><p>That phase happens when Windows is “Getting ready”. You can notice a CopyProfile option – it tells the installer to take Administrator’s profile (the same which you’ve customised earlier on in the Audit mode) and set it as the default profile – so that every profile created on the computer will have the same customisation.</p><p>The product key used here is generic Windows 10 Pro, you should change it to yours. You won’t be able to activate Windows with that key.</p><h3 id=phase-7-oobe>Phase 7 OOBE<a hidden class=anchor aria-hidden=true href=#phase-7-oobe>#</a></h3><p>OOBE – Out of box experience – is the Wizard which you see during the first Windows boot.</p><p>“amd64_Microsoft-Windows-International-Core” will tell the computer which language, region and keyboard layout will be used for the users.</p><p>“amd64_Microsoft-Windows-Shell-Setup” will accept the agreement, set Windows to get automatic Windows Updates and create local user “Dave” who will be an administrator. Notice that password field is hashed, therefore you should change it to yours.</p><h4 id=defaultuser0-bug>Defaultuser0 bug<a hidden class=anchor aria-hidden=true href=#defaultuser0-bug>#</a></h4><p>When at some point you’ll start testing/deploying the image, you might notice a 2nd user account created during the installation, called defaultuser0. It’s being created during the CopyProfile function, I couldn’t find an explanation why it happens.</p><p>We could switch off the CopyProfile, but then it would be necessary to spend a way more time with customising (including start menu, theme, wallpaper etc. would need to be set, configured with text files and exported – which is not really user friendly).</p><p>Or we could keep using CopyProfile and call a command “net user defaultuser0 /delete” during first user logon, which removes it automatically. I prefer the second option, which is included in the answer file.</p><h2 id=save-the-answer-file>Save the answer file<a hidden class=anchor aria-hidden=true href=#save-the-answer-file>#</a></h2><p>Once you’re happy with your answer file, save in the shared folder created earlier on.</p><h1 id=preparing-the-image-for-capturehousekeeping>Preparing the image for capture/housekeeping<a hidden class=anchor aria-hidden=true href=#preparing-the-image-for-capturehousekeeping>#</a></h1><p>We need to do some housekeeping to make the image clean and neat for the end user:</p><ul><li>Run Windows updates</li><li>Run antivirus updates</li><li>Remove all browsing history from Internet browsers</li><li>Unmount all mounted network drives</li><li>Right click on the address bar in Windows explorer and choose “Delete history”</li><li>Run disk clean up</li><li>Make sure there are no passwords saved in the Credential manager (Control panel>Credential Manager)</li><li>Remove any directories used during image preparation (e.g. C:\temp)</li></ul><p>In other words – when your users get freshly wiped PC, they’ll get an impression it’s spanking new, yet customised by their great IT department. It makes a difference, a huge difference to the end user.</p><h1 id=test-the-image-within-vm>Test the image within VM<a hidden class=anchor aria-hidden=true href=#test-the-image-within-vm>#</a></h1><p>That’s a great moment, isn’t it? I’m always excited when testing the new image and see how all the work turns out. But before deploying it to the actual physical machine, it’s worth to test it within the actual VM.</p><p>Why? Because due to checkpoints, it’s extremely easy to roll back the deployment, amend the setting and deploy once again. It’s a real time saver. Therefore, do not expect the image to be ready after the first time. My first attempt took about a week to get fully polished and prepared image.</p><h2 id=take-the-checkpoint-now>Take the checkpoint now<a hidden class=anchor aria-hidden=true href=#take-the-checkpoint-now>#</a></h2><p>Remember: if there’s something you don’t like after the deployment or test, you can always roll back, change the image and try once again (and don’t forget to take another checkpoint).</p><p>You can repeat that process until you’re fully satisfied with the result.</p><h2 id=sysprep-8211-the-tool-for-generalization>Sysprep – the tool for generalization<a hidden class=anchor aria-hidden=true href=#sysprep-8211-the-tool-for-generalization>#</a></h2><p>Generalise makes the image truly hardware neutral. It removes all installed drivers, Windows activation, unique installation details for the VM – it then allows computer to install completely fresh and setup itself for the new installation or another computer.</p><p>To generalise Windows installation you’d like to:</p><ol><li>Open elevated command prompt</li><li>Type: <strong>CD C:\Windows\System32\Sysprep</strong></li><li>Type: **SYSPREP /GENERALIZE /OOBE /REBOOT /UNATTEND: **We call sysprep tool to generalise the installation, set Windows into OOBE mode, use answer file and restart the PC.</li><li>Wait until the sysprep process is done and PC restart.</li></ol><p>Once completed, VM should restart a few times and – if everything goes well – bring you to the login screen. You’d like then to review all your customisation settings, make sure that passwords are not saved etc. Remember that whatever you can see after the first login, will be available to any new user using the computer.</p><h1 id=capturing-and-deploying-the-image>Capturing and deploying the image<a hidden class=anchor aria-hidden=true href=#capturing-and-deploying-the-image>#</a></h1><p>Once your VM is up to the standard it’s time to send it to the actual hardware and see if everything still works + all drivers are working.</p><p>However, it’s beyond this article as there are many tools which can be used. If you’ve got any favourite tools which can get the job done – let me know!</p><h1 id=a-few-tips>A few tips:<a hidden class=anchor aria-hidden=true href=#a-few-tips>#</a></h1><ul><li>Always take the checkpoint before syspreping. Windows has a sysprep counter, and after generalising an image few times it will not allow you to generalise it another! This means you’d need to create another image from the scratch. On the other hand, if you’ve got a VM with checkpoint just before sysprep, you can always come back to it, amend it, checkpoint it and sysprep again, unlimited number of times.</li><li>If there are too many checkpoints (and not enough hard disk space), you can always remove all of them and create a new one.</li><li>Creating the image is a long process – take your time!</li></ul><p>Main photo by: https://unsplash.com/@rawpixel</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://kamilpro.com/tags/1607/>1607</a></li><li><a href=https://kamilpro.com/tags/answer/>Answer</a></li><li><a href=https://kamilpro.com/tags/deployment/>Deployment</a></li><li><a href=https://kamilpro.com/tags/feat/>Feat</a></li><li><a href=https://kamilpro.com/tags/image/>Image</a></li><li><a href=https://kamilpro.com/tags/sysprep/>Sysprep</a></li><li><a href=https://kamilpro.com/tags/unattend/>Unattend</a></li><li><a href=https://kamilpro.com/tags/windows-10/>Windows 10</a></li></ul><nav class=paginav><a class=prev href=https://kamilpro.com/why-saturday-is-best-to-start-new-hobby/><span class=title>« Prev</span><br><span>Why Saturday is best to start new hobby.</span>
</a><a class=next href=https://kamilpro.com/do-you-even-back-up/><span class=title>Next »</span><br><span>Do you even back up?</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share How to prepare Windows 10 1607 image on x" href="https://x.com/intent/tweet/?text=How%20to%20prepare%20Windows%2010%201607%20image&amp;url=https%3a%2f%2fkamilpro.com%2fprepare-windows-10-1607-image%2f&amp;hashtags=1607%2canswer%2cdeployment%2cfeat%2cimage%2csysprep%2cunattend%2cwindows10"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share How to prepare Windows 10 1607 image on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fkamilpro.com%2fprepare-windows-10-1607-image%2f&amp;title=How%20to%20prepare%20Windows%2010%201607%20image&amp;summary=How%20to%20prepare%20Windows%2010%201607%20image&amp;source=https%3a%2f%2fkamilpro.com%2fprepare-windows-10-1607-image%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share How to prepare Windows 10 1607 image on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fkamilpro.com%2fprepare-windows-10-1607-image%2f&title=How%20to%20prepare%20Windows%2010%201607%20image"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share How to prepare Windows 10 1607 image on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fkamilpro.com%2fprepare-windows-10-1607-image%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share How to prepare Windows 10 1607 image on whatsapp" href="https://api.whatsapp.com/send?text=How%20to%20prepare%20Windows%2010%201607%20image%20-%20https%3a%2f%2fkamilpro.com%2fprepare-windows-10-1607-image%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share How to prepare Windows 10 1607 image on telegram" href="https://telegram.me/share/url?text=How%20to%20prepare%20Windows%2010%201607%20image&amp;url=https%3a%2f%2fkamilpro.com%2fprepare-windows-10-1607-image%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share How to prepare Windows 10 1607 image on ycombinator" href="https://news.ycombinator.com/submitlink?t=How%20to%20prepare%20Windows%2010%201607%20image&u=https%3a%2f%2fkamilpro.com%2fprepare-windows-10-1607-image%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://kamilpro.com/>Kamil Pro</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>