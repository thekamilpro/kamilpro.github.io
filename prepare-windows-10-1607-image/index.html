<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>How to prepare Windows 10 1607 image - Kamil Pro</title><meta name=Description content="Sysadmin's point of view"><meta property="og:title" content="How to prepare Windows 10 1607 image"><meta property="og:description" content="Sooner or later every company will come to the point when using standard Windows image is just not enough. Manual installation, fetching all updates or installing software etc. etc. takes time, and in IT, we really can use that time for something way more productive."><meta property="og:type" content="article"><meta property="og:url" content="https://kamilpro.github.io/prepare-windows-10-1607-image/"><meta property="og:image" content="https://kamilpro.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-04-03T22:35:09+00:00"><meta property="article:modified_time" content="2022-01-03T19:48:21+00:00"><meta property="og:site_name" content="My cool site"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kamilpro.github.io/logo.png"><meta name=twitter:title content="How to prepare Windows 10 1607 image"><meta name=twitter:description content="Sooner or later every company will come to the point when using standard Windows image is just not enough. Manual installation, fetching all updates or installing software etc. etc. takes time, and in IT, we really can use that time for something way more productive."><meta name=application-name content="Kamil Pro"><meta name=apple-mobile-web-app-title content="Kamil Pro"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://kamilpro.github.io/prepare-windows-10-1607-image/><link rel=prev href=https://kamilpro.github.io/do-you-even-back-up/><link rel=next href=https://kamilpro.github.io/why-saturday-is-best-to-start-new-hobby/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><meta name=google-site-verification content="NniR9DFiwo_hSUsjXQj7xw3IHmRtl0ICeu4UmstK680"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"How to prepare Windows 10 1607 image","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/kamilpro.github.io\/prepare-windows-10-1607-image\/"},"image":["https:\/\/kamilpro.github.io\/images\/Apple-Devices-Preview.png"],"genre":"posts","keywords":"1607, answer, deployment, feat, image, sysprep, unattend, windows 10","wordcount":4987,"url":"https:\/\/kamilpro.github.io\/prepare-windows-10-1607-image\/","datePublished":"2017-04-03T22:35:09+00:00","dateModified":"2022-01-03T19:48:21+00:00","license":"Kamil Procyszyn","publisher":{"@type":"Organization","name":"Kamil Pro","logo":{"@type":"ImageObject","url":"https:\/\/kamilpro.github.io\/images\/avatar.png","width":150,"height":150}},"author":{"@type":"Person","name":"Kamil"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Kamil Pro">Kamil Pro<span class=header-title-post><i class='fas fa-terminal'></i></span></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href="https://www.youtube.com/playlist?list=PL-esmhgrps8Zv9bAHesStPRQ1AiUL1wY3" rel="noopener noreffer" target=_blank>About PowerShell </a><a class=menu-item href=/powershell-for-it-professionals/>Powershell for IT professionals </a><a class=menu-item href=/about/>About </a><a class=menu-item href=https://github.com/thekamilpro title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw'></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Kamil Pro">Kamil Pro<span class=header-title-post><i class='fas fa-terminal'></i></span></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href="https://www.youtube.com/playlist?list=PL-esmhgrps8Zv9bAHesStPRQ1AiUL1wY3" title rel="noopener noreffer" target=_blank>About PowerShell</a><a class=menu-item href=/powershell-for-it-professionals/ title>Powershell for IT professionals</a><a class=menu-item href=/about/ title>About</a><a class=menu-item href=https://github.com/thekamilpro title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw'></i></a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">How to prepare Windows 10 1607 image</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Kamil</a></span>&nbsp;<span class=post-category>included in <a href=/categories/deployment/><i class="far fa-folder fa-fw" aria-hidden=true></i>Deployment</a>&nbsp;<a href=/categories/it/><i class="far fa-folder fa-fw" aria-hidden=true></i>IT</a>&nbsp;<a href=/categories/windows/><i class="far fa-folder fa-fw" aria-hidden=true></i>Windows</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2017-04-03>2017-04-03</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;4987 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;24 minutes&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/wp-content/uploads/2017/04/rawpixel-com-196509.jpg data-srcset="/wp-content/uploads/2017/04/rawpixel-com-196509.jpg, /wp-content/uploads/2017/04/rawpixel-com-196509.jpg 1.5x, /wp-content/uploads/2017/04/rawpixel-com-196509.jpg 2x" data-sizes=auto alt=/wp-content/uploads/2017/04/rawpixel-com-196509.jpg title=/wp-content/uploads/2017/04/rawpixel-com-196509.jpg></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#windows-10-iso-file>Windows 10 ISO file</a></li><li><a href=#windows-adk>Windows ADK</a></li><li><a href=#hypervisor>Hypervisor</a></li><li><a href=#software>Software</a></li><li><a href=#drivers>Drivers</a></li></ul><ul><li><a href=#create-vm--virtual-switch-for-vm>Create VM + Virtual Switch for VM</a><ul><li><a href=#creating-virtual-switch>Creating Virtual Switch</a></li><li><a href=#creating-virtual-machine>Creating Virtual Machine</a></li></ul></li></ul><ul><li><a href=#audit-mode-or-oobe-mode>Audit mode or OOBE mode?</a></li><li><a href=#let8217s-install-windows-10>Let’s install Windows 10!</a></li></ul><ul><li><a href=#create-the-network-share-on-your-host-machine>Create the network share on your host machine</a></li><li><a href=#map-the-network-drive>Map the network drive</a></li><li><a href=#install-the-software-customise-the-settings>Install the software, customise the settings</a></li><li><a href=#drivers-1>Drivers</a><ul><li><a href=#why-not-rely-on-the-internetwindows-updates>Why not rely on the Internet/Windows updates?</a></li><li><a href=#pnputil-8211-drivers8217-best-mate>PNPUTIL – Drivers’ best mate</a><ul><li><a href=#main-pnputil-switches-which-you-should-know-about>Main PNPUTIL switches which you should know about:</a></li><li><a href=#driver-store-8211-what-is-this>Driver store – what is this?</a></li><li><a href=#let8217s-add-some-drivers>Let’s add some drivers!</a></li></ul></li></ul></li></ul><ul><li><a href=#creating-wim-file>Creating WIM file</a></li><li><a href=#answer-file>Answer File</a><ul><li><a href=#phase-1-winpe>Phase 1 WinPE</a></li><li><a href=#phase-4-specialize>Phase 4 Specialize</a></li><li><a href=#phase-7-oobe>Phase 7 OOBE</a><ul><li><a href=#defaultuser0-bug>Defaultuser0 bug</a></li></ul></li></ul></li><li><a href=#save-the-answer-file>Save the answer file</a></li></ul><ul><li><a href=#take-the-checkpoint-now>Take the checkpoint now</a></li><li><a href=#sysprep-8211-the-tool-for-generalization>Sysprep – the tool for generalization</a></li></ul></nav></div></div><div class=content id=content><p>Sooner or later every company will come to the point when using standard Windows image is just not enough. Manual installation, fetching all updates or installing software etc. etc. takes time, and in IT, we really can use that time for something way more productive.</p><p>Therefore, I propose you to create your very own, customised, Windows 10 image which will save you tonnes of time.</p><p>Let’s set some goals:</p><ul><li>Automatic installation – no questions about user accounts, settings etc.</li><li>Hardware neutral – image will be installable on any kind of computer with necessary drivers equipped within.</li><li>Customised – image will be shipped with software and other preferences so that employees will be able to “just” log in straight after deployment.</li></ul><p>Sounds good? So let’s start preparing.</p><h1 id=prepare-for-windows-10-image-creation>Prepare for Windows 10 image creation</h1><p>I know you’d like to just jump in and start creating the new image, but to prepare the image properly there are necessary setup steps needed before the actual process. The benefits of this preparing will come handy in the future.</p><p>What you’re going to need is:</p><ul><li>PC capable of virtualisation – Since the image creation will happen in VM (Virtual Machine), we need hardware capable of this. If you’ve got a dedicated machine already – that’s great – if not, then any computer manufactured within the last few years, which can afford at least 2GBs of memory for virtualisation (you can assign less than 2GBs of memory, but everything will be slow. Like really, slow)  and hard disk space – only you know how much space you’re going to use for this task. However, bare in mind you should allow extra space for the checkpoints. If you can afford to use SSD that’s great – it hugely improves the speed of the process.</li><li>Windows 10 ISO file  – you’d need this to install the actual image and to create so-called “answer” file out of it.</li><li>Windows ADK – this will be used for creating the answer file.</li><li>Hypervisor with checkpoint function – this will allow us to create a VM with the actual image, while checkpoints can save plenty of time in case something goes wrong or must be amended.</li><li>Software and customisation files which are going to be shipped with Windows.</li><li>Drivers.</li><li>Internet – not necessary, but really helpful.</li></ul><p>As long as you’ve got the hardware capable of virtualisation, the rest comes from the Internet, or your software repositories.</p><h2 id=windows-10-iso-file>Windows 10 ISO file</h2><p>The fastest way of getting the Windows 10 ISO file is to go to: <a href=https://www.microsoft.com/en-gb/software-download/windows10ISO target=_blank rel="noopener noreffer">https://www.microsoft.com/en-gb/software-download/windows10ISO</a> or google “Windows Media Creation Tool”. Once on the website, pick “Windows 10” from the drop down menu (unless you’ve got licence for a different version). If your company happens to have a volume licence with Microsoft, then expand “More Download Options” where you can find links to MSDN websites.</p><p>When using Media Creation Tool, make sure to pick *.ISO file during the process. The file will be later on used in both, hypervisor and answer file.</p><p>Do not try to obtain images from any other, unofficial sources, as there’s always a chance of getting something “extra” from dishonest people. Nobody likes “extras” in Windows images.</p><h2 id=windows-adk>Windows ADK</h2><p><a href=https://developer.microsoft.com/en-us/windows/hardware/windows-assessment-deployment-kit target=_blank rel="noopener noreffer">https://developer.microsoft.com/en-us/windows/hardware/windows-assessment-deployment-kit</a></p><p>Windows  ADK (Assessment and Deployment Kit) is a set of tools required for image customisation and checking the performance of the computer. You need to fetch the version corresponding to the Windows image creation, as of writing this article, the newest version is Windows 10, version 1607.</p><p>Start the downloaded file, and upon the choice you need only 2 out of all:</p><ul><li>Deployment tools – SIM (Windows System Image Manager) – this tool is used to create the answer file, which will allow for automatic installation of Windows.</li><li>Windows PE (Preinstallation Environment) – will be used for capturing the image. Unless you’ve got other solution in place (e.g. Norton Ghost) this tool is necessary.</li></ul><h2 id=hypervisor>Hypervisor</h2><p>The customised image will be created within the VM and therefore hypervisor is essential to it. The second requirement are snapshots, which will allow us to roll back any wrong changes, as well as re-use the image for any amendments/updates required after creating the initial image.</p><blockquote><p>Snapshot = Checkpoint. These words can be used interchangeably.</p></blockquote><p>I can only think about 2 free options here – first is Microsoft Hyper-V, which comes built in Windows 8 or 10 in Pro edition, or any Windows Server since 2008 version. If you don’t have a such a possibility, you can use VirtualBox, which is free and has desired checkpoints functionality. Obviously, any hypervisor with checkpoints feature should do the trick.</p><p>I’ll be using Hyper-V since I’ve got Windows 10 Pro in my setup. To install Hyper-V on either Windows client or Server, make sure that Virtualization is enabled in your BIOS/UEFI setting, this is often called Intel VT, AMD-V or simply Virtualization Technology.</p><p>In order to instal Hyper-V in Windows Clients, go to Control Panel>Programs and Features>Turn Windows features on or off. Then expand Hyper-V menu and make sure that you can tick Hyper-V Management Tools and Hyper-v Platform. You will need to reboot the PC for the role to become active.</p><p>In Windows Server, you will need to add Hyper-V role to the server and reboot the server afterwards.</p><h2 id=software>Software</h2><p>It might be any sort of installer or even copy-paste type of application. If it works with the standard Windows installation, it should work with the customised image.</p><p>Customised files – this will be any specific wallpapers, files etc. which are used to brand the image.</p><h2 id=drivers>Drivers</h2><p>Since Windows 10 is shipped with plenty of drivers out of box, there are still many propetiary ones which must be either downloaded via WU (Windows Update) or installed manually. If your environment does not allow/provide drivers download via Windows Update, you must add them to the image.</p><p><a href=https://kamilpro.com/add-any-drivers-to-windows-on-example-of-gpu-drivers/ target=_blank rel="noopener noreferrer">I did write a whole blog of how to add any drivers to the image.</a></p><p>In other words, you need drivers with *.inf files, some manufacturers allow you to download the whole package of *.inf files for a computer series, some don’t. In such a case, you might need to unpack the drivers manually to get *.inf files out of it.</p><h1 id=prepare-the-environment-for-windows-10-image>Prepare the environment for Windows 10 image</h1><p>I hope you’re still bearing with me to this point, the most boring parts is behind us – I mean gathering all the stuff needed for the image creation.</p><p>Let’s look up the steps to follow:</p><ul><li>Create VM</li><li>Install Windows</li><li>Put set Windows into Audit mode</li><li>Install software</li><li>Add drivers</li><li>Customise Menu Start</li><li>Creating answer file</li><li>Testing the image</li></ul><p>Shall we begin?</p><h2 id=create-vm--virtual-switch-for-vm>Create VM + Virtual Switch for VM</h2><p>VM will need a connection to the local network as well as the Internet. Therefore we need to create a virtual switch to which the VM is going to be connected.</p><h3 id=creating-virtual-switch>Creating Virtual Switch</h3><p>To create a virtual switch you need to:</p><ol><li>Virtual Switch manager</li><li>Highlight new virtual switch, pick “External”, and click Create Virtual Switch</li><li>Give it meaningful name e.g. Internet, make sure that External radius is ticked and choose the network card which used to connect to the Internet, click OK.</li><li>The network switch is being created.</li></ol><p>Once your virtual switch has been created, we can start creating the new VM and use the switch to connect VM to the Internet.</p><p class="jetpack-slideshow-noscript robots-nocontent">This slideshow requires JavaScript.</p><div id=gallery-774-1-slideshow class="slideshow-window jetpack-slideshow slideshow-black" data-trans=fade data-autostart=1 data-gallery='[{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Virtual-Switch-1.png","id":"892","title":"Virtual Switch 1","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Virtual-Switch-2.png","id":"893","title":"Virtual Switch 2","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Virtual-Switch-3.png","id":"894","title":"Virtual Switch 3","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Virtual-Switch-4.png","id":"895","title":"Virtual Switch 4","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Virtual-Switch-5.png","id":"896","title":"Virtual Switch 5","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Virtual-Switch-6.png","id":"897","title":"Virtual Switch 6","alt":"","caption":"","itemprop":"image"}]' itemscope itemtype=https://schema.org/ImageGallery></div><h3 id=creating-virtual-machine>Creating Virtual Machine</h3><p>Now it’s time to create our virtual computer – a place where a customised image will be created, maintained and captured! Are you excited, like me?</p><ol><li>Right click on the name of your server, highlight new and choose Virtual Machine.</li><li>Specify the name e.g. Windows 10_1607, and you can change the location where VM will be saved if needed. Make sure the disk you’re going to use will have at least the amount of space you plan to use for your VM.</li><li>You can choose either generation, but I strongly recommend Generation 2 (which is supported for Windows 2012/8 onwards), generation 2 allows you to simulate UEFI, boot from SCSi adapters (which perform faster than IDE) and are power-failure proof.</li><li>Memory. Assign at least 2 GBs, if you can 4GBs. You can leave Dynamic memory tick on, however, it shouldn’t make any difference in this scenario.</li><li>In the configuring networking window, choose the Virtual Switch created earlier on, this will allow the VM to talk to the rest of the world.</li><li>Virtual disk – in other words, the special file which behaves like a hard drive. Probably you will only want to amend the size of, I find 60GB very minimum, but again, it’s entirely up to you.</li><li>The last step needed for the configuration is Installation option – in other words, pointing VM to the installation media. Simply choose the ISO downloaded earlier on.</li><li>On the Summary window, verify all the settings and hit finish if you’re happy with all of them.</li></ol><p>Hyper-V will create your VM now, you should be able to see it in the main Windows of the Hyper-V.</p><p class="jetpack-slideshow-noscript robots-nocontent">This slideshow requires JavaScript.</p><div id=gallery-774-2-slideshow class="slideshow-window jetpack-slideshow slideshow-black" data-trans=fade data-autostart=1 data-gallery='[{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/VM-Create-1.jpg","id":"911","title":"VM Create 1","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/VM-Create-2.jpg","id":"912","title":"VM Create 2","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/VM-Create-3.jpg","id":"913","title":"VM Create 3","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/VM-Create-4.jpg","id":"914","title":"VM Create 4","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/VM-Create-5.jpg","id":"915","title":"VM Create 5","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/VM-Create-6.jpg","id":"916","title":"VM Create 6","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/VM-Create-7.jpg","id":"917","title":"VM Create 7","alt":"","caption":"","itemprop":"image"}]' itemscope itemtype=https://schema.org/ImageGallery></div><h1 id=windows-10-installation>Windows 10 installation</h1><p>Yes, we are just a step before installing, but hold your horses for a second, there’s one more point worth considering.</p><h2 id=audit-mode-or-oobe-mode>Audit mode or OOBE mode?</h2><p>When you perform the standard installation of Windows, you simply boot to OOBE (Out of box experience) every single time. Then you go through the process of customising the installation and creating user account etc.</p><p>Audit mode is, on the other hand, a special mode dedicated to preparing Customised Windows image. It will e.g. automatically log in to the Administrator account, which will be removed once the work in the Audit mode has been finished. Changes made in the Audit mode will be then copied to every new user logging to the PC, which keeps the user experience. Yet working in the Audit mode is exactly identical like in OOBE.</p><p>You can even switch between OOBE/Audit modes once Windows 10 has been installed, but why not start from using Audit and simply keep using it, from the beginning?</p><p>Therefore it’s not required, but I’d recommend you to use the Audit mode for the image creation.</p><h2 id=let8217s-install-windows-10>Let’s install Windows 10!</h2><p>All the preparation will now pay off – you’ll be able to go and set up everything as desired, using the software which you’ve prepared earlier on.</p><p>As mentioned earlier, I’ll follow the Audit mode way and prepare my image in that way. The process of installing is almost the same for Audit and OOBE mode, however, I’m going to indicate the moment when you need to make the call.</p><ol><li>Start the VM.</li><li>On the screen “Press any key to boot”, press any key.</li><li>On the “Windows Setup” screen, choose Install now.</li><li>Now you’re going to be asked to provide a licence key. In case you don’t have it yet, you can simply skip this and provide the key later.</li><li>Choose the edition of Windows 10 which you’re going to install. I recon it’s going to be Pro, which will allow you, among other things, join the computer to the domain.</li><li>Once you are aware of the agreement content, tick the box and move forward.</li><li>Since this is a freshly created VM, its hard drive it’s literally empty. Therefore the only thing you can do now is to choose Custom: Install Windows only.</li><li>On the following screen just click next, Windows installer will partition the drive and utilise all space. Even if you’d need additional partitions, you’ll be able to order Windows to create them during the deployment process.</li></ol><p class="jetpack-slideshow-noscript robots-nocontent">This slideshow requires JavaScript.</p><div id=gallery-774-3-slideshow class="slideshow-window jetpack-slideshow slideshow-black" data-trans=fade data-autostart=1 data-gallery='[{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Windows-10-installation-1.jpg","id":"925","title":"Windows 10 installation 1","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Windows-10-installation-2.jpg","id":"926","title":"Windows 10 installation 2","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Windows-10-installation-3.jpg","id":"927","title":"Windows 10 installation 3","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Windows-10-installation-4.jpg","id":"928","title":"Windows 10 installation 4","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Windows-10-installation-5.jpg","id":"929","title":"Windows 10 installation 5","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Windows-10-installation-7.jpg","id":"930","title":"Windows 10 installation 7","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Windows-10-installation-8.jpg","id":"931","title":"Windows 10 installation 8","alt":"","caption":"","itemprop":"image"}]' itemscope itemtype=https://schema.org/ImageGallery></div><p>The Windows installation starts now. It will take some time and reboots before reaching the next screen, on which you’ll need to make a decision about the mode used for installation.</p><p>The Audit mode trigger is hidden; you must use a keyboard shortcut to activate it.</p><p>Press simultaneously ALT + SHIFT + F3, after which VM will instantly restart and boot to audit mode shortly.</p><p>Windows will now automatically log in with Administrator’s account, and present you with SYSPREP (System Preparation Tool) window, which you’d like to cancel. The tool allows you to set Windows 10 back to OOBE mode generalise (which I’ll explain later on) and restart it. Just cancel it. It might be worth to take a check point at this moment.</p><p class="jetpack-slideshow-noscript robots-nocontent">This slideshow requires JavaScript.</p><div id=gallery-774-4-slideshow class="slideshow-window jetpack-slideshow slideshow-black" data-trans=fade data-autostart=1 data-gallery='[{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Windows-10-installation-9.jpg","id":"934","title":"Windows 10 installation 9","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Audit-mode-1.jpg","id":"933","title":"Audit mode 1","alt":"","caption":"","itemprop":"image"}]' itemscope itemtype=https://schema.org/ImageGallery></div><h1 id=customise-the-image>Customise the image</h1><p>Now it’s time to install all the software you need, but how to provide it? We could use so-called guest services and start copying all the installation files, but that would take first time to do so, secondly the size of the VHD would start growing.</p><p>Rather than that, let’s go good, old network sharing. Not only it will allow us to install folders without copying them all to the VM, but also will deliver the answer file, or will allow exporting e.g. customised menu start settings.</p><h2 id=create-the-network-share-on-your-host-machine>Create the network share on your host machine</h2><p>Open the folder where you’re going to store all files needed by your VM.</p><ol><li>Open properties of the folder.</li><li>On the properties window, change tab to “Sharing” and choose “Advanced Sharing…”</li><li>Tick the box “Share this folder” and choose “Permissions”. You might note down the folder name as this will become the name of the actual share.</li><li>Grant full access to the account which is going to access the network share on your host machine. I granted access to Everyone.</li><li>Click OK twice and once backed to the properties window, change tab to “Security” and choose “Edit” button.</li><li>Click Add.</li><li>Type the same username which you’ve used in the Sharing permissions.</li><li>Grant “Allow – Modify” rights to the user. Click OK on all windows.</li></ol><p class="jetpack-slideshow-noscript robots-nocontent">This slideshow requires JavaScript.</p><div id=gallery-774-5-slideshow class="slideshow-window jetpack-slideshow slideshow-black" data-trans=fade data-autostart=1 data-gallery='[{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Network-Share-1.jpg","id":"938","title":"Network Share 1","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Network-Share-2.jpg","id":"939","title":"Network Share 2","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Network-Share-3.jpg","id":"940","title":"Network Share 3","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Network-Share-4.jpg","id":"941","title":"Network Share 4","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Network-Share-5.jpg","id":"942","title":"Network Share 5","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Network-Share-6.jpg","id":"943","title":"Network Share 6","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Network-Share-7.jpg","id":"944","title":"Network Share 7","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Network-Share-8.jpg","id":"945","title":"Network Share 8","alt":"","caption":"","itemprop":"image"}]' itemscope itemtype=https://schema.org/ImageGallery></div><p>You might ask why we’ve had grant access to the same user in 2 different places. Since this is not an article about shares and permissions I’ll keep it short – Windows differentiates 2 levels of access – local and networked. The user must have access locally to be able to access the files at all and locally, that is, while working on the actual computer. Networked access allows users to access the files over the network, and folders accessed that way are called shares.  In the case of when a user has only network rights, one still won’t be able to access the files because of the lack of the local permission.</p><h2 id=map-the-network-drive>Map the network drive</h2><p>Once the network share has been created, it’s time to map it. That process is called mapping the network drive because ultimately it will show up alongside other drives – hard and flash disks and optical drives.</p><ol><li>Head towards “This computer.”</li><li>Choose “Computer” tab and click “Map network drive.”</li><li>On the following screen specify the location of the network share – the format is: <strong>\<name of the host>&lt;name of the share></strong>, the name of my host is KMLPRO and the name of the share is VM_installers therefore the full path will be: \KMLPRO\VM_installers.</li><li>Tick the box “Connect using different credentials”. You might also tick the box “Reconnect at sign-it”, that way Windows will store your login details to the server and automatically map the drive the next time you log in. Feel free to change the drive, if you’d like to.</li><li>You’ll be asked to provide details of the account which you’ve granted access rights earlier on.</li></ol><p class="jetpack-slideshow-noscript robots-nocontent">This slideshow requires JavaScript.</p><div id=gallery-774-6-slideshow class="slideshow-window jetpack-slideshow slideshow-black" data-trans=fade data-autostart=1 data-gallery='[{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Mapping-network-drive-1.jpg","id":"947","title":"Mapping network drive 1","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Mapping-network-drive-2.jpg","id":"948","title":"Mapping network drive 2","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Mapping-network-drive-3.jpg","id":"963","title":"Mapping network drive 3","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Mapping-network-drive-4.jpg","id":"964","title":"Mapping network drive 4","alt":"","caption":"","itemprop":"image"}]' itemscope itemtype=https://schema.org/ImageGallery></div><p>Once completed, you’ll find your mapped network drive alongside other drives in the computer view.</p><h2 id=install-the-software-customise-the-settings>Install the software, customise the settings</h2><p>Now you’ve got to the point where you can perform an installation of any software needed.</p><ul><li>Try to use officially released MSI files. In the case of updating the image later on, MSIs always make sure to get rid of the old version of the file and upgrade.</li><li>If possible, avoid launching the applications. It might amend some default settings which users might not like.</li><li>Install the latest .NetFramework (as well as other libraries) possible, that will save time, both your and your users.</li><li>Do not forget about the new Menu Start, you can pin applications often used by the users.</li></ul><p>Once you’ve completed the customisation process, take the checkpoint. Just in case.</p><h2 id=drivers-1>Drivers</h2><p>“Software comes and goes. Hardware is forever,” they said, but to make that hardware work, we need drivers.</p><h3 id=why-not-rely-on-the-internetwindows-updates>Why not rely on the Internet/Windows updates?</h3><p>The problem with drivers is that they often won’t install, unless there’s actual hardware present at the moment of installation. You can obviously rely on Windows Update and hope that everything will be self-installed, but do you really want to?</p><p>I personally cannot imagine deploying Windows to more than 10 computers and allowing them to go to Windows Update and start downloading, then wait for reboots etc. Nope, that doesn’t work like that in an enterprise.</p><p>Unless you’re in the situation where you can utilise Windows Update, then you can skip that part. But you’ll miss so much fun with having control of every single driver on the image.</p><h3 id=pnputil-8211-drivers8217-best-mate>PNPUTIL – Drivers’ best mate</h3><p>Microsoft includes in the Windows a brilliant tool called PNPUTIL, which basically allows managing drivers and give you as the administrator the control over the drivers inside of the VM.</p><p>Have I mentioned that we will need to go command line? Oh well, now I’m telling you. But it won’t be scary, I promise. PNPUTIL is a command line only.</p><h4 id=main-pnputil-switches-which-you-should-know-about>Main PNPUTIL switches which you should know about:</h4><pre>/enum-drivers - enumarates (lists) all stored drivers
/add-driver - adds driver to the driver store
/delete-driver - removes the driver from the driver store</pre><h4 id=driver-store-8211-what-is-this>Driver store – what is this?</h4><p>Windows comes with plenty of drivers out of the box – however, it’s impossible to include every single driver to every single device, or even make sure that all the drivers are up to date.</p><p>Therefore, here comes the idea of the Driver Store – think about it like installers for your software – you have the installer, but you install the software when it’s actually needed by the user.</p><p>Same happens with the hardware – when a new device is connected, Windows goes through the store and looks for the appropriate driver. That way we can load all needed drivers and Windows will use them only when they are needed. This is cool, isn’t it?</p><h4 id=let8217s-add-some-drivers>Let’s add some drivers!</h4><p>If you’ve done a good job preparing your drivers (*.inf files) organising them into folders (e.g. C:\Temp\Drivers\Audio, C:\Temp\Drivers\Video etc.), then follow the instruction below. If not, go and organise them now.</p><ol><li>Go to the folder where your drivers are, press and hold the SHIFT ket + right-click the mouse and choose “Open command window here”.</li><li>Type “pnputil” and hit enter, familiarise yourself with the command details (for your own reference)</li><li>Type <strong>pnputil /enum-drivers</strong> and look how many drivers are needed. Since this is VM, there a just a few in use.</li><li>Type *<em>pnputil /add-driver <em>.inf /subdirs</em></em>. This will order pnputil to go through all the folders and add any driver it finds to the store. It might take a while depending on amount and size of drivers you’ve prepared.</li><li>Upon the completion, you’ll see how many drivers have been added to the store.</li></ol><p class="jetpack-slideshow-noscript robots-nocontent">This slideshow requires JavaScript.</p><div id=gallery-774-7-slideshow class="slideshow-window jetpack-slideshow slideshow-black" data-trans=fade data-autostart=1 data-gallery='[{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/PNPUTIL-1.jpg","id":"965","title":"PNPUTIL 1","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/PNPUTIL-2.jpg","id":"966","title":"PNPUTIL 2","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/PNPUTIL-3.jpg","id":"967","title":"PNPUTIL 3","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/PNPUTIL-4.jpg","id":"968","title":"PNPUTIL 4","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/PNPUTIL-5.jpg","id":"969","title":"PNPUTIL 5","alt":"","caption":"","itemprop":"image"}]' itemscope itemtype=https://schema.org/ImageGallery></div><p>This is it, that one step closer to the hardware neutral Windows image. Enumerate the drivers now, see how many has been added to the Drivers now. Don’t forget to take the checkpoint.</p><h1 id=unattended-installation>Unattended installation</h1><p>Are we there yet? Yes, almost there!</p><p>Once you are happy with all customisations you’ve just done, it’s time to tell Windows, what to do during the installation. Why? To not get all that prompts about licencing, partitioning, the name of the computer and user etc. We are going to be like this bartender from the local pub, who knows us good enough to serve everything we like. Sounds cool? Keep it coming then!</p><p>I must admit, I was really impressed (like WOW impressed) when saw fully automatic Windows deployment for the first time in my life – from the beginning of the process – when Windows configured itself until it reached the Logon/Desktop screen.</p><h2 id=creating-wim-file>Creating WIM file</h2><p>Unattended installation means automatic installation – which is our goal. Essential part of it is the Answer file – the file which will tell Windows installer what to do during the installation. We obviously, are going to create are own answer file.</p><p>We are going to need WIM file, which is in short take, the actual compressed Windows – whenever you install Windows, it’s being decompressed and installed to the local hard disk. Where’s the file then? You’ve guessed it right, on the Windows 10 ISO, the same which we’ve used to install Windows 10 earlier on.</p><p>Microsoft started using ESD files to include Windows installation files, which are way more compressed than actual WIM files. Therefore first step is to copy the ESD file off the ISO, then convert it to the WIM file to finally use for the Answer file creation.</p><ol><li>Right click on the ISO which you’ve used to install the Windows 10, mount it.</li><li>ISO will show as ordinary DVD drive, open it and go to the “Sources” folder, and find <strong>install.esd</strong> file. It’s the biggest (approximately 4GBs) file over there. Copy the file off the image. I can suggest to create a dedicated folder where you’re going to store all ISOs used for installation and another folder called WIM where you’ll store WIM files. The reason behind is that you should always use the WIM file from ISO used for installation. Don’t forget about meaningful names.</li><li>We need elevated (administrator) command prompt, right click on the Windows menu and choose it then. Change directory to where the ISO is.</li><li>You can use DIR command to make sure you’re in the right folder and can see install.erd file.</li><li>Type command: <strong>dism /Get-WimInfo /WimFile:install.esd</strong> You should see the list of available Windows 10 edition included in the ISO. I’m going to need Pro edition therefore will choose Index:1</li><li>Type command: **dism /export-image /SourceImageFile:install.esd /SourceIndex:<span style=color:red>1</span> /DestinationImageFile:<span style=color:red>Windows10_pro_1607</span>.wim /Compress:max /CheckIntegrity **I’ve highlighted the index number and the file name in case you’d like to change it.</li></ol><p class="jetpack-slideshow-noscript robots-nocontent">This slideshow requires JavaScript.</p><div id=gallery-774-8-slideshow class="slideshow-window jetpack-slideshow slideshow-black" data-trans=fade data-autostart=1 data-gallery='[{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/WIM-1.jpg","id":"990","title":"WIM 1","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/WIM-2.jpg","id":"991","title":"WIM 2","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/WIM-3.jpg","id":"992","title":"WIM 3","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/WIM-4.jpg","id":"993","title":"WIM 4","alt":"","caption":"","itemprop":"image"}]' itemscope itemtype=https://schema.org/ImageGallery></div><p>Wait until the process has finished and we can move on to the actual answer file creation. You’ll find the WIM file in the same location where ESD file is.</p><h2 id=answer-file>Answer File</h2><p>It’s time to tell Windows off, literally. We’re going to prepare the answer file, which will guide Windows through the installation – and achieve automatic installation there.</p><p>There are tonnes of possible settings to configure, therefore I will focus on bringing you to the automated installation which you might use as the base for your answer file. Most of the settings are well documented which is a great help.</p><p>To create the answer file:</p><ol><li>Open Windows System Image Manager.</li><li>Press the “New Answer File” button.</li><li>Say yes to open the Windows Image file.</li><li>Point to the WIM file created earlier on.</li><li>Confirm creation of the catalog file.</li></ol><p class="jetpack-slideshow-noscript robots-nocontent">This slideshow requires JavaScript.</p><div id=gallery-774-9-slideshow class="slideshow-window jetpack-slideshow slideshow-black" data-trans=fade data-autostart=1 data-gallery='[{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Answer-file-1.jpg","id":"999","title":"Answer file 1","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Answer-file-2.jpg","id":"1000","title":"Answer file 2","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Answer-file-3.jpg","id":"1001","title":"Answer file 3","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Answer-file-4.jpg","id":"1002","title":"Answer file 4","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Answer-file-5.jpg","id":"1003","title":"Answer file 5","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/03\/Answer-file-6.jpg","id":"1004","title":"Answer file 6","alt":"","caption":"","itemprop":"image"}]' itemscope itemtype=https://schema.org/ImageGallery></div><p>It will take a few minutes for SIM to complete the image creation process. Upon finish, you’ll be presented with the new SIM windows with more options than before.</p><p>Answer file reflects different Windows installation stages (passes) – there are 7 of them, however, we need only a few for our needs.</p><p>The components part contains the actual jobs that Windows Installer performs during different parts of the installation. One component can be added to multiple installation stages. Components are added by right-clicking on them and choosing to which part they need to be added.</p><img loading=lazy class="aligncenter wp-image-1005 size-full" src="https://i1.wp.com/kamilpro.com/wp-content/uploads/2017/03/Answer-file-6-1.jpg?resize=900%2C726&ssl=1" alt width=900 height=726 srcset="https://i1.wp.com/kamilpro.com/wp-content/uploads/2017/03/Answer-file-6-1.jpg?w=939&ssl=1 939w, https://i1.wp.com/kamilpro.com/wp-content/uploads/2017/03/Answer-file-6-1.jpg?resize=300%2C242&ssl=1 300w, https://i1.wp.com/kamilpro.com/wp-content/uploads/2017/03/Answer-file-6-1.jpg?resize=768%2C619&ssl=1 768w" sizes="(max-width: 900px) 100vw, 900px" data-recalc-dims=1><p>Necessary components for automated installation:</p><p>Phase 1 WinPE:</p><ul><li>amd64_Microsoft-Windows-International-Core-WinPE</li><li>amd64_Microsoft-Windows-Setup</li></ul><p>Phase 4 Specialize:</p><ul><li>amd64_Microsoft-Windows-Shell-Setup</li></ul><p>Phase 7 OOBE</p><ul><li>amd64_Microsoft-Windows-International-Core</li><li>amd64_Microsoft-Windows-Shell-Setup</li></ul><p>I really wanted to describe all the components, meaning what you should type and where, but it would take way too much time and space. Instead, I’ll simply paste the answer file here and describe what it does in each phase.</p><p><a href=https://kamilpro.com/wp-content/uploads/2017/04/Windows_10_pro.xml target=_blank rel="noopener noreffer">Answer file – Windows_10_pro.xml</a> (right click and dowload/save link as)</p><p>Use SIM to open the file above, and point to Windows 10 1607 WIM file.</p><h3 id=phase-1-winpe>Phase 1 WinPE</h3><p>That one happens when you actually boot a computer from the installation media and are presented with the install now screen.</p><p>What happens in “amd64_Microsoft-Windows-International-Core-WinPE” is to choose which display language should be picked.</p><p>The “amd64_Microsoft-Windows-Setup” tells installer to wipe the first hard drive, then create 4 partitions (as needed for UEFI) and to modify them. While first 3 partitions are needed for Windows to run and have a fixed size, the 4th – where the actual OS is – will use all remaining space for itself.</p><h3 id=phase-4-specialize>Phase 4 Specialize</h3><p>That phase happens when Windows is “Getting ready”. You can notice a CopyProfile option – it tells the installer to take Administrator’s profile (the same which you’ve customised earlier on in the Audit mode) and set it as the default profile – so that every profile created on the computer will have the same customisation.</p><p>The product key used here is generic Windows 10 Pro, you should change it to yours. You won’t be able to activate Windows with that key.</p><h3 id=phase-7-oobe>Phase 7 OOBE</h3><p>OOBE – Out of box experience – is the Wizard which you see during the first Windows boot.</p><p>“amd64_Microsoft-Windows-International-Core” will tell the computer which language, region and keyboard layout will be used for the users.</p><p>“amd64_Microsoft-Windows-Shell-Setup” will accept the agreement, set Windows to get automatic Windows Updates and create local user “Dave” who will be an administrator. Notice that password field is hashed, therefore you should change it to yours.</p><h4 id=defaultuser0-bug>Defaultuser0 bug</h4><p>When at some point you’ll start testing/deploying the image, you might notice a 2nd user account created during the installation, called defaultuser0. It’s being created during the CopyProfile function, I couldn’t find an explanation why it happens.</p><p>We could switch off the CopyProfile, but then it would be necessary to spend a way more time with customising (including start menu, theme, wallpaper etc. would need to be set, configured with text files and exported – which is not really user friendly).</p><p>Or we could keep using CopyProfile and call a command “net user defaultuser0 /delete” during first user logon, which removes it automatically. I prefer the second option, which is included in the answer file.</p><h2 id=save-the-answer-file>Save the answer file</h2><p>Once you’re happy with your answer file, save in the shared folder created earlier on.</p><h1 id=preparing-the-image-for-capturehousekeeping>Preparing the image for capture/housekeeping</h1><p>We need to do some housekeeping to make the image clean and neat for the end user:</p><ul><li>Run Windows updates</li><li>Run antivirus updates</li><li>Remove all browsing history from Internet browsers</li><li>Unmount all mounted network drives</li><li>Right click on the address bar in Windows explorer and choose “Delete history”</li><li>Run disk clean up</li><li>Make sure there are no passwords saved in the Credential manager (Control panel>Credential Manager)</li><li>Remove any directories used during image preparation (e.g. C:\temp)</li></ul><p class="jetpack-slideshow-noscript robots-nocontent">This slideshow requires JavaScript.</p><div id=gallery-774-10-slideshow class="slideshow-window jetpack-slideshow slideshow-black" data-trans=fade data-autostart=1 data-gallery='[{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/04\/Housekeeping-1.jpg","id":"1014","title":"Housekeeping 1","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/04\/Housekeeping-2.jpg","id":"1015","title":"Housekeeping 2","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/04\/Housekeeping-3.jpg","id":"1016","title":"Housekeeping 3","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/04\/Housekeeping-4.jpg","id":"1017","title":"Housekeeping 4","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/04\/Housekeeping-5.jpg","id":"1018","title":"Housekeeping 5","alt":"","caption":"","itemprop":"image"}]' itemscope itemtype=https://schema.org/ImageGallery></div><p>In other words – when your users get freshly wiped PC, they’ll get an impression it’s spanking new, yet customised by their great IT department. It makes a difference, a huge difference to the end user.</p><h1 id=test-the-image-within-vm>Test the image within VM</h1><p>That’s a great moment, isn’t it? I’m always excited when testing the new image and see how all the work turns out. But before deploying it to the actual physical machine, it’s worth to test it within the actual VM.</p><p>Why? Because due to checkpoints, it’s extremely easy to roll back the deployment, amend the setting and deploy once again. It’s a real time saver. Therefore, do not expect the image to be ready after the first time. My first attempt took about a week to get fully polished and prepared image.</p><h2 id=take-the-checkpoint-now>Take the checkpoint now</h2><p>Remember: if there’s something you don’t like after the deployment or test, you can always roll back, change the image and try once again (and don’t forget to take another checkpoint).</p><p>You can repeat that process until you’re fully satisfied with the result.</p><h2 id=sysprep-8211-the-tool-for-generalization>Sysprep – the tool for generalization</h2><p>Generalise makes the image truly hardware neutral. It removes all installed drivers, Windows activation, unique installation details for the VM – it then allows computer to install completely fresh and setup itself for the new installation or another computer.</p><p>To generalise Windows installation you’d like to:</p><ol><li>Open elevated command prompt</li><li>Type: <strong>CD C:\Windows\System32\Sysprep</strong></li><li>Type: **SYSPREP /GENERALIZE /OOBE /REBOOT /UNATTEND:<path to your unattended file> **We call sysprep tool to generalise the installation, set Windows into OOBE mode, use answer file and restart the PC.</li><li>Wait until the sysprep process is done and PC restart.</li></ol><p class="jetpack-slideshow-noscript robots-nocontent">This slideshow requires JavaScript.</p><div id=gallery-774-11-slideshow class="slideshow-window jetpack-slideshow slideshow-black" data-trans=fade data-autostart=1 data-gallery='[{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/04\/Sysprep-1.jpg","id":"1020","title":"Sysprep 1","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/04\/Sysprep-2.jpg","id":"1021","title":"Sysprep 2","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/04\/Sysprep-3.jpg","id":"1022","title":"Sysprep 3","alt":"","caption":"","itemprop":"image"},{"src":"https:\/\/kamilpro.com\/wp-content\/uploads\/2017\/04\/Sysprep-4.jpg","id":"1023","title":"Sysprep 4","alt":"","caption":"","itemprop":"image"}]' itemscope itemtype=https://schema.org/ImageGallery></div><p>Once completed, VM should restart a few times and – if everything goes well – bring you to the login screen. You’d like then to review all your customisation settings, make sure that passwords are not saved etc. Remember that whatever you can see after the first login, will be available to any new user using the computer.</p><h1 id=capturing-and-deploying-the-image>Capturing and deploying the image</h1><p>Once your VM is up to the standard it’s time to send it to the actual hardware and see if everything still works + all drivers are working.</p><p>However, it’s beyond this article as there are many tools which can be used. If you’ve got any favourite tools which can get the job done – let me know!</p><h1 id=a-few-tips>A few tips:</h1><ul><li>Always take the checkpoint before syspreping. Windows has a sysprep counter, and after generalising an image few times it will not allow you to generalise it another! This means you’d need to create another image from the scratch. On the other hand, if you’ve got a VM with checkpoint just before sysprep, you can always come back to it, amend it, checkpoint it and sysprep again, unlimited number of times.</li><li>If there are too many checkpoints (and not enough hard disk space), you can always remove all of them and create a new one.</li><li>Creating the image is a long process – take your time!</li></ul><p>Main photo by: https://unsplash.com/@rawpixel</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2022-01-03&nbsp;<a class=git-hash href=https://github.com/thekamilpro/commit/dfb5243d796d93396da474840d2b2063421897ad target=_blank title="commit by Kamil Procyszyn(kprocyszyn@gmail.com) dfb5243d796d93396da474840d2b2063421897ad: Add featured images">
<i class="fas fa-hashtag fa-fw" aria-hidden=true></i>dfb5243</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/prepare-windows-10-1607-image/index.md target=_blank>Read Markdown</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://kamilpro.github.io/prepare-windows-10-1607-image/ data-title="How to prepare Windows 10 1607 image" data-via=@thekamilpro data-hashtags="1607,answer,deployment,feat,image,sysprep,unattend,windows 10"><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://kamilpro.github.io/prepare-windows-10-1607-image/ data-hashtag=1607><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://kamilpro.github.io/prepare-windows-10-1607-image/><i class="fab fa-linkedin fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on WhatsApp" data-sharer=whatsapp data-url=https://kamilpro.github.io/prepare-windows-10-1607-image/ data-title="How to prepare Windows 10 1607 image" data-web><i class="fab fa-whatsapp fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://kamilpro.github.io/prepare-windows-10-1607-image/ data-title="How to prepare Windows 10 1607 image"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Reddit" data-sharer=reddit data-url=https://kamilpro.github.io/prepare-windows-10-1607-image/><i class="fab fa-reddit fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://kamilpro.github.io/prepare-windows-10-1607-image/ data-title="How to prepare Windows 10 1607 image" data-image=/wp-content/uploads/2017/04/rawpixel-com-196509.jpg><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/1607/>1607</a>,&nbsp;<a href=/tags/answer/>answer</a>,&nbsp;<a href=/tags/deployment/>deployment</a>,&nbsp;<a href=/tags/feat/>feat</a>,&nbsp;<a href=/tags/image/>image</a>,&nbsp;<a href=/tags/sysprep/>sysprep</a>,&nbsp;<a href=/tags/unattend/>unattend</a>,&nbsp;<a href=/tags/windows-10/>windows 10</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/do-you-even-back-up/ class=prev rel=prev title="Do you even back up?"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Do you even back up?</a>
<a href=/why-saturday-is-best-to-start-new-hobby/ class=next rel=next title="Why Saturday is best to start new hobby.">Why Saturday is best to start new hobby.<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=utterances class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://utteranc.es/>utterances</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.104.1">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2014 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Kamil Pro</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:10},comment:{utterances:{darkTheme:"github-dark",issueTerm:"pathname",label:"Comment",lightTheme:"github-light",repo:"thekamilpro/kamilpro.github.io"}},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-64576368-1",{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=UA-64576368-1" async></script></body></html>