<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Ultimate Windows Update fix | Kamil Pro</title><meta name=keywords content><meta name=description content="The reason I manage hundreds of workstations working on various Windows versions. As we know, Windows (and other Microsoft’s software) is updated monthly. While usually the process is just working fine, sometimes it simply doesn’t want to work.
And yes, probably Google is your best friend here… but really, who has time to search for the solution, and apply it, manually, if there is more than 1 computer?
Use the script I used technet, different posts and own knowledge of fixing that kind of issues."><meta name=author content="Kamil"><link rel=canonical href=https://kamilpro.com/ultimate-windows-update-fix/><link crossorigin=anonymous href=/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U+6hYRq/Ez/nm5vg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://kamilpro.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://kamilpro.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://kamilpro.com/favicon-32x32.png><link rel=apple-touch-icon href=https://kamilpro.com/apple-touch-icon.png><link rel=mask-icon href=https://kamilpro.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=text/plain href=https://kamilpro.com/ultimate-windows-update-fix/index.md><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Ultimate Windows Update fix"><meta property="og:description" content="The reason I manage hundreds of workstations working on various Windows versions. As we know, Windows (and other Microsoft’s software) is updated monthly. While usually the process is just working fine, sometimes it simply doesn’t want to work.
And yes, probably Google is your best friend here… but really, who has time to search for the solution, and apply it, manually, if there is more than 1 computer?
Use the script I used technet, different posts and own knowledge of fixing that kind of issues."><meta property="og:type" content="article"><meta property="og:url" content="https://kamilpro.com/ultimate-windows-update-fix/"><meta property="og:image" content="https://kamilpro.com/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-10-29T22:12:15+00:00"><meta property="article:modified_time" content="2022-01-03T19:48:21+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kamilpro.com/logo.png"><meta name=twitter:title content="Ultimate Windows Update fix"><meta name=twitter:description content="The reason I manage hundreds of workstations working on various Windows versions. As we know, Windows (and other Microsoft’s software) is updated monthly. While usually the process is just working fine, sometimes it simply doesn’t want to work.
And yes, probably Google is your best friend here… but really, who has time to search for the solution, and apply it, manually, if there is more than 1 computer?
Use the script I used technet, different posts and own knowledge of fixing that kind of issues."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://kamilpro.com/posts/"},{"@type":"ListItem","position":3,"name":"Ultimate Windows Update fix","item":"https://kamilpro.com/ultimate-windows-update-fix/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Ultimate Windows Update fix","name":"Ultimate Windows Update fix","description":"The reason I manage hundreds of workstations working on various Windows versions. As we know, Windows (and other Microsoft’s software) is updated monthly. While usually the process is just working fine, sometimes it simply doesn’t want to work.\nAnd yes, probably Google is your best friend here… but really, who has time to search for the solution, and apply it, manually, if there is more than 1 computer?\nUse the script I used technet, different posts and own knowledge of fixing that kind of issues.","keywords":[],"articleBody":"The reason I manage hundreds of workstations working on various Windows versions. As we know, Windows (and other Microsoft’s software) is updated monthly. While usually the process is just working fine, sometimes it simply doesn’t want to work.\nAnd yes, probably Google is your best friend here… but really, who has time to search for the solution, and apply it, manually, if there is more than 1 computer?\nUse the script I used technet, different posts and own knowledge of fixing that kind of issues. All it needs, is admin rights.\nSo what does the script do?\nStops all services needed by Windows update Points client to download updates directly from Microsoft servers. I’ve noticed that if you don’t downstream all categories of updates (as this takes tonnes of free space) there might be an issue with downloading further updates. Still, if you’d like to keep using your internal update server, simply remove line no.5, starting with ‘reg delete’ and ending with ‘WindowsUpdate /f’. Removes local copies/cache/information of updates. Sometimes updates get corrupted, and the only way is to purge the catalogue, so that Windows Update will rebuild it next time you run updates. Restarting all services. You might notice that there is one service which hasn’t been stopped before – MpsSvc – it’s responsible for Windows Firewall. I’ve noticed that Windows Firewall service must be running (even if you don’t use it/use a different firewall), otherwise updates will fail to download. Run Windows update. I couldn’t figure it out (and couldn’t find the actual answer to this) but triggering the Windows Update from the command line doesn’t always work. After all this, just go and fire out Windows Update, allow a few minutes and it should work.\nHow to use the script? net stop wuauserv net stop cryptSvc net stop bits net stop msiserver reg delete HKEY_LOCAL_MACHINE\\Software\\Policies\\Microsoft\\Windows\\WindowsUpdate /f Del \"%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Network\\Downloader\\qmgr*.dat\" Ren %systemroot%\\SoftwareDistribution SoftwareDistribution.bak Ren %systemroot%\\system32\\catroot2 catroot2.bak netsh winsock reset net start wuauserv net start cryptSvc net start bits net start msiserver net start MpsSvc All you need to do now, is paste the script from above to the notepad, save it as ‘Fix Updates.bat’ (don’t forget to pick All Files (*.*) from the drop down menu in Save As window. Then right click a newly created file, and choose run as administrator.\nLet me know how it worked! This is my first ever IT strict post – let me know how you’ve found it! Was it useful? Was it explained well? I’d like to know!\n","wordCount":"417","inLanguage":"en","datePublished":"2017-10-29T22:12:15Z","dateModified":"2022-01-03T19:48:21Z","author":{"@type":"Person","name":"Kamil"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://kamilpro.com/ultimate-windows-update-fix/"},"publisher":{"@type":"Organization","name":"Kamil Pro","logo":{"@type":"ImageObject","url":"https://kamilpro.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kamilpro.com accesskey=h title="Kamil Pro (Alt + H)">Kamil Pro</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://kamilpro.com/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://kamilpro.com/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://kamilpro.com/categories/ title=Categories><span>Categories</span></a></li><li><a href="https://www.youtube.com/playlist?list=PL-esmhgrps8Zv9bAHesStPRQ1AiUL1wY3" title="About PowerShell"><span>About PowerShell</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://kamilpro.com/powershell-for-it-professionals/ title="Powershell for IT professionals"><span>Powershell for IT professionals</span></a></li><li><a href=https://github.com/thekamilpro title=GitHub><span><i class='fab fa-github fa-fw'></i></span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Ultimate Windows Update fix</h1><div class=post-meta><span title='2017-10-29 22:12:15 +0000 UTC'>2017-10-29</span>&nbsp;·&nbsp;Kamil</div></header><div class=post-content><h2 id=the-reason>The reason<a hidden class=anchor aria-hidden=true href=#the-reason>#</a></h2><p>I manage hundreds of workstations working on various Windows versions. As we know, Windows (and other Microsoft’s software) is updated monthly. While usually the process is just working fine, sometimes it simply doesn’t want to work.</p><p>And yes, probably Google is your best friend here… but really, who has time to search for the solution, and apply it, manually, if there is more than 1 computer?</p><h2 id=use-the-script>Use the script<a hidden class=anchor aria-hidden=true href=#use-the-script>#</a></h2><p>I used technet, different posts and own knowledge of fixing that kind of issues. All it needs, is admin rights.</p><p>So what does the script do?</p><ol><li>Stops all services needed by Windows update</li><li>Points client to download updates directly from Microsoft servers. I’ve noticed that if you don’t downstream all categories of updates (as this takes tonnes of free space) there might be an issue with downloading further updates. Still, if you’d like to keep using your internal update server, simply remove line no.5, starting with ‘reg delete’ and ending with ‘WindowsUpdate /f’.</li><li>Removes local copies/cache/information of updates. Sometimes updates get corrupted, and the only way is to purge the catalogue, so that Windows Update will rebuild it next time you run updates.</li><li>Restarting all services. You might notice that there is one service which hasn’t been stopped before – MpsSvc – it’s responsible for Windows Firewall. I’ve noticed that Windows Firewall service must be running (even if you don’t use it/use a different firewall), otherwise updates will fail to download.</li><li>Run Windows update. I couldn’t figure it out (and couldn’t find the actual answer to this) but triggering the Windows Update from the command line doesn’t always work.</li></ol><p>After all this, just go and fire out Windows Update, allow a few minutes and it should work.</p><h2 id=how-to-use-the-script>How to use the script?<a hidden class=anchor aria-hidden=true href=#how-to-use-the-script>#</a></h2><pre spellcheck=false>net stop wuauserv
net stop cryptSvc
net stop bits
net stop msiserver

reg delete HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\WindowsUpdate /f
Del "%ALLUSERSPROFILE%\Application Data\Microsoft\Network\Downloader\qmgr*.dat"
Ren %systemroot%\SoftwareDistribution SoftwareDistribution.bak
Ren %systemroot%\system32\catroot2 catroot2.bak

netsh winsock reset

net start wuauserv
net start cryptSvc
net start bits
net start msiserver
net start MpsSvc

</pre><p>All you need to do now, is paste the script from above to the notepad, save it as ‘Fix Updates.bat’ (don’t forget to pick All Files (*.*) from the drop down menu in Save As window. Then right click a newly created file, and choose run as administrator.</p><h2 id=let-me-know-how-it-worked>Let me know how it worked!<a hidden class=anchor aria-hidden=true href=#let-me-know-how-it-worked>#</a></h2><p>This is my first ever IT strict post – let me know how you’ve found it! Was it useful? Was it explained well? I’d like to know!</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>Kamil Procyszyn</span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>