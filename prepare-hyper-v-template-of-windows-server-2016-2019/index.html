<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Prepare Hyper-V template of Windows Server 2016/2019 | Kamil Pro</title>
<meta name=keywords content="hyper-v,server,sysprep,template"><meta name=description content="Deploying a new server is always fun! Well, at least the part after ISO download, installation, patching. Having said that, why not create a template so that you jump right into the fun?
So we are essentially going to create a preconfigured VHDX file that can be attached to the newly created VM, and it will take you straight to the login screen.
What’s needed Windows server or Windows 10 with Hyper-V role and management tools enabled Windows Assessment and Deployment Toolkit (ADK) – I always pick the latest version available, at the moment of writing this – Windows 10, version 1903 – is latest."><meta name=author content="Kamil"><link rel=canonical href=https://kamilpro.com/prepare-hyper-v-template-of-windows-server-2016-2019/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://kamilpro.com/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://kamilpro.com/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://kamilpro.com/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://kamilpro.com/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://kamilpro.com/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://kamilpro.com/prepare-hyper-v-template-of-windows-server-2016-2019/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-5Q7PS37F1K"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-5Q7PS37F1K")}</script><meta property="og:title" content="Prepare Hyper-V template of Windows Server 2016/2019"><meta property="og:description" content="Deploying a new server is always fun! Well, at least the part after ISO download, installation, patching. Having said that, why not create a template so that you jump right into the fun?
So we are essentially going to create a preconfigured VHDX file that can be attached to the newly created VM, and it will take you straight to the login screen.
What’s needed Windows server or Windows 10 with Hyper-V role and management tools enabled Windows Assessment and Deployment Toolkit (ADK) – I always pick the latest version available, at the moment of writing this – Windows 10, version 1903 – is latest."><meta property="og:type" content="article"><meta property="og:url" content="https://kamilpro.com/prepare-hyper-v-template-of-windows-server-2016-2019/"><meta property="og:image" content="https://kamilpro.com/109"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-03-08T10:52:17+00:00"><meta property="article:modified_time" content="2020-03-08T10:52:17+00:00"><meta property="og:site_name" content="Kamil Pro"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kamilpro.com/109"><meta name=twitter:title content="Prepare Hyper-V template of Windows Server 2016/2019"><meta name=twitter:description content="Deploying a new server is always fun! Well, at least the part after ISO download, installation, patching. Having said that, why not create a template so that you jump right into the fun?
So we are essentially going to create a preconfigured VHDX file that can be attached to the newly created VM, and it will take you straight to the login screen.
What’s needed Windows server or Windows 10 with Hyper-V role and management tools enabled Windows Assessment and Deployment Toolkit (ADK) – I always pick the latest version available, at the moment of writing this – Windows 10, version 1903 – is latest."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://kamilpro.com/posts/"},{"@type":"ListItem","position":2,"name":"Prepare Hyper-V template of Windows Server 2016/2019","item":"https://kamilpro.com/prepare-hyper-v-template-of-windows-server-2016-2019/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Prepare Hyper-V template of Windows Server 2016/2019","name":"Prepare Hyper-V template of Windows Server 2016\/2019","description":"Deploying a new server is always fun! Well, at least the part after ISO download, installation, patching. Having said that, why not create a template so that you jump right into the fun?\nSo we are essentially going to create a preconfigured VHDX file that can be attached to the newly created VM, and it will take you straight to the login screen.\nWhat’s needed Windows server or Windows 10 with Hyper-V role and management tools enabled Windows Assessment and Deployment Toolkit (ADK) – I always pick the latest version available, at the moment of writing this – Windows 10, version 1903 – is latest.","keywords":["hyper-v","server","sysprep","template"],"articleBody":"Deploying a new server is always fun! Well, at least the part after ISO download, installation, patching. Having said that, why not create a template so that you jump right into the fun?\nSo we are essentially going to create a preconfigured VHDX file that can be attached to the newly created VM, and it will take you straight to the login screen.\nWhat’s needed Windows server or Windows 10 with Hyper-V role and management tools enabled Windows Assessment and Deployment Toolkit (ADK) – I always pick the latest version available, at the moment of writing this – Windows 10, version 1903 – is latest. ISO with the source – I’ve used Server for 2016/2019 from my.visualstudio.com (you need an MSDN subscription for this), or from trial center Preparation Hyper-V Open Windows PowerShell as admin and paste this command:\nYou will need to reboot your computer for hyper-v to become available\nInstall External switch\nIf you want to allow your template VM to connect to the Internet e.g. To download and install patches, you need an external switch set up on Hyper-V.\nOpen Hyper-V Manage and choose “Virtual Switch Manager” from the right-hand side pane,\nMake sure you highlight the external switch and click Create Virtual Switch\nOn the next page give it a name, specify which network card connect it to and confirm.\nOr use Powershell (it will attach VM switch to the first network adapter):\nADK Go to the link and download the latest ADK. When installing, make sure “Deployment tools” is selected – we are after Windows System Image Manager (SIM).\nFiles extraction from ISO We need to extract install.wim file from the installation media. The file is a compressed Windows Image and is being used by SIM to create the answer file.\nDouble click on the ISO so that it mounts, go to Mounted ISO\\Sources and copy install.wim (it has a few gigabytes in size, biggest file in the folder) to your work directory.\nYou can unmount the ISO now, by right-clicking on it and choosing Unmount.\nAt this stage, we have everything we need to work.\nCreate VM and install from ISO Head to the Hyper-V Manager and choose to create a new VM, and options you choose:\nName: Something meaningful like e.g. Template – Server 2019 Standard GUI\nGeneration: Generation 2\nAssign Memory: Anything above 2048MB should be enough\nConfigure networking: If you’ve created the external switch, pick it here\nVirtual Hard Disk: You can change default location and size. By default it will be dynamically expanding, that means it will only take as much space as needed.\nInstallation Options: point to the ISO\nOn summary click finish.\nWhat you can do at the stage is to give it more CPUs, 2 at least. It’s all about speed.\nStart your VM and prepare it as you wish Now you can customise your server installation as you wish. Since it’s a server, I have tendency to only install updates, with the principal the less the better. But you can do whatever you’re fancy.\nOnce you’re finished, take a checkpoint, as we are going to test if syspreping works.\nPress Windows + R and run:\n%windir%\\system32\\sysprep\\sysprep.exe\nThis will launch the System Preparation tool, aka sysprep. Configure it as:\nOOBE Generalize Reboot IF you haven’t taken the checkpoint when I’ve asked last time, do it now.\nCheckpoint taken? Great, press ok and let the system reboot.\nWhat will happen now is Windows will remove any unique identifiers, enabled drivers etc. Making it neutral.\nOnce your sysprep is completed, you’ll see a standard installation questions like language and administrator password – this is expected. At this stage, we are only testing if whatever changes you’ve made so far, don’t interfere with the sysprep process.\nThe successful test is considered when you can log in to Windows.\nRoll back the VM to the checkpoint you’ve taken before trying sysprep.\nPrepare the answer file Now we can move to a so-called answer/unattend file. The purpose of the file is to “answer” the installation questions for you, thus if the installer can find all answers, it will simply get you to the login screen after the first run.\nOpen SIM, choose File \u003e New Answer File \u003e Point it to the install.wim file you’ve copied earlier\nIn the window say Yes\nChoose the Windows edition you’d like to install and in following, windows say Yes\nSIM will now start creating a catalogue with all possible options for the image, this process can take good 10 minutes. Just let it work.\nWhen completed, you will see windows like that:\nAnd we are after to panes here: Answer File and Windows image.\nWindows Image is where you choose what to add to and to which phase of OS deployment The answer file is where you configure specific answers For start you’d like to add components:\namd64_Microsoft-Windows-International-Core, to Pass 4 Specialize and Pass 7 OOBE system amd64_Microsoft-Windows-International-Core, to Pass 7 OOBE System You do this by right-clicking the component Windows Image pane and choose the phase you’d like to add. There are many very similarly named records, thus pay attention.\nOnce added, you will see three “empty boxes” in the Answer File section.\nLet’s configure amd64_Microsoft-Windows-International-Core first, in both phases:\nBy selecting one, you enter its values on the right-hand side pane Properties.\nYou’d like to fill three fields: InputLocale, SystemLocale, UILanguage – in my example below you can see set up for British language. How can you find out all possible combinations? When you right-click the components in Answer File and choose Help it will take you to the website which enlists all values/language you can insert into these fields.\nTime for amd64_Microsoft-Windows-Shell-Setup in here we need to values:\nIn the root\\OOBE amend the record of HideEULAPage to True\nAnd in root\\UserAccounts\\AdministratorPassword enter the password for the Administrator account.\nAfter finishing it should look like this:\nPress Save \u003e Save Answer File to save the file. We are going to use it for sysprep.\nSysprep with unattended file Copy the answer file to the desktop, and take another checkpoint of your VM.\nOpen shell as administrator and issue command (My username is Administrator and file is called Unattend.xml):\nSelect OOBE, Generalize and Reboot\nWhat will happen now the system will reboot and after a few minutes you should be welcomed by a login prompt (thus no language, licence, admin password questions) – if so we’re good to export the template for future deployment.\nIf any questions appear during the deployment phase, double-check your answer file if you’ve included all answers as suggested above.\nExport template All right, revert your VM to the last checkpoint. You can rename that check as “Before sysprep” – so that you can always comeback to it and make amendments to your image, or install new updates.\nIssue same command once again:\nBut this time choose to shutdown the VM.\nWhen the VM is shutdown, take another snapshot and call it something like “Export this” and export this checkpoint!\nExporting a checkpoint will effectively create a VM with merged VHDX file, and it’s VHDX file we need. All you need to do now is to go to the directory where you’ve exported the VM, and copy VHDX file from it to some place where you store your templates.\nNow whenever you create a new VM, rather than pointing it to the ISO and creating a blank hard disk, simply make a copy of your template and attach that disk to VM.\nI’ve got my template, what now? Since you’ve got the checkpoint of VM before syspreping, you can always bring install new updates, software etc.\nYou can use scripting to create new VMs, with the use of the VHDx, thus making it the fully automatic solution.\nIf the post-deployment configuration is required, but you can’t have this on the golden image (e.g. AV software, management agent) you can use setupcomplete.cmd file.\nIf you’re interested in creating Windows 10 image, read this article.\nPhoto by Dan Gold on Unsplash\n","wordCount":"1339","inLanguage":"en","datePublished":"2020-03-08T10:52:17Z","dateModified":"2020-03-08T10:52:17Z","author":{"@type":"Person","name":"Kamil"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://kamilpro.com/prepare-hyper-v-template-of-windows-server-2016-2019/"},"publisher":{"@type":"Organization","name":"Kamil Pro","logo":{"@type":"ImageObject","url":"https://kamilpro.com/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kamilpro.com/ accesskey=h title="Home (Alt + H)"><img src=https://kamilpro.com/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://kamilpro.com/posts/ title=Posts><span>Posts</span></a></li><li><a href=http://mng.bz/v89q title="PowerShell and GitHub Actions"><span>PowerShell and GitHub Actions</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://kamilpro.com/about-powershell/ title="About PowerShell"><span>About PowerShell</span></a></li><li><a href=https://kamilpro.com/powershell-course/ title="PowerShell Course"><span>PowerShell Course</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://kamilpro.com/>Home</a>&nbsp;»&nbsp;<a href=https://kamilpro.com/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Prepare Hyper-V template of Windows Server 2016/2019</h1><div class=post-meta><span title='2020-03-08 10:52:17 +0000 UTC'>8 March 2020</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;1339 words&nbsp;·&nbsp;Kamil</div></header><div class=post-content><p>Deploying a new server is always fun! Well, at least the part after ISO download, installation, patching. Having said that, why not create a template so that you jump right into the fun?</p><p>So we are essentially going to create a preconfigured VHDX file that can be attached to the newly created VM, and it will take you straight to the login screen.</p><h1 id=what8217s-needed>What’s needed<a hidden class=anchor aria-hidden=true href=#what8217s-needed>#</a></h1><ul><li>Windows server or Windows 10 with Hyper-V role and management tools enabled</li><li><a href=https://docs.microsoft.com/en-us/windows-hardware/get-started/adk-install>Windows Assessment and Deployment Toolkit (ADK)</a> – I always pick the latest version available, at the moment of writing this – Windows 10, version 1903 – is latest.</li><li>ISO with the source – I’ve used Server for 2016/2019 from my.visualstudio.com (you need an MSDN subscription for this), or from <a href="https://www.microsoft.com/en-us/evalcenter/evaluate-windows-server-2019?filetype=ISO">trial center</a></li></ul><h1 id=preparation>Preparation<a hidden class=anchor aria-hidden=true href=#preparation>#</a></h1><h2 id=hyper-v>Hyper-V<a hidden class=anchor aria-hidden=true href=#hyper-v>#</a></h2><p>Open Windows PowerShell as admin and paste this command:</p><p>You will need to reboot your computer for hyper-v to become available</p><p><strong>Install External switch</strong></p><p>If you want to allow your template VM to connect to the Internet e.g. To download and install patches, you need an external switch set up on Hyper-V.</p><p>Open Hyper-V Manage and choose “Virtual Switch Manager” from the right-hand side pane,</p><p></p><p>Make sure you highlight the external switch and click Create Virtual Switch</p><p>On the next page give it a name, specify which network card connect it to and confirm.</p><p>Or use Powershell (it will attach VM switch to the first network adapter):</p><h2 id=adk>ADK<a hidden class=anchor aria-hidden=true href=#adk>#</a></h2><p>Go to the <a href=https://docs.microsoft.com/en-us/windows-hardware/get-started/adk-install>link</a> and download the latest ADK. When installing, make sure “Deployment tools” is selected – we are after Windows System Image Manager (SIM).</p><p></p><h2 id=files-extraction-from-iso>Files extraction from ISO<a hidden class=anchor aria-hidden=true href=#files-extraction-from-iso>#</a></h2><p>We need to extract <em>install.wim</em> file from the installation media. The file is a compressed Windows Image and is being used by SIM to create the answer file.</p><p>Double click on the ISO so that it mounts, go to Mounted ISO\Sources and copy <em>install.wim</em> (it has a few gigabytes in size, biggest file in the folder) to your work directory.</p><p>You can unmount the ISO now, by right-clicking on it and choosing Unmount.</p><p>At this stage, we have everything we need to work.</p><h1 id=create-vm-and-install-from-iso>Create VM and install from ISO<a hidden class=anchor aria-hidden=true href=#create-vm-and-install-from-iso>#</a></h1><p>Head to the Hyper-V Manager and choose to create a new VM, and options you choose:</p><p>Name: Something meaningful like e.g. Template – Server 2019 Standard GUI</p><p>Generation: Generation 2<br>Assign Memory: Anything above 2048MB should be enough<br>Configure networking: If you’ve created the external switch, pick it here<br>Virtual Hard Disk: You can change default location and size. By default it will be dynamically expanding, that means it will only take as much space as needed.<br>Installation Options: point to the ISO</p><p>On summary click finish.</p><p>What you can do at the stage is to give it more CPUs, 2 at least. It’s all about speed.</p><h2 id=start-your-vm-and-prepare-it-as-you-wish>Start your VM and prepare it as you wish<a hidden class=anchor aria-hidden=true href=#start-your-vm-and-prepare-it-as-you-wish>#</a></h2><p>Now you can customise your server installation as you wish. Since it’s a server, I have tendency to only install updates, with the principal the less the better. But you can do whatever you’re fancy.</p><p>Once you’re finished, take a checkpoint, as we are going to test if syspreping works.</p><p>Press Windows + R and run:</p><p>%windir%\system32\sysprep\sysprep.exe</p><p>This will launch the System Preparation tool, aka sysprep.</p><p></p><p>Configure it as:</p><ul><li>OOBE</li><li>Generalize</li><li>Reboot</li></ul><p>IF you haven’t taken the checkpoint when I’ve asked last time, do it now.</p><p>Checkpoint taken? Great, press ok and let the system reboot.</p><p>What will happen now is Windows will remove any unique identifiers, enabled drivers etc. Making it neutral.</p><p>Once your sysprep is completed, you’ll see a standard installation questions like language and administrator password – this is expected. At this stage, we are only testing if whatever changes you’ve made so far, don’t interfere with the sysprep process.</p><p>The successful test is considered when you can log in to Windows.</p><p>Roll back the VM to the checkpoint you’ve taken before trying sysprep.</p><h1 id=prepare-the-answer-file>Prepare the answer file<a hidden class=anchor aria-hidden=true href=#prepare-the-answer-file>#</a></h1><p>Now we can move to a so-called answer/unattend file. The purpose of the file is to “answer” the installation questions for you, thus if the installer can find all answers, it will simply get you to the login screen after the first run.</p><p></p><p>Open SIM, choose File > New Answer File > Point it to the install.wim file you’ve copied earlier</p><p>In the window say Yes</p><p>Choose the Windows edition you’d like to install and in following, windows say Yes</p><p>SIM will now start creating a catalogue with all possible options for the image, this process can take good 10 minutes. Just let it work.</p><p>When completed, you will see windows like that:</p><p></p><p>And we are after to panes here: Answer File and Windows image.</p><ul><li>Windows Image is where you choose what to add to and to which phase of OS deployment</li><li>The answer file is where you configure specific answers</li></ul><p>For start you’d like to add components:</p><ul><li> amd64_Microsoft-Windows-International-Core, to Pass 4 Specialize and Pass 7 OOBE system</li><li>amd64_Microsoft-Windows-International-Core, to Pass 7 OOBE System</li></ul><p>You do this by right-clicking the component Windows Image pane and choose the phase you’d like to add. There are many very similarly named records, thus pay attention.</p><p>Once added, you will see three “empty boxes” in the Answer File section.</p><p>Let’s configure  amd64_Microsoft-Windows-International-Core first, in both phases:</p><p></p><p>By selecting one, you enter its values on the right-hand side pane Properties.</p><p>You’d like to fill three fields: InputLocale, SystemLocale, UILanguage – in my example below you can see set up for British language. How can you find out all possible combinations? When you right-click the components in Answer File and choose Help it will take you to the website which enlists all values/language you can insert into these fields.</p><p>Time for amd64_Microsoft-Windows-Shell-Setup in here we need to values:</p><p>In the root\OOBE amend the record of HideEULAPage to True</p><p>And in root\UserAccounts\AdministratorPassword enter the password for the Administrator account.</p><p>After finishing it should look like this:</p><p></p><p>Press Save > Save Answer File to save the file. We are going to use it for sysprep.</p><h1 id=sysprep-with-unattended-file>Sysprep with unattended file<a hidden class=anchor aria-hidden=true href=#sysprep-with-unattended-file>#</a></h1><p>Copy the answer file to the desktop, and take another checkpoint of your VM.</p><p>Open shell as administrator and issue command (My username is Administrator and file is called Unattend.xml):</p><p>Select OOBE, Generalize and Reboot</p><p>What will happen now the system will reboot and after a few minutes you should be welcomed by a login prompt (thus no language, licence, admin password questions) – if so we’re good to export the template for future deployment.</p><p>If any questions appear during the deployment phase, double-check your answer file if you’ve included all answers as suggested above.</p><h1 id=export-template>Export template<a hidden class=anchor aria-hidden=true href=#export-template>#</a></h1><p>All right, revert your VM to the last checkpoint. You can rename that check as “Before sysprep” – so that you can always comeback to it and make amendments to your image, or install new updates.</p><p>Issue same command once again:</p><p>But this time choose to shutdown the VM.</p><p>When the VM is shutdown, take another snapshot and call it something like “Export this” and export this checkpoint!</p><p></p><p>Exporting a checkpoint will effectively create a VM with merged VHDX file, and it’s VHDX file we need. All you need to do now is to go to the directory where you’ve exported the VM, and copy VHDX file from it to some place where you store your templates.</p><p>Now whenever you create a new VM, rather than pointing it to the ISO and creating a blank hard disk, simply make a copy of your template and attach that disk to VM.</p><h2 id=i8217ve-got-my-template-what-now>I’ve got my template, what now?<a hidden class=anchor aria-hidden=true href=#i8217ve-got-my-template-what-now>#</a></h2><p>Since you’ve got the checkpoint of VM before syspreping, you can always bring install new updates, software etc.</p><p>You can use scripting to create new VMs, with the use of the VHDx, thus making it the fully automatic solution.</p><p>If the post-deployment configuration is required, but you can’t have this on the golden image (e.g. AV software, management agent) you can use <a href=https://docs.microsoft.com/en-us/windows-hardware/manufacture/desktop/add-a-custom-script-to-windows-setup>setupcomplete.cmd</a> file.</p><p>If you’re interested in creating Windows 10 image, <a href=https://kamilpro.com/prepare-windows-10-1607-image/>read this article</a>.</p><p>Photo by <a href="https://unsplash.com/@danielcgold?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Dan Gold</a> on <a href="https://unsplash.com/s/photos/picture?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://kamilpro.com/tags/hyper-v/>Hyper-V</a></li><li><a href=https://kamilpro.com/tags/server/>Server</a></li><li><a href=https://kamilpro.com/tags/sysprep/>Sysprep</a></li><li><a href=https://kamilpro.com/tags/template/>Template</a></li></ul><nav class=paginav><a class=prev href=https://kamilpro.com/deploying-software-with-gpo/><span class=title>« Prev</span><br><span>Deploying software with GPO</span>
</a><a class=next href=https://kamilpro.com/restarting-vss-writers-with-powershell-script/><span class=title>Next »</span><br><span>Restarting VSS Writers with PowerShell script</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Prepare Hyper-V template of Windows Server 2016/2019 on x" href="https://x.com/intent/tweet/?text=Prepare%20Hyper-V%20template%20of%20Windows%20Server%202016%2f2019&amp;url=https%3a%2f%2fkamilpro.com%2fprepare-hyper-v-template-of-windows-server-2016-2019%2f&amp;hashtags=hyper-v%2cserver%2csysprep%2ctemplate"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Prepare Hyper-V template of Windows Server 2016/2019 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fkamilpro.com%2fprepare-hyper-v-template-of-windows-server-2016-2019%2f&amp;title=Prepare%20Hyper-V%20template%20of%20Windows%20Server%202016%2f2019&amp;summary=Prepare%20Hyper-V%20template%20of%20Windows%20Server%202016%2f2019&amp;source=https%3a%2f%2fkamilpro.com%2fprepare-hyper-v-template-of-windows-server-2016-2019%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Prepare Hyper-V template of Windows Server 2016/2019 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fkamilpro.com%2fprepare-hyper-v-template-of-windows-server-2016-2019%2f&title=Prepare%20Hyper-V%20template%20of%20Windows%20Server%202016%2f2019"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Prepare Hyper-V template of Windows Server 2016/2019 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fkamilpro.com%2fprepare-hyper-v-template-of-windows-server-2016-2019%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Prepare Hyper-V template of Windows Server 2016/2019 on whatsapp" href="https://api.whatsapp.com/send?text=Prepare%20Hyper-V%20template%20of%20Windows%20Server%202016%2f2019%20-%20https%3a%2f%2fkamilpro.com%2fprepare-hyper-v-template-of-windows-server-2016-2019%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Prepare Hyper-V template of Windows Server 2016/2019 on telegram" href="https://telegram.me/share/url?text=Prepare%20Hyper-V%20template%20of%20Windows%20Server%202016%2f2019&amp;url=https%3a%2f%2fkamilpro.com%2fprepare-hyper-v-template-of-windows-server-2016-2019%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Prepare Hyper-V template of Windows Server 2016/2019 on ycombinator" href="https://news.ycombinator.com/submitlink?t=Prepare%20Hyper-V%20template%20of%20Windows%20Server%202016%2f2019&u=https%3a%2f%2fkamilpro.com%2fprepare-hyper-v-template-of-windows-server-2016-2019%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://kamilpro.com/>Kamil Pro</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>