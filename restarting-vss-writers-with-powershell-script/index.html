<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Restarting VSS Writers with PowerShell script | Kamil Pro</title><meta name=keywords content="backup,feat,powershell,regex,select-string,vss writer,vssadmin,vsswriter"><meta name=description content="VSS Writers are responsible for backups – if they stop working, then backups might fail. The solution to that is restarting VSS Writers, but the problem here is that there are many, and at least out of the box, there’s no mechanism to make this automatic… but there’s PowerShell.
I’m not interested in your code, I just want to restart these VSS Writers In that case, head on to: mygithub, use the code and run:"><meta name=author content="Kamil"><link rel=canonical href=https://kamilpro.github.io/restarting-vss-writers-with-powershell-script/><link crossorigin=anonymous href=/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U+6hYRq/Ez/nm5vg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://kamilpro.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://kamilpro.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://kamilpro.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://kamilpro.github.io/apple-touch-icon.png><link rel=mask-icon href=https://kamilpro.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=text/plain href=https://kamilpro.github.io/restarting-vss-writers-with-powershell-script/index.md><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Restarting VSS Writers with PowerShell script"><meta property="og:description" content="VSS Writers are responsible for backups – if they stop working, then backups might fail. The solution to that is restarting VSS Writers, but the problem here is that there are many, and at least out of the box, there’s no mechanism to make this automatic… but there’s PowerShell.
I’m not interested in your code, I just want to restart these VSS Writers In that case, head on to: mygithub, use the code and run:"><meta property="og:type" content="article"><meta property="og:url" content="https://kamilpro.github.io/restarting-vss-writers-with-powershell-script/"><meta property="og:image" content="https://kamilpro.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-12-01T18:27:18+00:00"><meta property="article:modified_time" content="2022-01-03T19:48:21+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kamilpro.github.io/logo.png"><meta name=twitter:title content="Restarting VSS Writers with PowerShell script"><meta name=twitter:description content="VSS Writers are responsible for backups – if they stop working, then backups might fail. The solution to that is restarting VSS Writers, but the problem here is that there are many, and at least out of the box, there’s no mechanism to make this automatic… but there’s PowerShell.
I’m not interested in your code, I just want to restart these VSS Writers In that case, head on to: mygithub, use the code and run:"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://kamilpro.github.io/posts/"},{"@type":"ListItem","position":3,"name":"Restarting VSS Writers with PowerShell script","item":"https://kamilpro.github.io/restarting-vss-writers-with-powershell-script/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Restarting VSS Writers with PowerShell script","name":"Restarting VSS Writers with PowerShell script","description":"VSS Writers are responsible for backups – if they stop working, then backups might fail. The solution to that is restarting VSS Writers, but the problem here is that there are many, and at least out of the box, there’s no mechanism to make this automatic… but there’s PowerShell.\nI’m not interested in your code, I just want to restart these VSS Writers In that case, head on to: mygithub, use the code and run:","keywords":["backup","feat","powershell","regex","select-string","vss writer","vssadmin","vsswriter"],"articleBody":"VSS Writers are responsible for backups – if they stop working, then backups might fail. The solution to that is restarting VSS Writers, but the problem here is that there are many, and at least out of the box, there’s no mechanism to make this automatic… but there’s PowerShell.\nI’m not interested in your code, I just want to restart these VSS Writers In that case, head on to: mygithub, use the code and run:\nGet-KPVSSWriter -Status Failed | Restart-KPVssWriter That function will go ahead, retrieve all failed VSS Writers, and restart associated services with them. If that won’t help, then you probably need to reboot the server.\nGet-KPVssWriter\nLet’s talk PowerShell The source code is available on GitHub.\nAs far as VSS Writers go, there were a few issues needed to be addressed for the function:\nthe VssAdmin.exe tool is CMD only, and returns only strings. There’s no filter in VssAdmin, thus it always returns all writers The writers are associated with many Windows Services, and it’s not always obvious which service is responsible for given VSS Writer Therefore I’ve written a couple of functions:\nGet-KPVssWriter – that function will convert the output string from VssAdmin into a PowerShell objects + it can filter results by state (at the moment Stable or Failed). Restart-KPVssWriter – this function takes the name of the VSS writer and restarts required service with it. It has hard-coded names of VSS writers with associated services. How do you make a use of these?\nYou pipe results from Get function, to Restart function thus:\nGet-KPVSSWriter -Status Failed | Restart-KPVssWriter will retrieve all failed writers and restart them. Let’s look into actual code.\nGet-KPVssWriter First is to run VSSAdmin and start converting the output into PowerShell object:\nSelect-String VSSAdmin list writers | Select-String -Pattern 'Writer name:' -Context 0, 4 These two lines will convert the output from vssadmin into PowerShell object. The Select-String really shines here as:\n-Pattern parameter allows it to search for a specific phrase. In that case I’m looking for ‘Writer name:’ as each listed writer starts with that line. -Context 0,4 tells PowerShell that for each pattern (line) you found, match 0 line prior to it, and 4 past it. Thus if we look for this sample:\nWriter name: 'SqlServerWriter' Writer Id: {a65faa63-5ea8-4ebc-9dbd-a0c4db26912a} Writer Instance Id: {9a2c071c-f231-4a9d-abb3-0b15e1866b79} State: [1] Stable Last error: No error Writer name: 'ASR Writer' Writer Id: {be000cbe-11fe-4426-9c58-531aa6355fc4} Writer Instance Id: {1dcb9866-6b86-4a5f-8dcc-eaf270bbfb2b} State: [1] Stable Last error: No error Writer name: 'MSSearch Service Writer' Writer Id: {cd3f2362-8bef-46c7-9181-d62844cdc0b2} Writer Instance Id: {b4a2be5b-71d4-4579-871c-94b725607c33} State: [1] Stable Last error: No error You can see that there’s pattern: Each Writer Name is followed by four line of text, and then the next one appears.\nSelect-String will then create an object for each pattern found, with properties of Line, Context.PostContext and Context.PreContext.\nAnd since we know that:\nLine = pattern found,\nContext.PostContext = an array of each line found past pattern\nContext.PreContext. = an array of each line found prior the pattern\nIt’s very easy to create the object, but first we need to remove the leftovers of the string.\nReplace ForEach-Object { #Removing clutter Write-Verbose \"Removing clutter \" $Name = $_.Line -replace \"^(.*?): \" -replace \"'\" $Id = $_.Context.PostContext -replace \"^(.*?): \" $InstanceId = $_.Context.PostContext -replace \"^(.*?): \" $State = $_.Context.PostContext -replace \"^(.*?): \" $LastError = $_.Context.PostContext -replace \"^(.*?): \" For every object generated by Select-String, I will assign a specific variable, and run -replace to remove unnecessary characters. Replace can also take regex , making it super effective while working with text.\nPsCustomObject The final step is to assembly all variables created in previous step into a PowerShell object:\nforeach ($Prop in $_) { $Obj = [pscustomobject]@{ Name = $Name Id = $Id InstanceId = $InstanceId State = $State LastError = $LastError } }#foreach Since the main purpose of using this function is to restart failed, I thought it would be worth to add a parameter for filtering out VSS Writers based on status, thus this simple if statement which amends what will be outputed by the function:\nIf ($PSBoundParameters.ContainsKey('Status')) { Write-Verbose \"Filtering out the results\" $Obj | Where-Object { $_.State -like \"*$Status\" } } #if else { $Obj } #else There we go, the analogue application has been converted into a digital form (LOL), we can go ahead now and work on the actual restarts.\nRestart-KPVssWriter This function will take the name of the VSS writer that requires restart, match Windows service to it, and restart the service.\nSwitch PowerShell has a beatifull command – Switch – that eliminates the need of writing complex if statements. Let’s have a look:\nSwitch ($Name) { 'ASR Writer' { $Service = 'VSS' } 'BITS Writer' { $Service = 'BITS' } 'Certificate Authority' { $Service = 'EventSystem' } 'COM+ REGDB Writer' { $Service = 'VSS' } 'DFS Replication service writer' { $Service = 'DFSR' } 'DHCP Jet Writer' { $Service = 'DHCPServer' } 'FRS Writer' { $Service = 'NtFrs' } 'FSRM writer' { $Service = 'srmsvc' } 'IIS Config Writer' { $Service = 'AppHostSvc' } 'IIS Metabase Writer' { $Service = 'IISADMIN' } 'Microsoft Exchange Writer' { $Service = 'MSExchangeIS' } 'Microsoft Hyper-V VSS Writer' { $Service = 'vmms' } 'NTDS' { $Service = 'NTDS' } 'OSearch VSS Writer' { $Service = 'OSearch' } 'OSearch14 VSS Writer' { $Service = 'OSearch14' } 'Registry Writer' { $Service = 'VSS' } 'Shadow Copy Optimization Writer' { $Service = 'VSS' } 'SPSearch VSS Writer' { $Service = 'SPSearch' } 'SPSearch4 VSS Writer' { $Service = 'SPSearch4' } 'SqlServerWriter' { $Service = 'SQLWriter' } 'System Writer' { $Service = 'CryptSvc' } 'TermServLicensing' { $Service = 'TermServLicensing' } 'WINS Jet Writer' { $Service = 'WINS' } 'WMI Writer' { $Service = 'Winmgmt' } default {$Null = $Service} } #Switch Hell yeah, that would be quite a if statement. Instead of that, switch will match the name on the left, and execute the code to the right.\nThe last line is interesting, default – if switch won’t match the name, it will execute that one instead. I’m casting that into $null.\nIf The final step is to restart service:\nIF ($Service) { Write-Verbose \"Found matching service\" $S = Get-Service -Name $Service Write-Host \"Restarting service $(($S).DisplayName)\" $S | Restart-Service -Force } ELSE { Write-Warning \"No service associated with VSS Writer: $Name\" } Simple restart of service if it was matches earlier on, or just write warning if it wasn’t found.\nHappy ever after I hope you found this useful. What can be done here is e.g. put the script into a scheduled task to run hourly, and hopefully you will have one problem less to worry about – as nobody likes to see failed backups on Monday morning.\nPhoto by Jason Yu on Unsplash\n","wordCount":"1122","inLanguage":"en","datePublished":"2019-12-01T18:27:18Z","dateModified":"2022-01-03T19:48:21Z","author":{"@type":"Person","name":"Kamil"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://kamilpro.github.io/restarting-vss-writers-with-powershell-script/"},"publisher":{"@type":"Organization","name":"Kamil Pro","logo":{"@type":"ImageObject","url":"https://kamilpro.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kamilpro.github.io accesskey=h title="Kamil Pro (Alt + H)">Kamil Pro</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://kamilpro.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://kamilpro.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://kamilpro.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href="https://www.youtube.com/playlist?list=PL-esmhgrps8Zv9bAHesStPRQ1AiUL1wY3" title="About PowerShell"><span>About PowerShell</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://kamilpro.github.io/powershell-for-it-professionals/ title="Powershell for IT professionals"><span>Powershell for IT professionals</span></a></li><li><a href=https://github.com/thekamilpro title=GitHub><span><i class='fab fa-github fa-fw'></i></span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Restarting VSS Writers with PowerShell script</h1><div class=post-meta><span title='2019-12-01 18:27:18 +0000 UTC'>2019-12-01</span>&nbsp;·&nbsp;Kamil</div></header><div class=post-content><p>VSS Writers are responsible for backups – if they stop working, then backups might fail. The solution to that is restarting VSS Writers, but the problem here is that there are many, and at least out of the box, there’s no mechanism to make this automatic… but there’s PowerShell.</p><h2 id=i8217m-not-interested-in-your-code-i-just-want-to-restart-these-vss-writers>I’m not interested in your code, I just want to restart these VSS Writers<a hidden class=anchor aria-hidden=true href=#i8217m-not-interested-in-your-code-i-just-want-to-restart-these-vss-writers>#</a></h2><p>In that case, head on to: <a href=https://github.com/kprocyszyn/tools/tree/master/KPVSSWriter>mygithub</a>, use the code and run:</p><pre class=wp-block-code><code>Get-KPVSSWriter -Status Failed | Restart-KPVssWriter</code></pre><p>That function will go ahead, retrieve all failed VSS Writers, and restart associated services with them. If that won’t help, then you probably need to reboot the server.<figure class="wp-block-image size-full is-resized"></p><p><a href="https://i0.wp.com/kamilpro.com/wp-content/uploads/2020/07/KPVssWriter.gif?ssl=1"><img loading=lazy src="https://i0.wp.com/kamilpro.com/wp-content/uploads/2020/07/KPVssWriter.gif?resize=900%2C441&#038;ssl=1" alt="Loading KPVssWriter.ps1 to memory and executing Get-KPVssWriter function" class=wp-image-1624 width=900 height=441 data-recalc-dims=1></a><figcaption>Get-KPVssWriter</figcaption></figure></p><h2 id=let8217s-talk-powershell>Let’s talk PowerShell<a hidden class=anchor aria-hidden=true href=#let8217s-talk-powershell>#</a></h2><p>The source code is available on <a href=https://github.com/kprocyszyn/tools/tree/master/KPVSSWriter>GitHub</a>.</p><p>As far as VSS Writers go, there were a few issues needed to be addressed for the function:</p><ul><li>the VssAdmin.exe tool is CMD only, and returns only strings.</li><li>There’s no filter in VssAdmin, thus it always returns all writers</li><li>The writers are associated with many Windows Services, and it’s not always obvious which service is responsible for given VSS Writer</li></ul><p>Therefore I’ve written a couple of functions:</p><ul><li>Get-KPVssWriter – that function will convert the output string from VssAdmin into a PowerShell objects + it can filter results by state (at the moment Stable or Failed).</li><li>Restart-KPVssWriter – this function takes the name of the VSS writer and restarts required service with it. It has hard-coded names of VSS writers with associated services.</li></ul><p>How do you make a use of these?</p><p>You pipe results from Get function, to Restart function thus:</p><pre class=wp-block-code><code>Get-KPVSSWriter -Status Failed | Restart-KPVssWriter </code></pre><p>will retrieve all failed writers and restart them. Let’s look into actual code.</p><h3 id=get-kpvsswriter>Get-KPVssWriter<a hidden class=anchor aria-hidden=true href=#get-kpvsswriter>#</a></h3><p>First is to run VSSAdmin and start converting the output into PowerShell object:</p><h4 id=select-string>Select-String<a hidden class=anchor aria-hidden=true href=#select-string>#</a></h4><pre class=wp-block-code><code>VSSAdmin list writers | 
        Select-String -Pattern 'Writer name:' -Context 0, 4</code></pre><p>These two lines will convert the output from vssadmin into PowerShell object. The Select-String really shines here as:</p><ul><li>-Pattern parameter allows it to search for a specific phrase. In that case I’m looking for ‘Writer name:’ as each listed writer starts with that line.</li><li>-Context 0,4 tells PowerShell that for each pattern (line) you found, match 0 line prior to it, and 4 past it.</li></ul><p>Thus if we look for this sample:</p><pre class=wp-block-preformatted>Writer name: 'SqlServerWriter'
   Writer Id: {a65faa63-5ea8-4ebc-9dbd-a0c4db26912a}
   Writer Instance Id: {9a2c071c-f231-4a9d-abb3-0b15e1866b79}
   State: [1] Stable
   Last error: No error
Writer name: 'ASR Writer'
   Writer Id: {be000cbe-11fe-4426-9c58-531aa6355fc4}
   Writer Instance Id: {1dcb9866-6b86-4a5f-8dcc-eaf270bbfb2b}
   State: [1] Stable
   Last error: No error
Writer name: 'MSSearch Service Writer'
   Writer Id: {cd3f2362-8bef-46c7-9181-d62844cdc0b2}
   Writer Instance Id: {b4a2be5b-71d4-4579-871c-94b725607c33}
   State: [1] Stable
   Last error: No error</pre><p>You can see that there’s pattern: Each Writer Name is followed by four line of text, and then the next one appears.</p><p>Select-String will then create an object for each pattern found, with properties of Line, Context.PostContext and Context.PreContext.</p><p>And since we know that:</p><p>Line = pattern found,</p><p>Context.PostContext = an array of each line found past pattern</p><p>Context.PreContext. = an array of each line found prior the pattern</p><p>It’s very easy to create the object, but first we need to remove the leftovers of the string.</p><h4 id=replace>Replace<a hidden class=anchor aria-hidden=true href=#replace>#</a></h4><pre class=wp-block-preformatted>ForEach-Object {
            #Removing clutter
            Write-Verbose "Removing clutter "
            $Name = $_.Line -replace "^(.*?): " -replace "'"
            $Id = $_.Context.PostContext -replace "^(.*?): "
            $InstanceId = $_.Context.PostContext -replace "^(.*?): "
            $State = $_.Context.PostContext -replace "^(.*?): "
            $LastError = $_.Context.PostContext -replace "^(.*?): "</pre><p>For every object generated by Select-String, I will assign a specific variable, and run -replace to remove unnecessary characters. Replace can also take regex , making it super effective while working with text.</p><h4 id=pscustomobject>PsCustomObject<a hidden class=anchor aria-hidden=true href=#pscustomobject>#</a></h4><p>The final step is to assembly all variables created in previous step into a PowerShell object:</p><pre class=wp-block-preformatted>foreach ($Prop in $_) {
                $Obj = [pscustomobject]@{
                    Name       = $Name
                    Id         = $Id
                    InstanceId = $InstanceId
                    State      = $State
                    LastError  = $LastError
                } 
            }#foreach  </pre><p>Since the main purpose of using this function is to restart failed, I thought it would be worth to add a parameter for filtering out VSS Writers based on status, thus this simple if statement which amends what will be outputed by the function:</p><pre class=wp-block-code><code> If ($PSBoundParameters.ContainsKey('Status')) {
                Write-Verbose "Filtering out the results"
                $Obj | Where-Object { $_.State -like "*$Status" }
            } #if
            else {
                $Obj
            } #else</code></pre><p>There we go, the analogue application has been converted into a digital form (LOL), we can go ahead now and work on the actual restarts.</p><h3 id=restart-kpvsswriter>Restart-KPVssWriter<a hidden class=anchor aria-hidden=true href=#restart-kpvsswriter>#</a></h3><p>This function will take the name of the VSS writer that requires restart, match Windows service to it, and restart the service.</p><h4 id=switch>Switch<a hidden class=anchor aria-hidden=true href=#switch>#</a></h4><p>PowerShell has a beatifull command – Switch – that eliminates the need of writing complex if statements. Let’s have a look:</p><pre class=wp-block-code><code> Switch ($Name) {
            'ASR Writer' { $Service = 'VSS' }
            'BITS Writer' { $Service = 'BITS' }
            'Certificate Authority' { $Service = 'EventSystem' }
            'COM+ REGDB Writer' { $Service = 'VSS' }
            'DFS Replication service writer' { $Service = 'DFSR' }
            'DHCP Jet Writer' { $Service = 'DHCPServer' }
            'FRS Writer' { $Service = 'NtFrs' }
            'FSRM writer' { $Service = 'srmsvc' }
            'IIS Config Writer' { $Service = 'AppHostSvc' }
            'IIS Metabase Writer' { $Service = 'IISADMIN' }
            'Microsoft Exchange Writer' { $Service = 'MSExchangeIS' }
            'Microsoft Hyper-V VSS Writer' { $Service = 'vmms' }
            'NTDS' { $Service = 'NTDS' }
            'OSearch VSS Writer' { $Service = 'OSearch' }
            'OSearch14 VSS Writer' { $Service = 'OSearch14' }
            'Registry Writer' { $Service = 'VSS' }
            'Shadow Copy Optimization Writer' { $Service = 'VSS' }
            'SPSearch VSS Writer' { $Service = 'SPSearch' }
            'SPSearch4 VSS Writer' { $Service = 'SPSearch4' }
            'SqlServerWriter' { $Service = 'SQLWriter' }
            'System Writer' { $Service = 'CryptSvc' }
            'TermServLicensing' { $Service = 'TermServLicensing' }
            'WINS Jet Writer' { $Service = 'WINS' }
            'WMI Writer' { $Service = 'Winmgmt' }
            default {$Null = $Service}
        } #Switch</code></pre><p>Hell yeah, that would be quite a if statement. Instead of that, switch will match the name on the left, and execute the code to the right.</p><p>The last line is interesting, default – if switch won’t match the name, it will execute that one instead. I’m casting that into $null.</p><h4 id=if>If<a hidden class=anchor aria-hidden=true href=#if>#</a></h4><p>The final step is to restart service:</p><pre class=wp-block-code><code>  IF ($Service) {
            Write-Verbose "Found matching service"
            $S = Get-Service -Name $Service
            Write-Host "Restarting service $(($S).DisplayName)"
            $S | Restart-Service -Force
        }
        ELSE {
            Write-Warning "No service associated with VSS Writer: $Name"
        }</code></pre><p>Simple restart of service if it was matches earlier on, or just write warning if it wasn’t found.</p><h2 id=happy-ever-after>Happy ever after<a hidden class=anchor aria-hidden=true href=#happy-ever-after>#</a></h2><p>I hope you found this useful. What can be done here is e.g. put the script into a scheduled task to run hourly, and hopefully you will have one problem less to worry about – as nobody likes to see failed backups on Monday morning.</p><p>Photo by <a href="https://unsplash.com/@jason_yu?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Jason Yu</a> on <a href="https://unsplash.com/s/photos/writer?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://kamilpro.github.io/tags/backup/>backup</a></li><li><a href=https://kamilpro.github.io/tags/feat/>feat</a></li><li><a href=https://kamilpro.github.io/tags/powershell/>powershell</a></li><li><a href=https://kamilpro.github.io/tags/regex/>regex</a></li><li><a href=https://kamilpro.github.io/tags/select-string/>select-string</a></li><li><a href=https://kamilpro.github.io/tags/vss-writer/>vss writer</a></li><li><a href=https://kamilpro.github.io/tags/vssadmin/>vssadmin</a></li><li><a href=https://kamilpro.github.io/tags/vsswriter/>vsswriter</a></li></ul></footer></article></main><footer class=footer><span>Kamil Procyszyn</span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>