<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Ultimate Windows Update fix - Kamil Procyszyn</title><meta name="Description" content="Sysadmin&#39;s point of view"><meta property="og:title" content="Ultimate Windows Update fix" />
<meta property="og:description" content="The reason I manage hundreds of workstations working on various Windows versions. As we know, Windows (and other Microsoft’s software) is updated monthly. While usually the process is just working fine, sometimes it simply doesn’t want to work.
And yes, probably Google is your best friend here… but really, who has time to search for the solution, and apply it, manually, if there is more than 1 computer?
Use the script I used technet, different posts and own knowledge of fixing that kind of issues." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://kprocyszyn.github.io/ultimate-windows-update-fix/" /><meta property="og:image" content="https://kprocyszyn.github.io/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-10-29T22:12:15+00:00" />
<meta property="article:modified_time" content="2022-01-03T19:48:21+00:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://kprocyszyn.github.io/logo.png"/>

<meta name="twitter:title" content="Ultimate Windows Update fix"/>
<meta name="twitter:description" content="The reason I manage hundreds of workstations working on various Windows versions. As we know, Windows (and other Microsoft’s software) is updated monthly. While usually the process is just working fine, sometimes it simply doesn’t want to work.
And yes, probably Google is your best friend here… but really, who has time to search for the solution, and apply it, manually, if there is more than 1 computer?
Use the script I used technet, different posts and own knowledge of fixing that kind of issues."/>
<meta name="application-name" content="Kamil Procyszyn">
<meta name="apple-mobile-web-app-title" content="Kamil Procyszyn"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://kprocyszyn.github.io/ultimate-windows-update-fix/" /><link rel="prev" href="https://kprocyszyn.github.io/powershell-resolve-full-names-usernames-csv-file/" /><link rel="next" href="https://kprocyszyn.github.io/powershell-tool-resolve-ip-and-dns/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><meta name="google-site-verification" content="NniR9DFiwo_hSUsjXQj7xw3IHmRtl0ICeu4UmstK680" /><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Ultimate Windows Update fix",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/kprocyszyn.github.io\/ultimate-windows-update-fix\/"
        },"image": ["https:\/\/kprocyszyn.github.io\/images\/Apple-Devices-Preview.png"],"genre": "posts","wordcount":  417 ,
        "url": "https:\/\/kprocyszyn.github.io\/ultimate-windows-update-fix\/","datePublished": "2017-10-29T22:12:15+00:00","dateModified": "2022-01-03T19:48:21+00:00","license": "Kamil Procyszyn","publisher": {
            "@type": "Organization",
            "name": "Kamil Procyszyn","logo": {
                    "@type": "ImageObject",
                    "url": "https:\/\/kprocyszyn.github.io\/images\/avatar.png",
                    "width":  150 ,
                    "height":  150 
                }},"author": {
                "@type": "Person",
                "name": "Kamil"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Kamil Procyszyn">Kamil Procyszyn<span class="header-title-post"><i class='fas fa-terminal'></i></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/powershell-for-it-professionals/"> Powershell for IT professionals </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="https://github.com/kprocyszyn" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Kamil Procyszyn">Kamil Procyszyn<span class="header-title-post"><i class='fas fa-terminal'></i></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/powershell-for-it-professionals/" title="">Powershell for IT professionals</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="https://github.com/kprocyszyn" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Ultimate Windows Update fix</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>Kamil</a></span>&nbsp;<span class="post-category">included in <a href="/categories/it/"><i class="far fa-folder fa-fw"></i>IT</a>&nbsp;<a href="/categories/windows/"><i class="far fa-folder fa-fw"></i>Windows</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2017-10-29">2017-10-29</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;417 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;2 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#the-reason">The reason</a></li>
    <li><a href="#use-the-script">Use the script</a></li>
    <li><a href="#how-to-use-the-script">How to use the script?</a></li>
    <li><a href="#let-me-know-how-it-worked">Let me know how it worked!</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="the-reason">The reason</h2>
<p>I manage hundreds of workstations working on various Windows versions. As we know, Windows (and other Microsoft’s software) is updated monthly. While usually the process is just working fine, sometimes it simply doesn’t want to work.</p>
<p>And yes, probably Google is your best friend here… but really, who has time to search for the solution, and apply it, manually, if there is more than 1 computer?</p>
<h2 id="use-the-script">Use the script</h2>
<p>I used technet, different posts and own knowledge of fixing that kind of issues. All it needs, is admin rights.</p>
<p>So what does the script do?</p>
<ol>
<li>Stops all services needed by Windows update</li>
<li>Points client to download updates directly from Microsoft servers. I’ve noticed that if you don’t downstream all categories of updates (as this takes tonnes of free space) there might be an issue with downloading further updates. Still, if you’d like to keep using your internal update server, simply remove line no.5, starting with ‘reg delete’ and ending with ‘WindowsUpdate /f’.</li>
<li>Removes local copies/cache/information of updates. Sometimes updates get corrupted, and the only way is to purge the catalogue, so that Windows Update will rebuild it next time you run updates.</li>
<li>Restarting all services. You might notice that there is one service which hasn’t been stopped before – MpsSvc – it’s responsible for Windows Firewall. I’ve noticed that Windows Firewall service must be running (even if you don’t use it/use a different firewall), otherwise updates will fail to download.</li>
<li>Run Windows update. I couldn’t figure it out (and couldn’t find the actual answer to this) but triggering the Windows Update from the command line doesn’t always work.</li>
</ol>
<p>After all this, just go and fire out Windows Update, allow a few minutes and it should work.</p>
<h2 id="how-to-use-the-script">How to use the script?</h2>
<pre spellcheck="false" class="">net stop wuauserv
net stop cryptSvc
net stop bits
net stop msiserver

reg delete HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\WindowsUpdate /f
Del "%ALLUSERSPROFILE%\Application Data\Microsoft\Network\Downloader\qmgr*.dat"
Ren %systemroot%\SoftwareDistribution SoftwareDistribution.bak
Ren %systemroot%\system32\catroot2 catroot2.bak

netsh winsock reset

net start wuauserv
net start cryptSvc
net start bits
net start msiserver
net start MpsSvc

</pre>
<p>All you need to do now, is paste the script from above to the notepad, save it as ‘Fix Updates.bat’ (don’t forget to pick All Files (*.*) from the drop down menu in Save As window. Then right click a newly created file, and choose run as administrator.</p>
<h2 id="let-me-know-how-it-worked">Let me know how it worked!</h2>
<p>This is my first ever IT strict post – let me know how you’ve found it! Was it useful? Was it explained well? I’d like to know!</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2022-01-03&nbsp;<a class="git-hash" href="https://github.com/kprocyszyn/commit/dfb5243d796d93396da474840d2b2063421897ad" target="_blank" title="commit by Kamil Procyszyn(kprocyszyn@gmail.com) dfb5243d796d93396da474840d2b2063421897ad: Add featured images">
                                    <i class="fas fa-hashtag fa-fw"></i>dfb5243</a></span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/ultimate-windows-update-fix/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://kprocyszyn.github.io/ultimate-windows-update-fix/" data-title="Ultimate Windows Update fix" data-via="@kprocyszyn"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://kprocyszyn.github.io/ultimate-windows-update-fix/"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://kprocyszyn.github.io/ultimate-windows-update-fix/" data-title="Ultimate Windows Update fix"><i class="fab fa-hacker-news fa-fw"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://kprocyszyn.github.io/ultimate-windows-update-fix/" data-title="Ultimate Windows Update fix"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/line.svg"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="https://kprocyszyn.github.io/ultimate-windows-update-fix/" data-title="Ultimate Windows Update fix"><i class="fab fa-weibo fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/powershell-resolve-full-names-usernames-csv-file/" class="prev" rel="prev" title="Powershell – resolve full names to usernames from CSV file"><i class="fas fa-angle-left fa-fw"></i>Powershell – resolve full names to usernames from CSV file</a>
            <a href="/powershell-tool-resolve-ip-and-dns/" class="next" rel="next" title="Resolve IP and DNS with Powershell tool">Resolve IP and DNS with Powershell tool<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.91.2">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2014 - 2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Kamil Procyszyn</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lunr@2.3.8/lunr.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
