<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Prepare Hyper-V template of Windows Server 2016/2019 - Kamil Procyszyn</title><meta name="Description" content="Sysadmin&#39;s point of view"><meta property="og:title" content="Prepare Hyper-V template of Windows Server 2016/2019" />
<meta property="og:description" content="Deploying a new server is always fun! Well, at least the part after ISO download, installation, patching. Having said that, why not create a template so that you jump right into the fun?
So we are essentially going to create a preconfigured VHDX file that can be attached to the newly created VM, and it will take you straight to the login screen.
What’s needed  Windows server or Windows 10 with Hyper-V role and management tools enabled Windows Assessment and Deployment Toolkit (ADK) – I always pick the latest version available, at the moment of writing this – Windows 10, version 1903 – is latest." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://kprocyszyn.github.io/prepare-hyper-v-template-of-windows-server-2016-2019/" /><meta property="og:image" content="https://kprocyszyn.github.io/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-03-08T10:52:17+00:00" />
<meta property="article:modified_time" content="2022-01-03T19:48:21+00:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://kprocyszyn.github.io/logo.png"/>

<meta name="twitter:title" content="Prepare Hyper-V template of Windows Server 2016/2019"/>
<meta name="twitter:description" content="Deploying a new server is always fun! Well, at least the part after ISO download, installation, patching. Having said that, why not create a template so that you jump right into the fun?
So we are essentially going to create a preconfigured VHDX file that can be attached to the newly created VM, and it will take you straight to the login screen.
What’s needed  Windows server or Windows 10 with Hyper-V role and management tools enabled Windows Assessment and Deployment Toolkit (ADK) – I always pick the latest version available, at the moment of writing this – Windows 10, version 1903 – is latest."/>
<meta name="application-name" content="Kamil Procyszyn">
<meta name="apple-mobile-web-app-title" content="Kamil Procyszyn"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://kprocyszyn.github.io/prepare-hyper-v-template-of-windows-server-2016-2019/" /><link rel="prev" href="https://kprocyszyn.github.io/restarting-vss-writers-with-powershell-script/" /><link rel="next" href="https://kprocyszyn.github.io/deploying-software-with-gpo/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><meta name="google-site-verification" content="NniR9DFiwo_hSUsjXQj7xw3IHmRtl0ICeu4UmstK680" /><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Prepare Hyper-V template of Windows Server 2016/2019",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/kprocyszyn.github.io\/prepare-hyper-v-template-of-windows-server-2016-2019\/"
        },"image": ["https:\/\/kprocyszyn.github.io\/images\/Apple-Devices-Preview.png"],"genre": "posts","keywords": "hyper-v, server, sysprep, template","wordcount":  1356 ,
        "url": "https:\/\/kprocyszyn.github.io\/prepare-hyper-v-template-of-windows-server-2016-2019\/","datePublished": "2020-03-08T10:52:17+00:00","dateModified": "2022-01-03T19:48:21+00:00","license": "Kamil Procyszyn","publisher": {
            "@type": "Organization",
            "name": "Kamil Procyszyn","logo": {
                    "@type": "ImageObject",
                    "url": "https:\/\/kprocyszyn.github.io\/images\/avatar.png",
                    "width":  150 ,
                    "height":  150 
                }},"author": {
                "@type": "Person",
                "name": "Kamil"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Kamil Procyszyn">Kamil Procyszyn<span class="header-title-post"><i class='fas fa-terminal'></i></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/powershell-for-it-professionals/"> Powershell for IT professionals </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="https://github.com/kprocyszyn" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Kamil Procyszyn">Kamil Procyszyn<span class="header-title-post"><i class='fas fa-terminal'></i></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/powershell-for-it-professionals/" title="">Powershell for IT professionals</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="https://github.com/kprocyszyn" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Prepare Hyper-V template of Windows Server 2016/2019</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>Kamil</a></span>&nbsp;<span class="post-category">included in <a href="/categories/deployment/"><i class="far fa-folder fa-fw"></i>Deployment</a>&nbsp;<a href="/categories/it/"><i class="far fa-folder fa-fw"></i>IT</a>&nbsp;<a href="/categories/server/"><i class="far fa-folder fa-fw"></i>Server</a>&nbsp;<a href="/categories/windows/"><i class="far fa-folder fa-fw"></i>Windows</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2020-03-08">2020-03-08</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1356 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;7 minutes&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/wp-content/uploads/2020/03/dan-gold-mgaS4FlsYxQ-unsplash.jpg"
        data-srcset="/wp-content/uploads/2020/03/dan-gold-mgaS4FlsYxQ-unsplash.jpg, /wp-content/uploads/2020/03/dan-gold-mgaS4FlsYxQ-unsplash.jpg 1.5x, /wp-content/uploads/2020/03/dan-gold-mgaS4FlsYxQ-unsplash.jpg 2x"
        data-sizes="auto"
        alt="/wp-content/uploads/2020/03/dan-gold-mgaS4FlsYxQ-unsplash.jpg"
        title="/wp-content/uploads/2020/03/dan-gold-mgaS4FlsYxQ-unsplash.jpg" /></div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#hyper-v">Hyper-V</a></li>
    <li><a href="#adk">ADK</a></li>
    <li><a href="#files-extraction-from-iso">Files extraction from ISO</a></li>
  </ul>

  <ul>
    <li><a href="#start-your-vm-and-prepare-it-as-you-wish">Start your VM and prepare it as you wish</a></li>
  </ul>

  <ul>
    <li><a href="#i8217ve-got-my-template-what-now">I’ve got my template, what now?</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>Deploying a new server is always fun! Well, at least the part after ISO download, installation, patching. Having said that, why not create a template so that you jump right into the fun?</p>
<p>So we are essentially going to create a preconfigured VHDX file that can be attached to the newly created VM, and it will take you straight to the login screen.</p>
<h1 id="what8217s-needed">What’s needed</h1>
<ul>
<li>Windows server or Windows 10 with Hyper-V role and management tools enabled</li>
<li><a href="https://docs.microsoft.com/en-us/windows-hardware/get-started/adk-install" target="_blank" rel="noopener noreffer">Windows Assessment and Deployment Toolkit (ADK)</a> – I always pick the latest version available, at the moment of writing this – Windows 10, version 1903 – is latest.</li>
<li>ISO with the source – I’ve used Server for 2016/2019 from my.visualstudio.com (you need an MSDN subscription for this), or from <a href="https://www.microsoft.com/en-us/evalcenter/evaluate-windows-server-2019?filetype=ISO" target="_blank" rel="noopener noreffer">trial center</a></li>
</ul>
<h1 id="preparation">Preparation</h1>
<h2 id="hyper-v">Hyper-V</h2>
<p>Open Windows PowerShell as admin and paste this command:</p>
<pre class="wp-block-preformatted">Install-WindowsFeature -Name Hyper-V -IncludeAllSubFeature -Verbose</pre>
<p>You will need to reboot your computer for hyper-v to become available</p>
<p><strong>Install External switch</strong></p>
<p>If you want to allow your template VM to connect to the Internet e.g. To download and install patches, you need an external switch set up on Hyper-V.</p>
<p>Open Hyper-V Manage and choose “Virtual Switch Manager” from the right-hand side pane,<figure class="wp-block-image size-large"></p>
<p><img loading="lazy" width="900" height="822" src="https://i2.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-1-e1583662120195-1.jpg?resize=900%2C822&#038;ssl=1" alt="" class="wp-image-1575" srcset="https://i2.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-1-e1583662120195-1.jpg?w=916&ssl=1 916w, https://i2.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-1-e1583662120195-1.jpg?resize=300%2C274&ssl=1 300w, https://i2.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-1-e1583662120195-1.jpg?resize=768%2C702&ssl=1 768w, https://i2.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-1-e1583662120195-1.jpg?resize=755%2C690&ssl=1 755w" sizes="(max-width: 900px) 100vw, 900px" data-recalc-dims="1" /> </figure></p>
<p>Make sure you highlight the external switch and click Create Virtual Switch</p>
<p>On the next page give it a name, specify which network card connect it to and confirm.</p>
<p>Or use Powershell (it will attach VM switch to the first network adapter):</p>
<pre class="wp-block-preformatted">$A = Get-NetAdapter 
New-VMSwitch -Name "ext1" -NetAdapterName $a[0].name</pre>
<h2 id="adk">ADK</h2>
<p>Go to the <a href="https://docs.microsoft.com/en-us/windows-hardware/get-started/adk-install" target="_blank" rel="noopener noreffer">link</a> and download the latest ADK. When installing, make sure “Deployment tools” is selected – we are after Windows System Image Manager (SIM).<figure class="wp-block-image size-large"></p>
<p><img loading="lazy" width="900" height="668" src="https://i0.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-1-1-e1583663086572-1.jpg?resize=900%2C668&#038;ssl=1" alt="" class="wp-image-1580" srcset="https://i0.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-1-1-e1583663086572-1.jpg?w=950&ssl=1 950w, https://i0.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-1-1-e1583663086572-1.jpg?resize=300%2C223&ssl=1 300w, https://i0.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-1-1-e1583663086572-1.jpg?resize=768%2C570&ssl=1 768w, https://i0.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-1-1-e1583663086572-1.jpg?resize=930%2C690&ssl=1 930w" sizes="(max-width: 900px) 100vw, 900px" data-recalc-dims="1" /> </figure></p>
<h2 id="files-extraction-from-iso">Files extraction from ISO</h2>
<p>We need to extract <em>install.wim</em> file from the installation media. The file is a compressed Windows Image and is being used by SIM to create the answer file.</p>
<p>Double click on the ISO so that it mounts, go to Mounted ISO\Sources and copy <em>install.wim</em> (it has a few gigabytes in size, biggest file in the folder) to your work directory.</p>
<p>You can unmount the ISO now, by right-clicking on it and choosing Unmount.</p>
<p>At this stage, we have everything we need to work.</p>
<h1 id="create-vm-and-install-from-iso">Create VM and install from ISO</h1>
<p>Head to the Hyper-V Manager and choose to create a new VM, and options you choose:</p>
<p>Name: Something meaningful like e.g. Template – Server 2019 Standard GUI</p>
<p>Generation: Generation 2<br>
Assign Memory: Anything above 2048MB should be enough<br>
Configure networking: If you’ve created the external switch, pick it here<br>
Virtual Hard Disk: You can change default location and size. By default it will be dynamically expanding, that means it will only take as much space as needed.<br>
Installation Options: point to the ISO</p>
<p>On summary click finish.</p>
<p>What you can do at the stage is to give it more CPUs, 2 at least. It’s all about speed.</p>
<h2 id="start-your-vm-and-prepare-it-as-you-wish">Start your VM and prepare it as you wish</h2>
<p>Now you can customise your server installation as you wish. Since it’s a server, I have tendency to only install updates, with the principal the less the better. But you can do whatever you’re fancy.</p>
<p>Once you’re finished, take a checkpoint, as we are going to test if syspreping works.</p>
<p>Press Windows + R and run:</p>
<p>%windir%\system32\sysprep\sysprep.exe</p>
<p>This will launch the System Preparation tool, aka sysprep. <figure class="wp-block-image size-large"></p>
<p><img loading="lazy" width="424" height="317" src="https://i2.wp.com/kamilpro.com/wp-content/uploads/2020/03/image.jpg?resize=424%2C317&#038;ssl=1" alt="System Preparation Tool 3.14 
Systern Prepua&m Tod 
Systen 
Ente SFten (lat •of-ux " class="wp-image-1552" srcset="https://i2.wp.com/kamilpro.com/wp-content/uploads/2020/03/image.jpg?w=424&ssl=1 424w, https://i2.wp.com/kamilpro.com/wp-content/uploads/2020/03/image.jpg?resize=300%2C224&ssl=1 300w" sizes="(max-width: 424px) 100vw, 424px" data-recalc-dims="1" /> </figure></p>
<p>Configure it as:</p>
<ul>
<li>OOBE</li>
<li>Generalize</li>
<li>Reboot</li>
</ul>
<p>IF you haven’t taken the checkpoint when I’ve asked last time, do it now.</p>
<p>Checkpoint taken? Great, press ok and let the system reboot.</p>
<p>What will happen now is Windows will remove any unique identifiers, enabled drivers etc. Making it neutral.</p>
<p>Once your sysprep is completed, you’ll see a standard installation questions like language and administrator password – this is expected. At this stage, we are only testing if whatever changes you’ve made so far, don’t interfere with the sysprep process.</p>
<p>The successful test is considered when you can log in to Windows.</p>
<p>Roll back the VM to the checkpoint you’ve taken before trying sysprep.</p>
<h1 id="prepare-the-answer-file">Prepare the answer file</h1>
<p>Now we can move to a so-called answer/unattend file. The purpose of the file is to “answer” the installation questions for you, thus if the installer can find all answers, it will simply get you to the login screen after the first run.<figure class="wp-block-image size-large"></p>
<p><img loading="lazy" width="900" height="452" src="https://i2.wp.com/kamilpro.com/wp-content/uploads/2020/03/SIM-new-catalogue.gif?resize=900%2C452&#038;ssl=1" alt="" class="wp-image-1565" srcset="https://i2.wp.com/kamilpro.com/wp-content/uploads/2020/03/SIM-new-catalogue.gif?resize=1024%2C514&ssl=1 1024w, https://i2.wp.com/kamilpro.com/wp-content/uploads/2020/03/SIM-new-catalogue.gif?resize=300%2C151&ssl=1 300w, https://i2.wp.com/kamilpro.com/wp-content/uploads/2020/03/SIM-new-catalogue.gif?resize=768%2C386&ssl=1 768w, https://i2.wp.com/kamilpro.com/wp-content/uploads/2020/03/SIM-new-catalogue.gif?resize=1536%2C772&ssl=1 1536w, https://i2.wp.com/kamilpro.com/wp-content/uploads/2020/03/SIM-new-catalogue.gif?resize=1373%2C690&ssl=1 1373w, https://i2.wp.com/kamilpro.com/wp-content/uploads/2020/03/SIM-new-catalogue.gif?w=1800&ssl=1 1800w" sizes="(max-width: 900px) 100vw, 900px" data-recalc-dims="1" /> </figure></p>
<p>Open SIM, choose File &gt; New Answer File &gt; Point it to the install.wim file you’ve copied earlier</p>
<p>In the window say Yes</p>
<p>Choose the Windows edition you’d like to install and in following, windows say Yes</p>
<p>SIM will now start creating a catalogue with all possible options for the image, this process can take good 10 minutes. Just let it work.</p>
<p>When completed, you will see windows like that:<figure class="wp-block-image size-large"></p>
<p><img loading="lazy" width="1920" height="1080" src="https://i1.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-2-1.jpg?fit=900%2C506&ssl=1" alt="untitled - Windows System Image Manager 
File Edit Insert Tools Help 
Select a 
17763. I _nedrS 
177631 _neWS 
Add Setting to pass I windowsPE 
Add Setting to Pass 2 offlineServicing 
Add Seting to pass 3 genealize 
Add Setting to pass specialize 
Add Setting to pass 5 auditSystem 
Add Setting to Pass 6 auditUser 
Add Setting to pass 7 00beSystem 
x 
I widowsPE 
2 Serve-g 
6 •H User 
XML (O (O Sd (O 
%rosoft-Whdows- BrowserServke 
Passes 
Serverl_Ä 
Copy 
Ctrl. C 
I O. 17763. I _ne•-n 
I O. 17763. I 
17763. I _ne-trS 
17763. I 
13:34 
05/03/2020 " class="wp-image-1557" srcset="https://i1.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-2-1.jpg?w=1920&ssl=1 1920w, https://i1.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-2-1.jpg?resize=300%2C169&ssl=1 300w, https://i1.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-2-1.jpg?resize=1024%2C576&ssl=1 1024w, https://i1.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-2-1.jpg?resize=768%2C432&ssl=1 768w, https://i1.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-2-1.jpg?resize=1536%2C864&ssl=1 1536w, https://i1.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-2-1.jpg?resize=1260%2C709&ssl=1 1260w, https://i1.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-2-1.jpg?resize=800%2C450&ssl=1 800w, https://i1.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-2-1.jpg?resize=1227%2C690&ssl=1 1227w, https://i1.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-2-1.jpg?w=1800&ssl=1 1800w" sizes="(max-width: 900px) 100vw, 900px" /> </figure></p>
<p>And we are after to panes here: Answer File and Windows image.</p>
<ul>
<li>Windows Image is where you choose what to add to and to which phase of OS deployment</li>
<li>The answer file is where you configure specific answers</li>
</ul>
<p>For start you’d like to add components:</p>
<ul>
<li> amd64_Microsoft-Windows-International-Core, to Pass 4 Specialize and Pass 7 OOBE system</li>
<li>amd64_Microsoft-Windows-International-Core, to Pass 7 OOBE System</li>
</ul>
<p>You do this by right-clicking the component Windows Image pane and choose the phase you’d like to add. There are many very similarly named records, thus pay attention.</p>
<p>Once added, you will see three “empty boxes” in the Answer File section.</p>
<p>Let’s configure  amd64_Microsoft-Windows-International-Core first, in both phases:<figure class="wp-block-image size-large"></p>
<p><img loading="lazy" width="1920" height="1080" src="https://i0.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-3.jpg?fit=900%2C506&ssl=1" alt="unattend.xml• - Windows System Image Manager 
File Edit Insert Tools Help 
17Æ3_ 
I _neWd 
I _neWd 
17763. I _neWd 
I _neWd 
17763. I _neWd 
17763. I 
17763. I 
17Æ3. I _neWd 
I S-4_neWd 
17763. I _neWd 
17763. I 
I _O. 17Æ3_ 
I 17763. I 
I 17763. I 
I _nedrd 
17Æ3_ I 
x 
nater-d 
I wrdowsPE 
XML (O) (O) Cor-fvün Sa (O) 
%rosoft-Whdows- InternathnaVCore 
Pass 
O'-GB 
13:45 
05/03/2020 " class="wp-image-1556" srcset="https://i0.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-3.jpg?w=1920&ssl=1 1920w, https://i0.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-3.jpg?resize=300%2C169&ssl=1 300w, https://i0.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-3.jpg?resize=1024%2C576&ssl=1 1024w, https://i0.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-3.jpg?resize=768%2C432&ssl=1 768w, https://i0.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-3.jpg?resize=1536%2C864&ssl=1 1536w, https://i0.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-3.jpg?resize=1260%2C709&ssl=1 1260w, https://i0.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-3.jpg?resize=800%2C450&ssl=1 800w, https://i0.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-3.jpg?resize=1227%2C690&ssl=1 1227w, https://i0.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-3.jpg?w=1800&ssl=1 1800w" sizes="(max-width: 900px) 100vw, 900px" /> </figure></p>
<p>By selecting one, you enter its values on the right-hand side pane Properties.</p>
<p>You’d like to fill three fields: InputLocale, SystemLocale, UILanguage – in my example below you can see set up for British language. How can you find out all possible combinations? When you right-click the components in Answer File and choose Help it will take you to the website which enlists all values/language you can insert into these fields.</p>
<p>Time for amd64_Microsoft-Windows-Shell-Setup in here we need to values:</p>
<p>In the root\OOBE amend the record of HideEULAPage to True</p>
<p>And in root\UserAccounts\AdministratorPassword enter the password for the Administrator account.</p>
<p>After finishing it should look like this:<figure class="wp-block-image size-large"></p>
<p><img loading="lazy" width="1330" height="790" src="https://i1.wp.com/kamilpro.com/wp-content/uploads/2020/03/SIM-completed-answer-file.gif?fit=900%2C534&ssl=1" alt="" class="wp-image-1568" /> </figure></p>
<p>Press Save &gt; Save Answer File to save the file. We are going to use it for sysprep.</p>
<h1 id="sysprep-with-unattended-file">Sysprep with unattended file</h1>
<p>Copy the answer file to the desktop, and take another checkpoint of your VM.</p>
<p>Open shell as administrator and issue command (My username is Administrator and file is called Unattend.xml):</p>
<pre class="wp-block-preformatted">&nbsp;C:\Windows\System32\Sysprep\Sysprep.exe /unattend:C:\Users\Administrator\Desktop\unattend.xml</pre>
<p>Select OOBE, Generalize and Reboot</p>
<p>What will happen now the system will reboot and after a few minutes you should be welcomed by a login prompt (thus no language, licence, admin password questions) – if so we’re good to export the template for future deployment.</p>
<p>If any questions appear during the deployment phase, double-check your answer file if you’ve included all answers as suggested above.</p>
<h1 id="export-template">Export template</h1>
<p>All right, revert your VM to the last checkpoint. You can rename that check as “Before sysprep” – so that you can always comeback to it and make amendments to your image, or install new updates.</p>
<p>Issue same command once again:</p>
<pre class="wp-block-preformatted">&nbsp;C:\Windows\System32\Sysprep\Sysprep.exe /unattend:C:\Users\Administrator\Desktop\unattend.xml</pre>
<p>But this time choose to shutdown the VM.</p>
<p>When the VM is shutdown, take another snapshot and call it something like “Export this” and export this checkpoint!<figure class="wp-block-image size-large"></p>
<p><img loading="lazy" width="1329" height="446" src="https://i1.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-2-e1583663021491-1.jpg?fit=900%2C302&ssl=1" alt="" class="wp-image-1577" srcset="https://i1.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-2-e1583663021491-1.jpg?w=1329&ssl=1 1329w, https://i1.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-2-e1583663021491-1.jpg?resize=300%2C101&ssl=1 300w, https://i1.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-2-e1583663021491-1.jpg?resize=1024%2C344&ssl=1 1024w, https://i1.wp.com/kamilpro.com/wp-content/uploads/2020/03/image-2-e1583663021491-1.jpg?resize=768%2C258&ssl=1 768w" sizes="(max-width: 900px) 100vw, 900px" /> </figure></p>
<p>Exporting a checkpoint will effectively create a VM with merged VHDX file, and it’s VHDX file we need. All you need to do now is to go to the directory where you’ve exported the VM, and copy VHDX file from it to some place where you store your templates.</p>
<p>Now whenever you create a new VM, rather than pointing it to the ISO and creating a blank hard disk, simply make a copy of your template and attach that disk to VM.</p>
<h2 id="i8217ve-got-my-template-what-now">I’ve got my template, what now?</h2>
<p>Since you’ve got the checkpoint of VM before syspreping, you can always bring install new updates, software etc.</p>
<p>You can use scripting to create new VMs, with the use of the VHDx, thus making it the fully automatic solution.</p>
<p>If the post-deployment configuration is required, but you can’t have this on the golden image (e.g. AV software, management agent) you can use <a href="https://docs.microsoft.com/en-us/windows-hardware/manufacture/desktop/add-a-custom-script-to-windows-setup" target="_blank" rel="noopener noreffer">setupcomplete.cmd</a> file.</p>
<p>If you’re interested in creating Windows 10 image, <a href="https://kamilpro.com/prepare-windows-10-1607-image/" target="_blank" rel="noopener noreffer">read this article</a>.</p>
<p>Photo by <a href="https://unsplash.com/@danielcgold?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" target="_blank" rel="noopener noreffer">Dan Gold</a> on <a href="https://unsplash.com/s/photos/picture?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" target="_blank" rel="noopener noreffer">Unsplash</a></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2022-01-03&nbsp;<a class="git-hash" href="https://github.com/kprocyszyn/commit/dfb5243d796d93396da474840d2b2063421897ad" target="_blank" title="commit by Kamil Procyszyn(kprocyszyn@gmail.com) dfb5243d796d93396da474840d2b2063421897ad: Add featured images">
                                    <i class="fas fa-hashtag fa-fw"></i>dfb5243</a></span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/prepare-hyper-v-template-of-windows-server-2016-2019/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://kprocyszyn.github.io/prepare-hyper-v-template-of-windows-server-2016-2019/" data-title="Prepare Hyper-V template of Windows Server 2016/2019" data-via="@kprocyszyn" data-hashtags="hyper-v,server,sysprep,template"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://kprocyszyn.github.io/prepare-hyper-v-template-of-windows-server-2016-2019/" data-hashtag="hyper-v"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://kprocyszyn.github.io/prepare-hyper-v-template-of-windows-server-2016-2019/" data-title="Prepare Hyper-V template of Windows Server 2016/2019"><i class="fab fa-hacker-news fa-fw"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://kprocyszyn.github.io/prepare-hyper-v-template-of-windows-server-2016-2019/" data-title="Prepare Hyper-V template of Windows Server 2016/2019"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/line.svg"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="https://kprocyszyn.github.io/prepare-hyper-v-template-of-windows-server-2016-2019/" data-title="Prepare Hyper-V template of Windows Server 2016/2019" data-image="/wp-content/uploads/2020/03/dan-gold-mgaS4FlsYxQ-unsplash.jpg"><i class="fab fa-weibo fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/hyper-v/">hyper-v</a>,&nbsp;<a href="/tags/server/">server</a>,&nbsp;<a href="/tags/sysprep/">sysprep</a>,&nbsp;<a href="/tags/template/">template</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/restarting-vss-writers-with-powershell-script/" class="prev" rel="prev" title="Restarting VSS Writers with PowerShell script"><i class="fas fa-angle-left fa-fw"></i>Restarting VSS Writers with PowerShell script</a>
            <a href="/deploying-software-with-gpo/" class="next" rel="next" title="Deploying software with GPO">Deploying software with GPO<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.91.2">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2014 - 2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Kamil Procyszyn</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lunr@2.3.8/lunr.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
