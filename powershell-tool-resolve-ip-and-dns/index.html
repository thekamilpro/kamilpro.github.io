<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Resolve IP and DNS with Powershell tool | Kamil Pro</title><meta name=keywords content="dns,feat,ip,network,powershell,resolve,toolmaking"><meta name=description content="I’ve been asked to prepare a simple tool which would:
Resolve IP address or DNS Return all results to table Import addresses from a file The reason behind was to check how IP/DNS records change over the period of time, therefore there was a need for something like that:
A file with all addresses in question Tool which could import all these addresses and resolve them Save the results into a new file Once having at least a couple of files, the results could be compared."><meta name=author content="Kamil"><link rel=canonical href=https://kamilpro.github.io/powershell-tool-resolve-ip-and-dns/><link crossorigin=anonymous href=/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U+6hYRq/Ez/nm5vg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://kamilpro.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://kamilpro.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://kamilpro.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://kamilpro.github.io/apple-touch-icon.png><link rel=mask-icon href=https://kamilpro.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=text/plain href=https://kamilpro.github.io/powershell-tool-resolve-ip-and-dns/index.md><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Resolve IP and DNS with Powershell tool"><meta property="og:description" content="I’ve been asked to prepare a simple tool which would:
Resolve IP address or DNS Return all results to table Import addresses from a file The reason behind was to check how IP/DNS records change over the period of time, therefore there was a need for something like that:
A file with all addresses in question Tool which could import all these addresses and resolve them Save the results into a new file Once having at least a couple of files, the results could be compared."><meta property="og:type" content="article"><meta property="og:url" content="https://kamilpro.github.io/powershell-tool-resolve-ip-and-dns/"><meta property="og:image" content="https://kamilpro.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-04-29T21:40:00+00:00"><meta property="article:modified_time" content="2022-01-03T19:48:21+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kamilpro.github.io/logo.png"><meta name=twitter:title content="Resolve IP and DNS with Powershell tool"><meta name=twitter:description content="I’ve been asked to prepare a simple tool which would:
Resolve IP address or DNS Return all results to table Import addresses from a file The reason behind was to check how IP/DNS records change over the period of time, therefore there was a need for something like that:
A file with all addresses in question Tool which could import all these addresses and resolve them Save the results into a new file Once having at least a couple of files, the results could be compared."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://kamilpro.github.io/posts/"},{"@type":"ListItem","position":3,"name":"Resolve IP and DNS with Powershell tool","item":"https://kamilpro.github.io/powershell-tool-resolve-ip-and-dns/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Resolve IP and DNS with Powershell tool","name":"Resolve IP and DNS with Powershell tool","description":"I’ve been asked to prepare a simple tool which would:\nResolve IP address or DNS Return all results to table Import addresses from a file The reason behind was to check how IP/DNS records change over the period of time, therefore there was a need for something like that:\nA file with all addresses in question Tool which could import all these addresses and resolve them Save the results into a new file Once having at least a couple of files, the results could be compared.","keywords":["dns","feat","ip","network","powershell","resolve","toolmaking"],"articleBody":"I’ve been asked to prepare a simple tool which would:\nResolve IP address or DNS Return all results to table Import addresses from a file The reason behind was to check how IP/DNS records change over the period of time, therefore there was a need for something like that:\nA file with all addresses in question Tool which could import all these addresses and resolve them Save the results into a new file Once having at least a couple of files, the results could be compared.\nThere are tools like ping, nslookup or Powershell’s Resolve-DnsName but they simply can’t meet all the requiments (or at least not to my knowledge). So I simply needed to prepare the dedicated tool.\nAnd thus I’ve created Resolve-IPDNS, the source code at the moment of writing this post looks like this:\nfunction Resolve-IPDNS { \u003c# .SYNOPSIS Resolves IPv4 address to DNS, or DNS to IPv4. .DESCRIPTION This command uses either IPv4 or DNS name to resolve either. It puts all the data into a structured table, which can be easilly exported if needed. By default it uses 1.1.1.1 DNS server. .PARAMETER IPDNS One or more IPs or DNS names. Values can be piped. .PARAMETER DNSServer Specifies which DNS server will resolve all the queries. .EXAMPLE Resolve-IPDNS -IPDNS bbc.com,8.8.8.8 Resolves \"bbc.com\" and \"8.8.8.8\" returning their retrospective addresses. .EXAMPLE (Get-Content C:\\temp\\test.txt) | Resolve-IPDNS This example will try to resolve all entries from the file .NOTES Createad by Kamil Procyszyn last updated April 2018 https://kamilpro.com #\u003e [CmdletBinding()] param( [Parameter(Mandatory = $true,ValueFromPipeline = $true)] [string[]]$IPDNS, [string]$DNSServer = \"1.1.1.1\" )#param BEGIN {} Process { foreach ($addrs in $IPDNS ) { #Resolve IP or DNS IF ($addrs -as [ipaddress]) { $resolve_params = @{ 'Name' = $addrs 'Server' = $DNSServer 'Type' = 'PTR' } } ELSE { $resolve_params = @{ 'Name' = $addrs 'Server' = $DNSServer 'Type' = 'A' } } ForEach ($resolve in Resolve-DnsName @resolve_params) { #Create props IF ($addrs -as [ipaddress]) { $props = @{ 'IP' = $resolve.Name 'DNS' = $resolve.NameHost } } ELSE { $props = @{ 'IP' = $resolve.IPAddress 'DNS' = $resolve.Name } }#IF #Output data $obj = New-Object -TypeName psobject -Property $props Write-Output $obj }#Foreach $resolve in dns-resolve }#foreach $addrs in $ipdns }#Process END {} }#function Resolve-IPDNS Let’s break down the function now:\nforeach ($addrs in $IPDNS Since $IPDNS can take multiple values, I want to process the function for every address it is given.\n#Resolve IP or DNS IF ($addrs -as [ipaddress]) { $resolve_params = @{ 'Name' = $addrs 'Server' = $DNSServer 'Type' = 'PTR' } } ELSE { $resolve_params = @{ 'Name' = $addrs 'Server' = $DNSServer 'Type' = 'A' } } ForEach ($resolve in Resolve-DnsName @resolve_params) The code above prepares the parameters which are going to be parsed to Resolve-DnsName . It establishes if the value is the IP address or DNS name “(IF ($addrs -as [ipaddress])” and then specifies the appropiate query type (Either A record for DNS or PTR record for IP).\nIt’s not really necessary, but gives more control over function.\n#Create props IF ($addrs -as [ipaddress]) { $props = @{ 'IP' = $resolve.Name 'DNS' = $resolve.NameHost } } ELSE { $props = @{ 'IP' = $resolve.IPAddress 'DNS' = $resolve.Name } }#IF Now, the script prepares properties for the new custom object. Since Powershell uses different property names for different queries, it’s essential to expand the right ones. As you can see above, for the IP address the IP and DNS properties are called Name and NameHost respectively, while for DNS they’re called IPAddress and Name, respectively.\nBy creating properties that way, I’m able to create an object with two consistent collums: IP and DNS which you can see bellow:\n$obj = New-Object -TypeName psobject -Property $props Write-Output $obj This is it, Powershell will output the nicely formated data onto your screen now:\nIP DNS -- --- 1.1.1.1.in-addr.arpa 1dot1dot1dot1.cloudflare-dns.com 151.101.0.81 bbc.com 151.101.64.81 bbc.com 151.101.128.81 bbc.com 151.101.192.81 bbc.com 151.101.1.67 cnn.com 151.101.65.67 cnn.com 151.101.129.67 cnn.com 151.101.193.67 cnn.com 8.8.8.8.in-addr.arpa google-public-dns-a.google.com As you can see, it can even deal with round robing entries!\nYou can obviously pipe the data into the function and export it to e.g. csv.\nYou can always find up-to-date version of the tool here: https://github.com/kprocyszyn\nMain photo by: Jungwoo Hong on Unsplash\n","wordCount":"702","inLanguage":"en","datePublished":"2018-04-29T21:40:00Z","dateModified":"2022-01-03T19:48:21Z","author":{"@type":"Person","name":"Kamil"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://kamilpro.github.io/powershell-tool-resolve-ip-and-dns/"},"publisher":{"@type":"Organization","name":"Kamil Pro","logo":{"@type":"ImageObject","url":"https://kamilpro.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kamilpro.github.io accesskey=h title="Kamil Pro (Alt + H)">Kamil Pro</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://kamilpro.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://kamilpro.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://kamilpro.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href="https://www.youtube.com/playlist?list=PL-esmhgrps8Zv9bAHesStPRQ1AiUL1wY3" title="About PowerShell"><span>About PowerShell</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://kamilpro.github.io/powershell-for-it-professionals/ title="Powershell for IT professionals"><span>Powershell for IT professionals</span></a></li><li><a href=https://github.com/thekamilpro title=GitHub><span><i class='fab fa-github fa-fw'></i></span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Resolve IP and DNS with Powershell tool</h1><div class=post-meta><span title='2018-04-29 21:40:00 +0000 UTC'>2018-04-29</span>&nbsp;·&nbsp;Kamil</div></header><div class=post-content><p>I’ve been asked to prepare a simple tool which would:</p><ul><li>Resolve IP address or DNS</li><li>Return all results to table</li><li>Import addresses from a file</li></ul><p>The reason behind was to check how IP/DNS records change over the period of time, therefore there was a need for something like that:</p><ul><li>A file with all addresses in question</li><li>Tool which could import all these addresses and resolve them</li><li>Save the results into a new file</li></ul><p>Once having at least a couple of files, the results could be compared.</p><p>There are tools like ping, nslookup or Powershell’s Resolve-DnsName but they simply can’t meet all the requiments (or at least not to my knowledge).  So I simply needed to prepare the dedicated tool.</p><p>And thus I’ve created Resolve-IPDNS, the source code at the moment of writing this post looks like this:</p><pre class="lang:ps decode:true" title=Resolve-IPDNS>function Resolve-IPDNS {
&lt;#
.SYNOPSIS
Resolves IPv4 address to DNS, or DNS to IPv4.  
.DESCRIPTION
This command uses either IPv4 or DNS name to resolve either. It puts all the data into
a structured table, which can be easilly exported if needed. By default it uses 
1.1.1.1 DNS server.
.PARAMETER IPDNS
One or more IPs or DNS names. Values can be piped.
.PARAMETER DNSServer
Specifies which DNS server will resolve all the queries.
.EXAMPLE
Resolve-IPDNS -IPDNS bbc.com,8.8.8.8
Resolves "bbc.com" and "8.8.8.8" returning their retrospective addresses. 
.EXAMPLE
(Get-Content C:\temp\test.txt) | Resolve-IPDNS
This example will try to resolve all entries from the file
.NOTES
Createad by Kamil Procyszyn
last updated April 2018
https://kamilpro.com
#&gt;    
    
    [CmdletBinding()]
    param(
        [Parameter(Mandatory = $true,ValueFromPipeline = $true)]
        [string[]]$IPDNS,

        [string]$DNSServer = "1.1.1.1"

    )#param

    BEGIN {}

    Process {
        foreach ($addrs in $IPDNS ) {
        
            #Resolve IP or DNS
            IF ($addrs -as [ipaddress]) {
                $resolve_params = @{
                    'Name'   = $addrs
                    'Server' = $DNSServer
                    'Type'   = 'PTR'
                }
            }
            ELSE {
                $resolve_params = @{
                    'Name'   = $addrs
                    'Server' = $DNSServer
                    'Type'   = 'A'
                }
            }
          
            ForEach ($resolve in Resolve-DnsName @resolve_params) {

                #Create props
                IF ($addrs -as [ipaddress]) {
                    $props = @{
                        'IP'  = $resolve.Name
                        'DNS' = $resolve.NameHost
                    }
                }
                ELSE {
                    $props = @{
                        'IP'  = $resolve.IPAddress
                        'DNS' = $resolve.Name
                    }
                
                }#IF
       
                #Output data
                $obj = New-Object -TypeName psobject -Property $props
                Write-Output $obj
                
            }#Foreach $resolve in dns-resolve
        
        }#foreach $addrs in $ipdns

    }#Process
    END {}
}#function

Resolve-IPDNS</pre><p>Let’s break down the function now:</p><pre class="lang:ps decode:true">foreach ($addrs in $IPDNS</pre><p>Since $IPDNS can take multiple values, I want to process the function for every address it is given.</p><pre class="lang:ps decode:true">#Resolve IP or DNS
            IF ($addrs -as [ipaddress]) {
                $resolve_params = @{
                    'Name'   = $addrs
                    'Server' = $DNSServer
                    'Type'   = 'PTR'
                }
            }
            ELSE {
                $resolve_params = @{
                    'Name'   = $addrs
                    'Server' = $DNSServer
                    'Type'   = 'A'
                }
            }

ForEach ($resolve in Resolve-DnsName @resolve_params)</pre><p>The code above prepares the parameters which are going to be parsed to Resolve-DnsName . It establishes if the value is the IP address or DNS name “(IF ($addrs -as [ipaddress])” and then specifies the appropiate query type (Either A record for DNS or PTR record for IP).</p><p>It’s not really necessary, but gives more control over function.</p><pre class="lang:ps decode:true">#Create props
                IF ($addrs -as [ipaddress]) {
                    $props = @{
                        'IP'  = $resolve.Name
                        'DNS' = $resolve.NameHost
                    }
                }
                ELSE {
                    $props = @{
                        'IP'  = $resolve.IPAddress
                        'DNS' = $resolve.Name
                    }
                
                }#IF</pre><p>Now, the script prepares properties for the new custom object. Since Powershell uses different property names for different queries, it’s essential to expand the right ones. As you can see above, for the IP address the IP and DNS properties are called Name and NameHost respectively, while for DNS they’re called IPAddress and Name, respectively.</p><p>By creating properties that way, I’m able to create an object with two consistent collums: IP and DNS which you can see bellow:</p><pre class="lang:ps decode:true">$obj = New-Object -TypeName psobject -Property $props
 Write-Output $obj</pre><p>This is it, Powershell will output the nicely formated data onto your screen now:</p><pre class="lang:ps decode:true">IP                   DNS
--                   ---
1.1.1.1.in-addr.arpa 1dot1dot1dot1.cloudflare-dns.com
151.101.0.81         bbc.com
151.101.64.81        bbc.com
151.101.128.81       bbc.com
151.101.192.81       bbc.com
151.101.1.67         cnn.com
151.101.65.67        cnn.com
151.101.129.67       cnn.com
151.101.193.67       cnn.com
8.8.8.8.in-addr.arpa google-public-dns-a.google.com</pre><p>As you can see, it can even deal with round robing entries!</p><p>You can obviously pipe the data into the function and export it to e.g. csv.</p><p>You can always find up-to-date version of the tool here: <a href=https://github.com/kprocyszyn>https://github.com/kprocyszyn</a></p><p>Main photo by: <a href="https://unsplash.com/photos/cYUMaCqMYvI?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Jungwoo Hong</a> on <a href="https://unsplash.com/search/photos/point-sign?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://kamilpro.github.io/tags/dns/>dns</a></li><li><a href=https://kamilpro.github.io/tags/feat/>feat</a></li><li><a href=https://kamilpro.github.io/tags/ip/>ip</a></li><li><a href=https://kamilpro.github.io/tags/network/>network</a></li><li><a href=https://kamilpro.github.io/tags/powershell/>powershell</a></li><li><a href=https://kamilpro.github.io/tags/resolve/>resolve</a></li><li><a href=https://kamilpro.github.io/tags/toolmaking/>toolmaking</a></li></ul></footer></article></main><footer class=footer><span>Kamil Procyszyn</span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>